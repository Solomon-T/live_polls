function naturalSort(a,b){var oFxNcL,oFyNcL,re=/(^([+\-]?(?:\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[\da-fA-F]+$|\d+)/g,sre=/^\s+|\s+$/g,snre=/\s+/g,dre=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,hre=/^0x[0-9a-f]+$/i,ore=/^0/,i=function(s){return(naturalSort.insensitive&&(""+s).toLowerCase()||""+s).replace(sre,"")},x=i(a)||"",y=i(b)||"",xN=x.replace(re,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),yN=y.replace(re,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),xD=parseInt(x.match(hre),16)||1!==xN.length&&Date.parse(x),yD=parseInt(y.match(hre),16)||xD&&y.match(dre)&&Date.parse(y)||null,normChunk=function(s,l){return(!s.match(ore)||1==l)&&parseFloat(s)||s.replace(snre," ").replace(sre,"")||0};if(yD){if(xD<yD)return-1;if(xD>yD)return 1}for(var cLoc=0,xNl=xN.length,yNl=yN.length,numS=Math.max(xNl,yNl);cLoc<numS;cLoc++){if(oFxNcL=normChunk(xN[cLoc]||"",xNl),oFyNcL=normChunk(yN[cLoc]||"",yNl),isNaN(oFxNcL)!==isNaN(oFyNcL))return isNaN(oFxNcL)?1:-1;if(typeof oFxNcL!=typeof oFyNcL&&(oFxNcL+="",oFyNcL+=""),oFxNcL<oFyNcL)return-1;if(oFxNcL>oFyNcL)return 1}return 0}(function(){var slice=[].slice;window.HAML=function(){function HAML(){}return HAML.escape=function(text){return(""+text).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\//g,"&#47;")},HAML.cleanValue=function(text){switch(text){case null:case void 0:return"";case!0:case!1:return"\x93"+text;default:return text}},HAML.extend=function(){var i,key,len,obj,source,sources,val;for(obj=arguments[0],i=0,len=(sources=2<=arguments.length?slice.call(arguments,1):[]).length;i<len;i++)for(key in source=sources[i])val=source[key],obj[key]=val;return obj},HAML.globals=function(){return{}},HAML.context=function(locals){return this.extend({},HAML.globals(),locals)},HAML.preserve=function(text){return text.replace(/\n/g,"&#x000A;")},HAML.findAndPreserve=function(text){var tags;return tags="textarea,pre".split(",").join("|"),text.replace(/\r/g,"").replace(RegExp("<("+tags+")>([\\s\\S]*?)<\\/\\1>","g"),function(str,tag,content){return"<"+tag+">"+window.HAML.preserve(content)+"</"+tag+">"})},HAML.surround=function(start,end,fn){var ref;return start+(null!=(ref=fn.call(this))?ref.replace(/^\s+|\s+$/g,""):void 0)+end},HAML.succeed=function(end,fn){var ref;return(null!=(ref=fn.call(this))?ref.replace(/\s+$/g,""):void 0)+end},HAML.precede=function(start,fn){var ref;return start+(null!=(ref=fn.call(this))?ref.replace(/^\s+/g,""):void 0)},HAML.reference=function(object,prefix){var id,name,ref;if(name=prefix?prefix+"_":"","function"==typeof object.hamlObjectRef?name+=object.hamlObjectRef():name+=((null!=(ref=object.constructor)?ref.name:void 0)||"object").replace(/\W+/g,"_").replace(/([a-z\d])([A-Z])/g,"$1_$2").toLowerCase(),id="function"==typeof object.to_key?object.to_key():"function"==typeof object.id?object.id():object.id?object.id:object)return"class='"+name+"'"+" id='"+name+"_"+id+"'"},HAML}()}).call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.Router",function(Router){var loadAccountUsers,propagateViewActionEvents;return propagateViewActionEvents=function(self,view,namespace){return self.listenTo(view,"view:action",function(event,data,opts){return null==data&&(data={}),null==opts&&(opts={}),self.trigger("view:action",namespace+":"+event,data,opts)})},loadAccountUsers=function(self,userIds){var opts;return opts={url:"/api/account_users",data:{}},userIds&&(opts.data.user_ids=userIds),self.users.fetch(opts)},Router.Polls=function(superClass){function Polls(){return this.loadActivityExample=bind(this.loadActivityExample,this),this.showUsers=bind(this.showUsers,this),this.home=bind(this.home,this),this.trash=bind(this.trash,this),this.sharedPolls=bind(this.sharedPolls,this),this.examples=bind(this.examples,this),this["import"]=bind(this["import"],this),this.newActivity=bind(this.newActivity,this),this.showAllUsers=bind(this.showAllUsers,this),this.showSingleUser=bind(this.showSingleUser,this),this.toggleNav=bind(this.toggleNav,this),this.start=bind(this.start,this),Polls.__super__.constructor.apply(this,arguments)}return extend(Polls,superClass),Polls.prototype.routes={"!/account/polls?user_id=:userId":"showSingleUser","!/account/polls":"showAllUsers","!/my/polls/new":"newActivity","account/polls?user_id=:userId":"showSingleUser","account/polls":"showAllUsers","my/polls/new?activity_url=:activityUrl":"loadActivityExample","my/polls/new?type=:type":"newActivity","my/polls/new":"newActivity","my/polls/import":"import","shared/polls":"sharedPolls",trash:"trash",examples:"examples","*default":"home"},Polls.prototype.initialize=function(opts){var urlParams;if(null==opts&&(opts={}),this.users=new PollEv.Model.Users,this.users.parse=function(resp){return PollEv.Util.popRootKeys(resp)},new PollEv.Service.Datadog(this),new PollEv.Service.Cutlass(this),new PollEv.Service.LoadTime(this,window.performance),null!=(urlParams=PollEv.Util.params(location.href)).log_level)return new PollEv.Service.Logger(this,urlParams.log_level)},Polls.prototype.start=function(opts){return this.session.start(),this.listenTo(this.session,"session:started",(_this=this,function(){var fragment;return _this.user=_this.users.add(_this.user),_this.view=new PollEv.Editor.View.AppView({el:opts.el}),fragment=window.location.pathname.substring(1)+window.location.search,Backbone.history.start({pushState:window.history&&window.history.pushState,silent:!0}),Backbone.history.loadUrl(fragment)}));var _this},Polls.prototype.toggleNav=function(text){return this.view.nav.secondary.find("li .link").removeClass("active").removeAttr("aria-describedby").filter(":contains("+text+")").addClass("active").attr("aria-describedby","aria-current")},Polls.prototype.showSingleUser=function(userId){return this.user.get("features").shared_activities&&!this.user.get("account_admin?")?this.navigate("my/polls"):loadAccountUsers(this,[userId]).then((_this=this,function(){var user,view;return loadAccountUsers(_this),(user=_this.users.get(userId))?(view=_this.showUsers("Account polls",user,{showHeader:!0,showBulkControls:!0}),propagateViewActionEvents(_this,view,"account_polls")):_this.view.showError("Uh oh. We couldn't find that person.")}));var _this},Polls.prototype.showAllUsers=function(){return this.user.get("features").shared_activities&&!this.user.get("account_admin?")?this.navigate("my/polls"):loadAccountUsers(this).then((_this=this,function(){var users,view;return users=[_this.user].concat(_this.users.without(_this.user)),view=_this.showUsers("Account polls",users,{showHeader:!0,showBulkControls:!0,showingAllUsers:!0}),propagateViewActionEvents(_this,view,"account_polls")}));var _this},Polls.prototype.newActivity=function(type){var opts;return opts={delayNagger:!0},this.home(null,opts),this.view.showMagicBar(null,{type:type}),this.navigate("my/polls",{replace:!0,trigger:!1})},Polls.prototype["import"]=function(){var opts;return opts={delayNagger:!0},this.home(null,opts),this.view.showImporter(),this.navigate("my/polls",{replace:!0,trigger:!1})},Polls.prototype.examples=function(){var view;return this.renderTitle("Examples"),view=new PollEv.Editor.View.Examples,this.view.$el.removeClass("account-polls my-polls"),this.view.$el.addClass("examples"),this.view.render(view),propagateViewActionEvents(this,view,"example_activities"),this.user.groups.fetch()},Polls.prototype.sharedPolls=function(opts){var view;return null==opts&&(opts={}),loadAccountUsers(this),_.isString(opts)&&(opts=PollEv.Util.params(opts)),this.renderTitle("Shared with me"),view=new PollEv.Editor.View.SharedPolls({user:this.user}),this.view.$el.removeClass("account-polls my-polls examples").addClass("shared-polls"),this.view.render(view),this.trigger("view:action","share_poll:discover"),propagateViewActionEvents(this,view,"share_poll")},Polls.prototype.trash=function(opts){var view;return null==opts&&(opts={}),this.renderTitle("Trash"),view=new PollEv.Editor.View.Trash,this.view.render(view),propagateViewActionEvents(this,view,"trash")},Polls.prototype.home=function(path,opts){var view;return loadAccountUsers(this),_.isString(opts)&&(opts=PollEv.Util.params(opts)),view=this.showUsers("My polls",this.user,opts),propagateViewActionEvents(this,view,"my_polls")},Polls.prototype.showUsers=function(title,users,opts){var view;return null==opts&&(opts={}),this.renderTitle(title),_.isArray(users)||(users=[users]),_.defaults(opts,{users:users,showHeader:users.length>1,showBulkControls:!0}),view=new PollEv.Editor.View.Polls(opts),this.view.$el.removeClass("account-polls my-polls shared-polls examples"),this.view.$el.addClass(_.str.slugify(title)),this.view.render(view),view},Polls.prototype.renderTitle=function(title){return title?(this.toggleNav(title),"My polls"===title&&(title="Polls"),document.title=title+" | Poll Everywhere"):document.title="Poll Everywhere"},Polls.prototype.loadActivityExample=function(activityUrl){var ref,_this;return(null!=(ref=PollEv.app.user)?ref.groups.size():void 0)?$.getJSON(activityUrl).then((_this=this,function(activity){return _this.view.showMagicBar(null,{activity:PollEv.Util.activityFactory(activity)})})):this.user.groups.fetch().then(function(_this){return function(){return _this.loadActivityExample(activityUrl)}}(this))},Polls}(PollEv.Router.Base)})}.call(this),function(){this.editor_images={new_plans_modal:{banner:"//davhizrhxzcu1.cloudfront.net/assets/pricing-change-first-modal-8b7d9eb6093db755df614f8785a6da0be8b2e62839776f7b149ab8b83e394e72.png"},seven_hundred_rpp_modal:{banner:"//davhizrhxzcu1.cloudfront.net/assets/pricing-change-700-rpp-modal-f224124b0daeb6a13a3448f53c9a9da550ce7abd181048ad54e6ed34d9ebbde6.png"},team_manager_modal:{banner:"//davhizrhxzcu1.cloudfront.net/assets/team-manager-modal-3b0df3ff205066d8972e443735db1ba13a0f220c003096ddbc2cdb3f8cbcde8b.png"}}}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("Editor.View",function(View){return View.Base=function(superClass){function Base(){return Base.__super__.constructor.apply(this,arguments)}return extend(Base,superClass),Base.prototype.internetExplorer=function(){return $.browser.msie},Base}(PollEv.View.Base)})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/backbone_apps/activities/share"]=function(){return function(context){return function(){var $c,$e,$o,socialMedia,succeed,_this;return $e=window.HAML.escape,$c=window.HAML.cleanValue,_this=this,succeed=function(start,end,fn){return window.HAML.succeed.call(_this,start,end,fn)},socialMedia=function(){return $o.push("<div class='activity-share--social-media-container'>\n  <a class='activity-share--platform' m-email js-email-share>\n    <span class='email-share icon' data-glyph='email'></span>\n  </a>\n  <a class='activity-share--platform' target='_blank' m-twitter js-twitter-share rel='noopener'>\n    <span class='icon twitter-share' data-glyph='twitter'></span>\n  </a>\n  <a class='activity-share--platform' target='_blank' m-facebook js-facebook-share rel='noopener'>\n    <span class='facebook-share icon' data-glyph='facebook'></span>\n  </a>\n</div>"),""},($o=[]).push("<div class='padded-container'>\n  <div class='share-link web-response-voting'>\n    <h3 class='activity-share--header'>\n      <a class='web-address' target='_blank' rel='noopener'>Shareable response link</a>\n    </h3>\n    <div class='activity-share--platform' m-link>\n      <span class='copy-to-clipboard icon' data-glyph='link'></span>\n      <div class='clipboard-notification hidden icon' data-glyph='checkmark'></div>\n    </div>"),$o.push("    "+$e($c(socialMedia()))),$o.push("    <div class='activity-share--description'>Use this link to share with people on the web.</div>\n    <input class='activity-share--web-response-link' type='text' js-web-response-link readonly='readonly'>\n    <div class='activity-share--description' m-note>\n      People can respond without the\n      <span js-activity-type>poll</span>\n      being active.\n    </div>\n  </div>\n  <div class='activity-share--secondary-actions-container' js-secondary-actions>\n    <div class='pollev-voting share-link'>\n      <div class='activity-share--divider'></div>\n      <h3 class='activity-share--header'>\n        <a class='web-address' target='_blank' rel='noopener'>PollEv.com</a>\n      </h3>\n      <div class='activity-share--platform' m-link>\n        <span class='copy-to-clipboard icon' data-glyph='link'></span>\n        <div class='clipboard-notification hidden icon' data-glyph='checkmark'></div>\n      </div>\n      <div class='activity-share--description'>\n        Use this page to present the\n        <span js-activity-type>poll</span>\n        to a live audience. It always displays the\n        <span js-activity-type>poll</span>\n        that is currently activated.\n      </div>\n      <div class='activity-share--description'>\n        Your current\n        <span js-activity-type>poll</span>\n        will remain active for"),$o.push("        "+$c(succeed(".",function(){var $o1;return($o1=[]).push("        <span class='push-timeout'></span>"),$o1.join("\n")}))),$o.push("        <a class='edit-push-duration' href='/profile/poll_settings/edit' target='_blank' rel='noopener'>Edit</a>\n      </div>\n    </div>\n    <div class='live-results-chart share-link'>\n      <div class='activity-share--divider'></div>\n      <h3 class='activity-share--header'>\n        <a class='live-results' target='_blank' rel='noopener'>Live results</a>\n      </h3>\n      <div class='activity-share--platform' m-link>\n        <span class='copy-to-clipboard icon' data-glyph='link'></span>\n        <div class='clipboard-notification hidden icon' data-glyph='checkmark'></div>\n      </div>"),$o.push("      "+$e($c(socialMedia()))),$o.push("      <div class='activity-share--description'>Live chart with real-time results.</div>\n      <div class='activity-share--description' m-note>Don't share unless you want to reveal responses to the people who receive the link.</div>\n    </div>\n    <div class='embed-poll share-link'>\n      <div class='activity-share--divider'></div>\n      <h3 class='activity-share--header'>\n        <a class='embed' target='_blank' rel='noopener'>\n          <strong>\n            Embed\n            <span js-activity-type>poll</span>\n          </strong>\n        </a>\n      </h3>\n      <div class='activity-share--description'>\n        Embed this\n        <span js-activity-type>poll</span>\n        into your webpage or blog.\n      </div>\n    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Clipboard=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){function closest(element,selector){for(;element&&element.nodeType!==DOCUMENT_NODE_TYPE;){if("function"==typeof element.matches&&element.matches(selector))return element;element=element.parentNode}}var DOCUMENT_NODE_TYPE=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var proto=Element.prototype;proto.matches=proto.matchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector||proto.webkitMatchesSelector}module.exports=closest},{}],2:[function(require,module){function delegate(element,selector,type,callback,useCapture){var listenerFn=listener.apply(this,arguments);return element.addEventListener(type,listenerFn,useCapture),{destroy:function(){element.removeEventListener(type,listenerFn,useCapture)}}}function listener(element,selector,type,callback){return function(e){e.delegateTarget=closest(e.target,selector),e.delegateTarget&&callback.call(element,e)}}var closest=require("./closest");module.exports=delegate},{"./closest":1}],3:[function(require,module,exports){exports.node=function(value){return value!==undefined&&value instanceof HTMLElement&&1===value.nodeType},exports.nodeList=function(value){var type=Object.prototype.toString.call(value);return value!==undefined&&("[object NodeList]"===type||"[object HTMLCollection]"===type)&&"length"in value&&(0===value.length||exports.node(value[0]))},exports.string=function(value){return"string"==typeof value||value instanceof String},exports.fn=function(value){return"[object Function]"===Object.prototype.toString.call(value)}},{}],4:[function(require,module){function listen(target,type,callback){if(!target&&!type&&!callback)throw new Error("Missing required arguments");if(!is.string(type))throw new TypeError("Second argument must be a String");if(!is.fn(callback))throw new TypeError("Third argument must be a Function");if(is.node(target))return listenNode(target,type,callback);if(is.nodeList(target))return listenNodeList(target,type,callback);if(is.string(target))return listenSelector(target,type,callback);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function listenNode(node,type,callback){return node.addEventListener(type,callback),{destroy:function(){node.removeEventListener(type,callback)}}}function listenNodeList(nodeList,type,callback){return Array.prototype.forEach.call(nodeList,function(node){node.addEventListener(type,callback)}),{destroy:function(){Array.prototype.forEach.call(nodeList,function(node){node.removeEventListener(type,callback)})}}}function listenSelector(selector,type,callback){return delegate(document.body,selector,type,callback)}var is=require("./is"),delegate=require("delegate");module.exports=listen},{"./is":3,delegate:2}],5:[function(require,module){function select(element){var selectedText;if("SELECT"===element.nodeName)element.focus(),selectedText=element.value;else if("INPUT"===element.nodeName||"TEXTAREA"===element.nodeName){var isReadOnly=element.hasAttribute("readonly");isReadOnly||element.setAttribute("readonly",""),element.select(),element.setSelectionRange(0,element.value.length),isReadOnly||element.removeAttribute("readonly"),selectedText=element.value}else{element.hasAttribute("contenteditable")&&element.focus();var selection=window.getSelection(),range=document.createRange();range.selectNodeContents(element),selection.removeAllRanges(),selection.addRange(range),selectedText=selection.toString()}return selectedText}module.exports=select},{}],6:[function(require,module){function E(){}E.prototype={on:function(name,callback,ctx){var e=this.e||(this.e={});return(e[name]||(e[name]=[])).push({fn:callback,ctx:ctx}),this},once:function(name,callback,ctx){function listener(){self.off(name,listener),callback.apply(ctx,arguments)}var self=this;return listener._=callback,this.on(name,listener,ctx)},emit:function(name){for(var data=[].slice.call(arguments,1),evtArr=((this.e||(this.e={}))[name]||[]).slice(),i=0,len=evtArr.length;i<len;i++)evtArr[i].fn.apply(evtArr[i].ctx,data);return this},off:function(name,callback){var e=this.e||(this.e={}),evts=e[name],liveEvents=[];if(evts&&callback)for(var i=0,len=evts.length;i<len;i++)evts[i].fn!==callback&&evts[i].fn._!==callback&&liveEvents.push(evts[i]);return liveEvents.length?e[name]=liveEvents:delete e[name],this}},module.exports=E},{}],7:[function(require,module,exports){!function(global,factory){if("function"==typeof define&&define.amd)define(["module","select"],factory);else if(void 0!==exports)factory(module,require("select"));else{var mod={exports:{}};factory(mod,global.select),global.clipboardAction=mod.exports}}(this,function(module,_select){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _select2=_interopRequireDefault(_select),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ClipboardAction=function(){function ClipboardAction(options){_classCallCheck(this,ClipboardAction),this.resolveOptions(options),this.initSelection()}return _createClass(ClipboardAction,[{key:"resolveOptions",value:function(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=options.action,this.container=options.container,this.emitter=options.emitter,this.target=options.target,this.text=options.text,this.trigger=options.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var _this=this,isRTL="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return _this.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[isRTL?"right":"left"]="-9999px";var yPosition=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=yPosition+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,_select2["default"])(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,_select2["default"])(this.target),this.copyText()}},{key:"copyText",value:function(){var succeeded=void 0;try{succeeded=document.execCommand(this.action)}catch(err){succeeded=!1}this.handleResult(succeeded)}},{key:"handleResult",value:function(succeeded){this.emitter.emit(succeeded?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var action=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"copy";if(this._action=action,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(target){if(target!==undefined){if(!target||"object"!==(void 0===target?"undefined":_typeof(target))||1!==target.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&target.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(target.hasAttribute("readonly")||target.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=target}},get:function(){return this._target}}]),ClipboardAction}();module.exports=ClipboardAction})},{select:5}],8:[function(require,module,exports){!function(global,factory){if("function"==typeof define&&define.amd)define(["module","./clipboard-action","tiny-emitter","good-listener"],factory);else if(void 0!==exports)factory(module,require("./clipboard-action"),require("tiny-emitter"),require("good-listener"));else{var mod={exports:{}};factory(mod,global.clipboardAction,global.tinyEmitter,global.goodListener),global.clipboard=mod.exports}}(this,function(module,_clipboardAction,_tinyEmitter,_goodListener){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getAttributeValue(suffix,element){var attribute="data-clipboard-"+suffix;if(element.hasAttribute(attribute))return element.getAttribute(attribute)}var _clipboardAction2=_interopRequireDefault(_clipboardAction),_tinyEmitter2=_interopRequireDefault(_tinyEmitter),_goodListener2=_interopRequireDefault(_goodListener),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Clipboard=function(){function Clipboard(trigger,options){_classCallCheck(this,Clipboard);var _this=_possibleConstructorReturn(this,(Clipboard.__proto__||Object.getPrototypeOf(Clipboard)).call(this));return _this.resolveOptions(options),_this.listenClick(trigger),_this}return _inherits(Clipboard,_tinyEmitter2["default"]),_createClass(Clipboard,[{key:"resolveOptions",value:function(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action="function"==typeof options.action?options.action:this.defaultAction,this.target="function"==typeof options.target?options.target:this.defaultTarget,this.text="function"==typeof options.text?options.text:this.defaultText,this.container="object"===_typeof(options.container)?options.container:document.body}},{key:"listenClick",value:function(trigger){var _this2=this;this.listener=(0,_goodListener2["default"])(trigger,"click",function(e){return _this2.onClick(e)})}},{key:"onClick",value:function(e){var trigger=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new _clipboardAction2["default"]({action:this.action(trigger),target:this.target(trigger),text:this.text(trigger),container:this.container,trigger:trigger,emitter:this})}},{key:"defaultAction",value:function(trigger){return getAttributeValue("action",trigger)}},{key:"defaultTarget",value:function(trigger){var selector=getAttributeValue("target",trigger);if(selector)return document.querySelector(selector)}},{key:"defaultText",value:function(trigger){return getAttributeValue("text",trigger)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var action=arguments.length>0&&arguments[0]!==undefined?arguments[0]:["copy","cut"],actions="string"==typeof action?[action]:action,support=!!document.queryCommandSupported;return actions.forEach(function(action){support=support&&!!document.queryCommandSupported(action)}),support}}]),Clipboard}();module.exports=Clipboard})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)}),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View.Activities",function(Activities){var logUsage;return logUsage=function(self,platform){var data;return data={platform:platform},self.trigger("view:action","share",data,{immediate:!0})},Activities.Share=function(superClass){function Share(){return this.remove=bind(this.remove,this),this.render=bind(this.render,this),this.showSecondaryActions=bind(this.showSecondaryActions,this),this.hideSecondaryActions=bind(this.hideSecondaryActions,this),this.selectWebResponseLink=bind(this.selectWebResponseLink,this),this.hideEmbedPollLinkForUnsupportedPollTypes=bind(this.hideEmbedPollLinkForUnsupportedPollTypes,this),this.renderActivityType=bind(this.renderActivityType,this),this.renderPushTimeout=bind(this.renderPushTimeout,this),this.renderLinks=bind(this.renderLinks,this),this.sharedChartUrl=bind(this.sharedChartUrl,this),this.webResponseUrl=bind(this.webResponseUrl,this),this.renderFacebook=bind(this.renderFacebook,this),this.renderTwitter=bind(this.renderTwitter,this),this.renderEmailTemplates=bind(this.renderEmailTemplates,this),this.renderWebAddress=bind(this.renderWebAddress,this),this.setupClipboard=bind(this.setupClipboard,this),this.initialize=bind(this.initialize,this),Share.__super__.constructor.apply(this,arguments)}return extend(Share,superClass),Share.prototype.template=JST["templates/backbone_apps/activities/share"],Share.prototype.className="activity-share--container",Share.prototype.appEvents={changeStep:"selectWebResponseLink"},Share.prototype.events={"click [js-email-share]":"renderEmailTemplate","click .accordion-menu--header":"selectWebResponseLink","click [js-web-response-link]":"selectWebResponseLink","click [js-web-response-link]":function(){return logUsage(this,"url_highlight_field")},"click .web-address":function(){return logUsage(this,"web")},"click .live-results":function(){return logUsage(this,"live_results")},"click .embed":function(){return logUsage(this,"embed")},"click .activity-share--platform[js-email-share]":function(){return logUsage(this,"email")},"click .activity-share--platform[js-facebook-share]":function(){return logUsage(this,"facebook")},"click .activity-share--platform[js-twitter-share]":function(){return logUsage(this,"twitter")}},Share.prototype.initialize=function(options){return this.activityType=options.activityType,options},Share.prototype.setupClipboard=function(){return this.clipboard=new Clipboard(".copy-to-clipboard"),this.clipboard.on("success",(_this=this,function(e){var $notification;return logUsage(_this,"clipboard"),($notification=$(e.trigger).next()).toggleVisibility(!0),$(e.trigger).toggleVisibility(!1),_.delay(function(){return $notification.toggleVisibility(!1),$(e.trigger).toggleVisibility(!0)},1500)}));var _this},
Share.prototype.renderWebAddress=function(){var address,owner;if(address=PollEv.env.get("mobile_url").clone(),owner=this.app.user.get("login"),address)return address.protocol(PollEv.env.get("secure_protocol")).segment(owner),this.$(".pollev-voting .web-address").text("PollEv.com/"+owner).attr("href",address),this.$(".pollev-voting .copy-to-clipboard").attr({"data-clipboard-text":address})},Share.prototype.renderEmailTemplates=function(){var feedbackItem,lineBreaks,newPollUrl;return lineBreaks="%0D%0A%0D%0A",newPollUrl=window.location.origin+"/my/polls/new",feedbackItem="poll"===this.activityType?"question":"few questions",this.$(".web-response-voting [js-email-share]").attr({href:"mailto:?subject=I'd like to hear your response to this...&body=\nHello!"+lineBreaks+"\n\nI have a "+feedbackItem+" that could really use your input: "+this.webResponseUrl()+lineBreaks+"\n\nThanks for the feedback!"}),this.$(".live-results-chart [js-email-share]").attr({href:"mailto:?subject=The latest results from my "+this.activityType+"&body=\nHello!"+lineBreaks+"\n\nResponses are rolling in on my "+this.activityType+" at https://PollEverywhere.com. I thought you might be interested in the results."+lineBreaks+"\n\nCheck out the live chart: "+this.sharedChartUrl()+lineBreaks+"\n\nThanks for stopping by!"+lineBreaks+"\n\nCreate a "+this.activityType+" of your own. It's really easy: "+newPollUrl})},Share.prototype.renderTwitter=function(){var activityName,base,base1,chartUrl,liveResultsUrl,webVotingUrl;return chartUrl=this.sharedChartUrl(),activityName=("function"==typeof(base=this.model).name?base.name():void 0)||this.model.get("title"),webVotingUrl=URI("https://twitter.com/intent/tweet").addQuery({original_referer:window.location.origin+(("function"==typeof(base1=this.model).showPath?base1.showPath():void 0)||this.model.showUrl()),text:activityName,tw_p:"tweetbutton",url:this.webResponseUrl(),via:"polleverywhere"}),liveResultsUrl=URI("https://twitter.com/intent/tweet").addQuery({original_referer:chartUrl,text:activityName,tw_p:"tweetbutton",url:chartUrl,via:"polleverywhere"}),this.$(".web-response-voting [js-twitter-share]").attr({href:webVotingUrl.toString()}),this.$(".live-results-chart [js-twitter-share]").attr({href:liveResultsUrl.toString()})},Share.prototype.renderFacebook=function(){var liveResultsUrl,webVotingUrl;return webVotingUrl=URI("https://www.facebook.com/sharer/sharer.php").addQuery("u",this.webResponseUrl()),liveResultsUrl=URI("https://www.facebook.com/sharer/sharer.php").addQuery("u",this.sharedChartUrl()),this.$(".web-response-voting [js-facebook-share]").attr({href:webVotingUrl.toString()}),this.$(".live-results-chart [js-facebook-share]").attr({href:liveResultsUrl.toString()})},Share.prototype.webResponseUrl=function(){var webPath,webResponseUrl;return webPath=this.model.webVotingUrl(),(webResponseUrl=URI(PollEv.env.get("mobile_url").clone())).protocol(PollEv.env.get("secure_protocol")),webResponseUrl.path(webPath),webResponseUrl.toString()},Share.prototype.sharedChartUrl=function(){var path;return path=URI("/").segment(PollEv.Util.pluralize(2,this.model.type())).segment(this.model.get("presenter_key")).toString(),window.location.origin+path+"?preview=true&controls=none"},Share.prototype.renderLinks=function(){var chartUrl,webUrl;return chartUrl=this.sharedChartUrl(),webUrl=this.webResponseUrl(),this.$(".web-response-voting .web-address").attr("href",webUrl),this.$(".activity-share--web-response-link").val(webUrl),this.$(".web-response-voting .copy-to-clipboard").attr({"data-clipboard-text":webUrl}),this.$(".live-results").attr("href",chartUrl),this.$(".live-results-chart .copy-to-clipboard").attr({"data-clipboard-text":chartUrl}),"poll"===this.activityType&&this.$(".embed").attr("href",this.model.showUrl()+"/embed"),this.$(".presenter-app").attr("href","/app")},Share.prototype.renderPushTimeout=function(){return this.$(".push-timeout").text(this.app.user.get("current_poll_ttl"))},Share.prototype.renderActivityType=function(){return this.$("[js-activity-type]").text(this.activityType)},Share.prototype.hideEmbedPollLinkForUnsupportedPollTypes=function(){var ref,visible;return visible=!("clickable_image"===(ref=this.model.type())||"survey"===ref),this.$(".embed-poll").toggleVisibility(visible)},Share.prototype.selectWebResponseLink=function(){return this.$("[js-web-response-link]").select()},Share.prototype.hideSecondaryActions=function(){return this.$("[js-secondary-actions]").toggleVisibility(!1)},Share.prototype.showSecondaryActions=function(){return this.$("[js-secondary-actions]").toggleVisibility(!0)},Share.prototype.render=function(){return this.$el.html(this.template()),this.renderWebAddress(),this.renderLinks(),this.renderEmailTemplates(),this.renderPushTimeout(),this.renderTwitter(),this.renderFacebook(),this.renderActivityType(),_.defer(this.setupClipboard),this.hideEmbedPollLinkForUnsupportedPollTypes(),this},Share.prototype.remove=function(){var ref;return null!=(ref=this.clipboard)&&ref.off("success"),Share.__super__.remove.apply(this,arguments)},Share}(Editor.View.Base)})}.call(this),function(){var showActivityNote,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;showActivityNote=function(view,type){var $note,note;switch(type){case"multiple-choice":note="Ask a question and let participants choose from a list of answers.";break;case"word-cloud":note="Visualize audience responses as a dynamic word cloud.";break;case"up-down-vote":note="Participants respond to a question, then can upvote and downvote other answers. Great for gathering consensus.";break;case"clickable-image":note="Upload an image and ask a question. Participants click anywhere on the image to respond.";break;case"survey":note="Create a series of questions participants can answer at their own pace.";break;case"open-ended-text":note="Ask a question and let participants type in a free-form answer.";break;case"competition":note="Our newest poll type! Create a series of questions, then let participants compete to answer fastest.";break;default:note=""}return view.$_element("editor__note").length?view.$_element("editor__note").text(note):($note=$("<div class='component-activity-creator__editor__note'>"+note+"</div>"),view.$_element("editor").append($note)),view.$(".component-element-text-field__input").on("input focus blur",function(){var show;return show=1-view.$(".component-editor-title__format-help--show").length,view.$(".component-activity-creator__editor__note").css("opacity",show)})},PollEv.namespace("PollEv.Editor.View",function(View){var HIDE_700_RPP_MODAL_KEY,HIDE_NEW_PLANS_MODAL_KEY,HIDE_TM_MODAL_KEY,buildAdvisoryDisclaimer,createActivityCreator,getOptions,show700RppModal,showActivityCreator,showNewPlansBanner,showNewPlansModal,showNewPlansNotification,showTeamManagerModal,showUpsellBanner;return HIDE_NEW_PLANS_MODAL_KEY="hideNewPlansModal190415",HIDE_700_RPP_MODAL_KEY="hide700RppModal190415",HIDE_TM_MODAL_KEY="hideTeamManagerModal200325",getOptions=function(self,options){var activities,isMqa,ref,ref1,target;return null==options&&(options={}),isMqa=(target=options.target)&&(target instanceof PollEv.Model.Survey||target instanceof PollEv.Model.Competition),options=_.defaults(options,{navigate:!0,disclaimerText:self.app.user.get("image_upload_disclaimer"),showGrading:null!=(ref=self.app.user.get("features"))?ref.grading:void 0,showAltText:self.app.user.get("features").alt_text,pickerPreset:"synonyms"}),(activities=null!=(ref1=self.app.user.get("features"))?ref1.activities:void 0)&&(_.findKey(activities,function(val){return!val})&&(options.pickerPreset="activity"),options.pickerActivities={"multiple-choice":activities.multiple_choice_polls,"word-cloud":activities.free_text_polls,"up-down-vote":activities.discourses,"rank-order":activities.ranking_polls,competition:activities.competitions&&!isMqa,"clickable-image":activities.clickable_images,"open-ended-text":activities.free_text_polls,survey:activities.surveys&&!isMqa},options.pickerActivities["rank-order"]=!options.pickerActivities.competition),options},showActivityCreator=function(self,options){var target,view;return null==options&&(options={}),(target=(options=getOptions(self,options)).target)&&(target instanceof PollEv.Model.Survey||target instanceof PollEv.Model.Competition),view=createActivityCreator(self,options),showActivityNote(view,"multiple-choice"),options.type&&view.picker.select(options.type),self.app.user.get("activity_creation_disclaimer")&&view.$el.append(buildAdvisoryDisclaimer(self.app.user.get("activity_creation_disclaimer")).$el),view},buildAdvisoryDisclaimer=function(message){var advisoryDisclaimer;return(advisoryDisclaimer=new PollEv.Component.AdvisoryMessage({resolutionLabel:"I agree",icon:"error"})).on("resolve",function(){return this.remove()}),advisoryDisclaimer.render(),advisoryDisclaimer.$_element("message").html(message),advisoryDisclaimer},function(self,options){var view;return view=new PollEv.Component.Experimental.ActivityCreator.Gallery({group:options.target,picker:{defaultElement:"blank",elements:[{label:"Blank activities",identifier:"blank"},{label:"Large conferences",identifier:"large-event"},{label:"Small meetings",identifier:"small-event"},{label:"Interesting visuals",identifier:"visuals"},{label:"Icebreakers",identifier:"icebreakers"}]}}),self.modal.setContent(view),self.modal.open(),view.on("view:action",function(event,data){return null==data&&(data={}),self.app.trigger("view:action","gallery_activity_creator:"+event,_.defaults(data,options.trackingData))}),view.trigger("view:action","open",options.trackingData||{}),view.on("create",function(promise,group){return promise.then(function(model){var message;return(message=["Created"]).push(("function"==typeof model.cleanTitle?model.cleanTitle():void 0)||("function"==typeof model.get?model.get("title"):void 0)||"Activity"),null!=group&&(message.push("in"),message.push(group.get("name"))),self.notifyNotice(message.join(" ")),setTimeout(function(){return window.location.href=model.showUrl()},800)})}),view.on("error",function(message,data){return null==message&&(message="Unknown error"),null==data&&(data={}),"undefined"!=typeof rollbar&&null!==rollbar&&rollbar.error("ActivityCreatorError: "+message,data),message=function(){var ref;switch(null!=(ref=data.xhr)?ref.status:void 0){case 401:return message="You are currently logged out. Please log in to save these polls.";case 500:return message+=". Try logging in.";default:return message}}(),self.notifyError(message)})},createActivityCreator=function(self,options){var creatorOptions,isMqa,labelKey,targetModel,view;return(targetModel=options.target)?(labelKey=targetModel instanceof PollEv.Model.Group?"name":"title",creatorOptions={groups:new Backbone.Collection(targetModel),dropdown:{labelKey:labelKey},groupSelector:"dropdown",gropuSelectorVisible:!0,groupSelectorEnabled:!1}):(creatorOptions={groups:self.app.user.groups,groupSelector:"combobox",comboBox:{label:function(model){return model.get("name")}},groupSelectorEnabled:!0},self.app.user.groups.length>1?creatorOptions.groupSelectorVisible=!0:(creatorOptions.groupSelectorVisible=!1,creatorOptions.defaultGroup=self.app.user.groups.get(0))),isMqa=targetModel&&(targetModel instanceof PollEv.Model.Survey||targetModel instanceof PollEv.Model.Competition),creatorOptions=_.defaults({showGrading:options.showGrading,showAltText:options.showAltText,disclaimerText:options.disclaimerText,groups:options.groups,model:options.activity,pickerPreset:options.pickerPreset,pickerActivities:options.pickerActivities,pickerMode:options.pickerMode},creatorOptions),(view=new PollEv.Component.ActivityCreator(creatorOptions)).listenTo(creatorOptions.groups,"update",function(collection){return view.comboBox.collection.set(collection.models)}),self.modal.setContent(view),self.modal.open(),self.modal.$el.find(".component-picker__btn--active").focus(),targetModel&&view.dropdown.select(targetModel.id),view.on("view:action",function(event,data){return null==data&&(data={}),self.app.trigger("view:action","activity_creator:"+event,_.defaults(data,options.trackingData),{immediate:!0})}),view.picker.on("select",function(data){return showActivityNote(view,data.identifier)}),view.trigger("view:action","open",options.trackingData||{}),view.on("create",function(model,group,addingMore){var groupId,message,ref,ref1;return isMqa?targetModel.polls.add(model):(groupId=group&&group.get("id")||model.get("group_id")||-1,null!=(ref=self.app.user.view)&&null!=(ref1=ref.groups.get(groupId))&&ref1.activities.add(model)),addingMore?view.reset():window.location.href=model.showUrl(),(message=["Created"]).push(("function"==typeof model.cleanTitle?model.cleanTitle():void 0)||("function"==typeof model.get?model.get("title"):void 0)||"Activity"),null!=group&&(message.push("in"),message.push(group.get("name"))),self.notifyNotice(message.join(" "))}),view.on("error",function(message,data){var $modal,$target,padding,scrollTop;return null==message&&(message="Unknown error"),null==data&&(data={}),"undefined"!=typeof rollbar&&null!==rollbar&&rollbar.error("ActivityCreatorError: "+message,data),$modal=self.modal.$el,"survey"===view.$(".component-picker__btn--active").data("identifier")?(0===($target=view.$("[class*=--error]").first().closest(".component-editor-activity-transformer__editor-container")).length&&($target=view.$("[class*=--error]").eq(0)),0===$target.length&&($target=view.$el)):$target=view.$("[class*=--error]").eq(0),$target.length&&(scrollTop=$modal.scrollTop()-$modal.offset().top+$target.offset().top,padding=8,$modal[0].scrollTop=scrollTop-padding),function(){var ref;switch(null!=(ref=data.xhr)?ref.status:void 0){case 401:return message="You are currently logged out. Please log in to save these polls.";case 500:return message+=". Try logging in.";default:return message}}()})},function(self,poll,survey){var params;return params={target_type:"survey",target_id:survey.get("id"),target_user_id:self.app.user.get("id")},Backbone.ajax("/api/polls/"+poll.get("id")+"/position",{method:"put",data:JSON.stringify(params),contentType:"application/json"}).fail(function(){var $reloadLink;return $reloadLink=$("<a />").attr("href",window.location.href).text("Please refresh to see the latest."),self.app.trigger("notify:error",$reloadLink)}).then(function(){return survey.polls.add(poll)})},function(user){return Date.parse("2018-09-10")<=Date.parse(user.get("created_at"))},showNewPlansBanner=function(self,fadeIn){var banner;if((banner=new PollEv.Component.Notification({mode:"banner-alert",autoHideAfter:-1,primaryLabel:"Change your plan"})).render(),banner.$el.addClass("new-plans-banner"),fadeIn&&banner.$el.addClass("new-plans-banner__fadein"),banner.$('[name="dismiss"]').remove(),$(".header.polls-bulk-controls").before(banner.$el),banner.warning("<b>New plans have arrived</b><br />You can now receive 700 responses per activity if you change to a new paid plan. Availability of some features will change. Learn more at our <a href='/plans/faq?utm_source=app&utm_medium=banner' target='_blank' data-cutlass-event='new_plans_banner:faq:click'>FAQ</a> or change your plan."),banner.on("click:primary",function(){return self.app.trigger("view:action","new_plans_banner:choose_plan:click",{},{immediate:!0}),window.location.href="/new-plans?utm_source=app&utm_medium=banner"}),fadeIn)return setTimeout(function(){return banner.$el.removeClass("new-plans-banner__fadein")},100)},showNewPlansModal=function(self){var modal,ref;return null!=(ref=self.newPlansModal)&&ref.remove(),self.newPlansModal=new PollEv.Component.Modal.Dialog({size:"small",header:{show:!0,title:"New plans have arrived"},actions:{primary:"Change your plan",secondary:"Read the FAQ"}}),(modal=self.newPlansModal).$el.addClass("feature-announcement"),modal.setContent('<div class="image">\n  <img src="'+editor_images.new_plans_modal.banner+'" width="740" height="340" alt="New plans" />\n</div>\n<p>Our new plans have arrived! You can now receive 700 responses per activity if you switch to a new paid plan. Availability of some features will change. See the FAQ for details.</p>'),self.listenTo(modal,"close:complete",function(){self.app.trigger("view:action","new_plans:modal:close"),showNewPlansBanner(self,!0);try{return localStorage.setItem(HIDE_NEW_PLANS_MODAL_KEY,1)}catch(error){}}),self.listenTo(modal,"click:secondary",function(){return window.open("/plans/faq?utm_source=app&utm_medium=popup"),self.app.trigger("view:action","new_plans:modal:faq")}),self.listenToOnce(modal,"click:primary",function(){self.app.trigger("view:action","new_plans:modal:review");try{localStorage.setItem(HIDE_NEW_PLANS_MODAL_KEY,1)}catch(error){}return modal.close(),modal.remove(),window.location.href="/new-plans?utm_source=app&utm_medium=popup"}),self.$el.append(modal.$el),modal.open()},showTeamManagerModal=function(self){var modal,ref;if($.meta("team-manager-enabled")&&!(sessionStorage.getItem(HIDE_TM_MODAL_KEY)||localStorage.getItem(HIDE_TM_MODAL_KEY)))return null!=(ref=self.teamManagerModal)&&ref.remove(),self.teamManagerModal=new PollEv.Component.Modal.Dialog({size:"small",header:{show:!0,title:"New user role available: Team manager"},actions:{primary:"Assign team managers",secondary:"Learn more"}}),(modal=self.teamManagerModal).$el.addClass("feature-announcement"),modal.setContent('<div class="image">\n  <img src="'+editor_images.team_manager_modal.banner+'" width="740" height="340" alt="New plans" />\n</div>\n<p>Designate users as Team managers to allow them to add or remove presenters from their assigned teams. </p>'),self.listenTo(modal,"close:complete",function(){self.app.trigger("view:action","team_manager:modal:close");try{return localStorage.setItem(HIDE_TM_MODAL_KEY,1)}catch(error){}}),self.listenTo(modal,"click:secondary",function(){return window.open("/support/articles/account-management/teams#acting-as-a-team-manager"),self.app.trigger("view:action","team_manager:modal:support_article")}),self.listenToOnce(modal,"click:primary",function(){self.app.trigger("view:action","team_manager:modal:assign_managers");try{localStorage.setItem(HIDE_TM_MODAL_KEY,1)}catch(error){}return modal.close(),modal.remove(),window.location.href="/teams?utm_source=app&utm_medium=popup"}),self.$el.append(modal.$el),modal.open()},showNewPlansNotification=function(self){var hideFeatureModal;if($.meta("eligible-for-early-pricing3-plan-change")){try{hideFeatureModal=sessionStorage.getItem(HIDE_NEW_PLANS_MODAL_KEY)||localStorage.getItem(HIDE_NEW_PLANS_MODAL_KEY)}catch(error){}return hideFeatureModal?showNewPlansBanner(self):showNewPlansModal(self)}},show700RppModal=function(self){var hideFeatureModal,modal,ref;if($.meta("account-bumped-to-700rpp-for-pricing3")){null!=(ref=self.pt3RppAwardModal)&&ref.remove();try{hideFeatureModal=sessionStorage.getItem(HIDE_700_RPP_MODAL_KEY)||localStorage.getItem(HIDE_700_RPP_MODAL_KEY)}catch(error){}if(!hideFeatureModal)return self.pt3RppAwardModal=new PollEv.Component.Modal.Dialog({size:"small",header:{show:!0,title:"Announcing 700 responses for all activities"},actions:{primary:"Continue"}}),(modal=self.pt3RppAwardModal).$el.addClass("feature-announcement"),modal.setContent('<div class="image">\n  <img src="'+editor_images.seven_hundred_rpp_modal.banner+'" width="740" height="340" alt="New plans" />\n</div>\n<p>This account now includes 700 responses for all new and existing activities. Enjoy live feedback from larger audiences than ever before.</p>'),self.listenTo(modal,"close:complete",function(){self.app.trigger("view:action","pricing3_700_rpp:modal:close");try{localStorage.setItem(HIDE_700_RPP_MODAL_KEY,1)}catch(error){}return modal.close(),modal.remove()}),self.listenToOnce(modal,"click:primary",function(){self.app.trigger("view:action","pricing3_700_rpp:modal:ok");try{localStorage.setItem(HIDE_700_RPP_MODAL_KEY,1)}catch(error){}return modal.close(),modal.remove()}),self.$el.append(modal.$el),modal.open()}},showUpsellBanner=function(self){if($.meta("upsell-banner-segment"))switch(self.upsell=new PollEv.Component.Notification({mode:"banner-alert",autoHideAfter:-1,primaryLabel:"View plans"}),self.upsell.render(),self.upsell.$el.addClass("upsell-banner"),self.upsell.$('[name="dismiss"]').remove(),$(".header.polls-bulk-controls").before(self.upsell.$el),$.meta("upsell-banner-segment")){case"higher_ed":return self.upsell.notice("Your current plan includes 40 responses per activity. Upgrade now to unlock 700 responses per activity, plus other popular features such as reporting and customizable visual settings."),self.upsell.on("click:primary",function(){return self.app.trigger("view:action","upsell_banner:higher_ed:click",{},{immediate:!0}),window.location.href="/plans/higher-ed?source=upsell_banner_higher_ed"});case"k12":return self.upsell.notice("Your current plan includes 40 responses per activity. Upgrade now to unlock 700 responses per activity, plus other popular features such as reporting and customizable visual settings."),self.upsell.on("click:primary",function(){return self.app.trigger("view:action","upsell_banner:k12:click",{},{immediate:!0}),window.location.href="/plans/k-12?source=upsell_banner_k12"});case"business":return self.upsell.notice("Your current plan includes 25 responses per activity. Upgrade now to unlock 700 responses per activity, plus other popular features such as reporting and customizable visual settings."),self.upsell.on("click:primary",function(){return self.app.trigger("view:action","upsell_banner:biz:click",{},{immediate:!0}),window.location.href="/plans?source=upsell_banner"})}},View.AppView=function(superClass){function AppView(){return this.showImporter=bind(this.showImporter,this),this.showMagicBar=bind(this.showMagicBar,this),this.setupGenesisModalStyles=bind(this.setupGenesisModalStyles,this),this.remove=bind(this.remove,this),this.notifySuccess=bind(this.notifySuccess,this),this.notifyNotice=bind(this.notifyNotice,this),this.notifyError=bind(this.notifyError,this),this.notifyClear=bind(this.notifyClear,this),this.render=bind(this.render,this),AppView.__super__.constructor.apply(this,arguments)}return extend(AppView,superClass),AppView.prototype.events={"click .new-poll.close":function(e){return e.preventDefault(),this.modal.close()},"click .new-poll:not(.close)":function(e){return e.preventDefault(),/\/my\/polls/.test(URI().path())?showActivityCreator(this):window.location.href="/my/polls/new"},"click .import-polls":function(e){return e.preventDefault(),/\/my\/polls/.test(URI().path())?this.showImporter():window.location.href="/my/polls/import"}},AppView.prototype.appEvents={create_poll:function(options){return showActivityCreator(this,options)},"notify:notice":"notifyNotice","notify:success":"notifySuccess","notify:error":"notifyError","notify:clear":"notifyClear"},AppView.prototype.initialize=function(){var _this;return this.nav={primary:this.$("#main_menu"),secondary:this.$("#navigation")},this.content=this.$("#content"),this.sidebar=this.$("#sidebar"),this.columns=this.$("#main"),this.modal=new PollEv.Component.Modal.Dialog({size:"large",header:{show:!1},footer:{show:!1},ignoreCloseOn:{backdrop:!0,escape:!1}}),this.notification=new PollEv.Component.Notification({mode:"toast"}),$("body").addClass("genesis"),this.listenTo(this.modal,"open",(_this=this,function(){var ref;return null!=(ref=_this.upsell)&&ref.$_toggleModifier(null,_this.upsell.className,"hidden",!0),_this.setupGenesisModalStyles(),_this.$(".new-poll").addClass("close"),_this.modal.subView.trigger("view:action","open")})),this.listenTo(this.modal,"close",function(_this){return function(){var ref;return null!=(ref=_this.upsell)&&ref.$_toggleModifier(null,_this.upsell.className,"hidden",!1),$("body").toggleClass("s-genesis-modal",!1),_this.$(".new-poll.close").removeClass("close"),_this.notification.dismiss(),_this.modal.subView.trigger("view:action","close"),_this.modal.setContent()}}(this))},AppView.prototype.render=function(view){var ref;return null!=(ref=this.currentView)&&ref.remove(),this.currentView=view,this.content.html(view.render().$el),this.$("#notice").append(this.notification.render().$el),showNewPlansNotification(this),show700RppModal(this),showUpsellBanner(this),showTeamManagerModal(this),this},AppView.prototype.notifyClear=function(){return this.notification.dismiss()},AppView.prototype.notifyError=function(msg,options){return $("body").addClass("genesis"),this.notification.error(msg,options)},AppView.prototype.notifyNotice=function(msg,options){return $("body").addClass("genesis"),this.notification.notice(msg,options)},AppView.prototype.notifySuccess=function(msg,options){return $("body").addClass("genesis"),this.notification.success(msg,options)},AppView.prototype.remove=function(){return AppView.__super__.remove.apply(this,arguments),this.modal.remove()},AppView.prototype.setupGenesisModalStyles=function(){return $("body").addClass("s-genesis-modal"),this.$(".polls-bulk-controls").is(".fixed")?this.modal.$el.css({top:"56px"}):($(window).scrollTop(0),this.modal.$el.css({top:""})),this.modal.$el.addClass("genesis-modal")},AppView.prototype.showMagicBar=function(e,options){return null==options&&(options={}),null!=e&&e.preventDefault(),showActivityCreator(this,options)},AppView.prototype.showImporter=function(e){var ref,view,_this;return null!=e&&e.preventDefault(),view=new PollEv.Component.ActivityImporter({showGrading:null!=(ref=this.app.user.get("features"))?ref.grading:void 0,groups:this.app.user.groups}),this.modal.$el.addClass("activity-importer-modal"),this.modal.setContent(view),this.modal.open(),this.app.user.get("activity_creation_disclaimer")&&view.$el.append(buildAdvisoryDisclaimer(this.app.user.get("activity_creation_disclaimer")).$el),view.on("view:action",(_this=this,function(event,data){return null==data&&(data={}),_this.app.trigger("view:action","activity_importer:"+event,data)})),view.on("error",function(_this){return function(message,data){var $content,$target,padding,ref1,scrollTop;return null==data&&(data={}),"undefined"!=typeof rollbar&&null!==rollbar&&rollbar.error("ActivityImporterError: "+message,data),$content=view.$(".component-activity-importer__content"),($target=view.$("[class*=--error]").first().closest(".component-editor-activity-transformer__editor-container")).length||($target=view.$("[class*=--error]").eq(0)),$target.length||($target=view.$(".component-activity-importer__processor--save-fail").eq(0)),$target.length&&(scrollTop=$content.scrollTop()-$content.offset().top+(null!=(ref1=$target.offset())?ref1.top:void 0),padding=8,$content[0].scrollTop=scrollTop-padding),message=function(){var ref2;switch(null!=(ref2=data.xhr)?ref2.status:void 0){case 401:return message="You are currently logged out. Please log in to save these polls.";default:return message}}(),_this.notification.error(message)}}(this)),view.on("progress",function(_this){return function(model){return _this.app.user.trigger("activity:add",model.clone())}}(this)),view.on("close",function(_this){return function(){return _this.modal.$el.removeClass("activity-importer-modal"),_this.modal.close()}}(this))},AppView}(PollEv.View.Base)})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/my_polls/bulk_action_collapsible_container"]=function(){return function(context){return function(){var $o;return($o=[]).push("<h2 js-title></h2>\n<div class='multi-edit-panels'></div>\n<div class='multi-edit-apply'>\n  <button class='element-button element-button-primary' js-apply>\n    Apply to\n    <span js-selected-count></span>\n    <span js-pluralized></span>\n  </button>\n  <a class='cancel element-button element-button--link' js-cancel href='#'>cancel\x92\x91</a>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(context)}}.call(this)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){var attrNotPresent,pluckId,purgeCompetitionsFromGroups,purgePollsFromGroups,purgePollsFromSurveys,purgeSurveysFromGroups,withoutAttr;return pluckId=function(xs){return _.pluck(xs,"id")},attrNotPresent=function(xs,attr){return function(obj){return!_.contains(xs,obj.get(attr))}},withoutAttr=function(xs,attrCollection,attr){return _.filter(xs,attrNotPresent(attrCollection,attr))},purgeSurveysFromGroups=function(groupIds,surveys){return withoutAttr(surveys,groupIds,"group_id")},purgePollsFromGroups=function(groupIds,polls){return withoutAttr(polls,groupIds,"group_id")},purgePollsFromSurveys=function(surveyIds,polls){return withoutAttr(polls,surveyIds,"survey_id")},purgeCompetitionsFromGroups=function(groupIds,competitions){return withoutAttr(competitions,groupIds,"group_id")},MultiEdit.BulkActionCollapsibleContainer=function(superClass){function BulkActionCollapsibleContainer(){return this.render=bind(this.render,this),this.appendPanel=bind(this.appendPanel,this),this.toggle=bind(this.toggle,this),this.apply=bind(this.apply,this),this.updateSelectedActivities=bind(this.updateSelectedActivities,this),this.prepareActivityIds=bind(this.prepareActivityIds,this),this.activitiesCount=bind(this.activitiesCount,this),this.modelIds=bind(this.modelIds,this),BulkActionCollapsibleContainer.__super__.constructor.apply(this,arguments)}return extend(BulkActionCollapsibleContainer,superClass),BulkActionCollapsibleContainer.prototype.className="multi-edit-container",BulkActionCollapsibleContainer.prototype.events={"click [js-apply]":"apply","click [js-cancel]":"toggle"},BulkActionCollapsibleContainer.prototype.initialize=function(opts){return this.model=new PollEv.Model.BulkEdit({users:this.app.users}),this.users=opts.users,this.model.competitions=[],this.model.polls=[],this.model.surveys=[],this.model.groups=[],this.panelTitle=""},BulkActionCollapsibleContainer.prototype.modelIds=function(){var competitions,groups,polls,surveys,_this;return groups=pluckId(this.model.groups),surveys=[],polls=[],competitions=[],this.model.surveys.forEach(function(model){if(!_.contains(groups,model.get("group_id")))return surveys.push(model.id)}),this.model.polls.forEach((_this=this,function(model){var groupId,ref,selectedSurveyIds,surveyId;if(groupId=null!=(ref=model.get("group_id"))?ref:-1,surveyId=model.get("survey_id")){if(selectedSurveyIds=pluckId(_this.model.surveys),!_.contains(selectedSurveyIds,surveyId))return polls.push(model.id)}else if(groupId&&!_.contains(groups,groupId))return polls.push(model.id)})),this.model.competitions.forEach(function(model){var groupId;if((groupId=model.get("group_id"))&&!_.contains(groups,groupId))return competitions.push(model.id)}),{competition_ids:competitions,poll_ids:polls,survey_ids:surveys,group_ids:groups}},BulkActionCollapsibleContainer.prototype.activitiesCount=function(){var count,groupIds,surveyIds;return count=this.model.groups.reduce(function(count,group){return count+group.get("activities_count")},0),groupIds=pluckId(this.model.groups),surveyIds=pluckId(this.model.surveys),this.model.surveys.forEach(function(model){if(groupIds.indexOf(model.get("group_id"))<0)return count+=1}),this.model.polls.concat(this.model.competitions).forEach(function(model){if(groupIds.indexOf(model.get("group_id"))<0&&surveyIds.indexOf(model.get("survey_id"))<0)return count+=1}),count},BulkActionCollapsibleContainer.prototype.prepareActivityIds=function(){var competitions,groupIds,pollIds,polls,surveyIds,surveys;return groupIds=pluckId(this.model.groups),surveys=purgeSurveysFromGroups(groupIds,this.model.surveys),surveyIds=pluckId(surveys),polls=purgePollsFromGroups(groupIds,this.model.polls),polls=purgePollsFromSurveys(surveyIds,polls),pollIds=pluckId(polls),competitions=purgeCompetitionsFromGroups(groupIds,this.model.competitions),this.model.set({id:pollIds.join(","),selected_group_ids:groupIds.join(","),poll_ids:pollIds,competition_ids:pluckId(competitions),group_ids:groupIds,survey_ids:surveyIds,target_user_ids:this.model.get("subuser_ids")})},BulkActionCollapsibleContainer.prototype.updateSelectedActivities=function(activities){var count;return null==activities&&(activities={}),_.defaults(activities,{competitions:[],polls:[],surveys:[],groups:[]}),this.model.competitions=activities.competitions,
this.model.polls=activities.polls,this.model.surveys=activities.surveys,this.model.groups=activities.groups,count=this.activitiesCount(),this.$("[js-selected-count]").text(count),this.$("[js-pluralized]").text(PollEv.Util.pluralize(count,"activity")),this.model.trigger("change","selected activities")},BulkActionCollapsibleContainer.prototype.apply=function(){var _this;if(this.activitiesCount()){if(!_.reject(this.subViews,function(view){return!view.validate||view.validate()}).length){if(!_.isEmpty(this.model.attributes))return this.performAction(this).always((_this=this,function(){return _this.$el.slideUp()}));PollEv.Component.Modal.alert("Looks like you don\u2019t have any changes to apply yet. Click cancel if you\u2019ve changed your mind.",{simpleTitle:"Select changes"})}}else PollEv.Component.Modal.alert("You need to select activities to apply changes to.",{simpleTitle:"Select activities"})},BulkActionCollapsibleContainer.prototype.toggle=function(){return this.$el.slideToggle()},BulkActionCollapsibleContainer.prototype.appendPanel=function(view){return this.appendView(".multi-edit-panels",view)},BulkActionCollapsibleContainer.prototype.render=function(){return this.$el.hide(),this.renderTemplate("templates/my_polls/bulk_action_collapsible_container"),this.$("[js-title]").text(this.panelTitle),this},BulkActionCollapsibleContainer}(PollEv.View.Base)})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){var copyActivitiesToGroup,copyActivitiesToUser;return copyActivitiesToGroup=function(self,groupId){if(self.model.has("group_id"))return $.Deferred(function(deferred){var data,job,url;return data=self.modelIds(),url="/api/activities/copy/to_group/"+groupId,(job=PollEv.RailsApp.Util.makeJob(data,url,"move to group")).on("complete",function(){return self.trigger("update:group",groupId),self.app.trigger("view:action","my_polls:bulk_copy_success",{user_ids:self.app.user.id,poll_ids:self.model.get("poll_ids")},{immediate:!0}),deferred.resolve()}),job.on("fail",deferred.reject)})},copyActivitiesToUser=function(self){var ref;if(null!=(ref=self.model.get("target_user_ids"))?ref.length:void 0)return $.Deferred(function(deferred){var data,job,url;return data=_.extend(self.modelIds(),self.model.pick("target_user_ids")),url="/api/activities/copy",(job=PollEv.RailsApp.Util.makeJob(data,url,"copy")).on("complete",function(data){var groups;return groups=data.map(function(json){var group;return(group=new PollEv.Model.Group(json)).activities.add(json.activities),group}),self.trigger("new:groups",groups),self.app.trigger("view:action","my_polls:bulk_copy_success",{user_ids:self.model.get("target_user_ids"),poll_ids:self.model.get("poll_ids")},{immediate:!0}),deferred.resolve()}),job.on("fail",deferred.reject)})},MultiEdit.Copy=function(superClass){function Copy(){return this.performAction=bind(this.performAction,this),this.confirm=bind(this.confirm,this),this.render=bind(this.render,this),Copy.__super__.constructor.apply(this,arguments)}return extend(Copy,superClass),Copy.prototype.initialize=function(){return Copy.__super__.initialize.apply(this,arguments),this.copyPollPanel=new MultiEdit.CopyPollPanel({model:this.model}),this.panelTitle="Copy"},Copy.prototype.render=function(){return Copy.__super__.render.apply(this,arguments),this.appendPanel(this.copyPollPanel),this},Copy.prototype.confirm=function(){var count,message,pluralizedItem,ref,ref1,toAllSelected,toGroupSelected,toTarget,usersSelected;return usersSelected=null!=(ref=this.copyPollPanel.userCombobox)?ref.collection.length:void 0,toAllSelected=this.copyPollPanel.$(".multi-edit-copy-to-all input[type=radio]").is(":checked"),toTarget=(toGroupSelected=null!=(ref1=this.copyPollPanel.groupCombobox)?ref1.getSelected():void 0)?" to group <strong>"+toGroupSelected.get("name")+"</strong>.":toAllSelected?" <strong>to all users on the account</strong>.":usersSelected?" to <strong>the selected users</strong>.":".",message="<p>You selected <strong>"+(count=this.activitiesCount())+"</strong> "+(pluralizedItem=PollEv.Util.pluralize(count,"activity",{includeNumber:!1}))+". Click 'Apply' to copy the selected "+pluralizedItem+toTarget+"</p>\n<p>Responses are not included.</p>",PollEv.Component.Modal.confirm(message,{simpleTitle:"Confirm copy",allowHtml:!0,actions:{primary:"Apply"}})},Copy.prototype.performAction=function(){return this.confirm().then((_this=this,function(){var copyToGroup,copyToUser;return _this.trigger("job:start"),_this.prepareActivityIds(),copyToUser=copyActivitiesToUser(_this,_this.model.get("owner_id")),copyToGroup=copyActivitiesToGroup(_this,_this.model.get("group_id")),$.when(copyToUser,copyToGroup).fail(function(){return 1<=arguments.length&&slice.call(arguments,0),PollEv.Component.Modal.alert("An error occurred. Please try again.",{simpleTitle:"Copy activities"})}).always(function(){var ref,ref1,ref2,ref3,ref4,ref5;return _this.trigger("job:done"),_this.copyPollPanel.$(":radio").prop("checked",!1),_this.copyPollPanel.$(".multi-edit-copy-to-user__list").empty(),null!=(ref=_this.copyPollPanel.userCombobox)&&ref.collection.set([]),null!=(ref1=_this.copyPollPanel.userCombobox)&&ref1.clearSelected(),null!=(ref2=_this.copyPollPanel.userCombobox)&&ref2.$("input").val(""),null!=(ref3=_this.copyPollPanel.groupCombobox)&&ref3.collection.set([]),null!=(ref4=_this.copyPollPanel.groupCombobox)&&ref4.clearSelected(),null!=(ref5=_this.copyPollPanel.groupCombobox)&&ref5.$("input").val(""),_this.copyPollPanel.selectedUsers.set([])})}));var _this},Copy}(MultiEdit.BulkActionCollapsibleContainer)})}.call(this),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.shuffle=e()}(this,function(){"use strict";function t(t,e){if(b)return b.call(t,e);for(var i=t.parentNode.querySelectorAll(e),n=0;n<i.length;n++)if(i[n]==t)return!0;return!1}function e(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var n in i)L.call(i,n)&&(t[n]=i[n])}return t}function i(t,e){function i(){r=0,l=+new Date,o=t.apply(n,s),n=null,s=null}var n,s,o,r,l=0;return function(){n=this,s=arguments;var t=new Date-l;return r||(t>=e?i():r=setTimeout(i,e-t)),o}}function n(){}function s(t){return parseFloat(t)||0}function o(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.getComputedStyle(t,null),n=s(i[e]);return W||"width"!==e?W||"height"!==e||(n+=s(i.paddingTop)+s(i.paddingBottom)+s(i.borderTopWidth)+s(i.borderBottomWidth)):n+=s(i.paddingLeft)+s(i.paddingRight)+s(i.borderLeftWidth)+s(i.borderRightWidth),n}function r(t){for(var e=t.length;e;){e-=1;var i=Math.floor(Math.random()*(e+1)),n=t[i];t[i]=t[e],t[e]=n}return t}function l(t,e){var i=w(R,e),n=[].slice.call(t),s=!1;return t.length?i.randomize?r(t):("function"==typeof i.by&&t.sort(function(t,e){if(s)return 0;var n=i.by(t[i.key]),o=i.by(e[i.key]);return void 0===n&&void 0===o?(s=!0,0):n<o||"sortFirst"===n||"sortLast"===o?-1:n>o||"sortLast"===n||"sortFirst"===o?1:0}),s?n:(i.reverse&&t.reverse(),t)):[]}function a(){return q+(P+=1)}function u(t){return!!H[t]&&(H[t].element.removeEventListener(q,H[t].listener),H[t]=null,!0)}function h(t,e){var i=a(),n=function(t){t.currentTarget===t.target&&(u(i),e(t))};return t.addEventListener(q,n),H[i]={element:t,listener:n},i}function f(t){return Math.max.apply(Math,t)}function c(t){return Math.min.apply(Math,t)}function d(t,e,i,n){var s=t/e;return Math.abs(Math.round(s)-s)<n&&(s=Math.round(s)),Math.min(Math.ceil(s),i)}function m(t,e,i){if(1===e)return t;for(var n=[],s=0;s<=i-e;s++)n.push(f(t.slice(s,s+e)));return n}function v(t,e){for(var i=c(t),n=0,s=t.length;n<s;n++)if(t[n]>=i-e&&t[n]<=i+e)return n;return 0}function p(t){for(var e=t.itemSize,i=t.positions,n=t.gridSize,s=t.total,o=t.threshold,r=t.buffer,l=d(e.width,n,s,o),a=m(i,l,s),u=v(a,r),h=new A(Math.round(n*u),Math.round(a[u])),f=a[u]+e.height,c=0;c<l;c++)i[u+c]=f;return h}function y(t){return Array.prototype.slice.call(t)}function g(t,e){return t.indexOf(e)>-1}try{var _=new window.CustomEvent("test");if(_.preventDefault(),!0!==_.defaultPrevented)throw new Error("Could not prevent default")}catch(t){var E=function(t,e){var i,n;return e=e||{bubbles:!1,cancelable:!1,detail:void 0},(i=document.createEvent("CustomEvent")).initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n=i.preventDefault,i.preventDefault=function(){n.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:function(){return!0}})}catch(t){this.defaultPrevented=!0}},i};E.prototype=window.Event.prototype,window.CustomEvent=E}var S=Element.prototype,b=S.matches||S.matchesSelector||S.webkitMatchesSelector||S.mozMatchesSelector||S.msMatchesSelector||S.oMatchesSelector,I=t,k="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},T=function(t,e){return t(e={exports:{}},e.exports),e.exports}(function(t){function e(t){for(var e=[],i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}function i(t){var e=new Set;return t.filter(function(t){return!e.has(t)&&(e.add(t),!0)})}function n(t){var e=[];return new Set(t).forEach(function(t){e.push(t)}),e}"Set"in k?"function"==typeof Set.prototype.forEach&&function(){var t=!1;return new Set([!0]).forEach(function(e){t=e}),!0===t}()?t.exports=n:t.exports=i:t.exports=e}),w=e,L=Object.prototype.hasOwnProperty,C=i,z=function(t,e,i){function s(t){return function(e,n){if(!r){if(e)return i(e,l),void(r=!0);l[t]=n,--o||i(null,l)}}}i||("function"==typeof e?(i=e,e=null):i=n);var o=t&&t.length;if(!o)return i(null,[]);var r=!1,l=new Array(o);t.forEach(e?function(t,i){t.call(e,s(i))}:function(t,e){t(s(e))})},D=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},M=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),A=function(){function t(e,i){D(this,t),this.x=s(e),this.y=s(i)}return M(t,null,[{key:"equals",value:function(t,e){return t.x===e.x&&t.y===e.y}}]),t}(),F={BASE:"shuffle",SHUFFLE_ITEM:"shuffle-item",VISIBLE:"shuffle-item--visible",HIDDEN:"shuffle-item--hidden"},x=0,B=function(){function t(e){D(this,t),x+=1,this.id=x,this.element=e,this.isVisible=!0}return M(t,[{key:"show",value:function(){this.isVisible=!0,this.element.classList.remove(F.HIDDEN),this.element.classList.add(F.VISIBLE)}},{key:"hide",value:function(){this.isVisible=!1,this.element.classList.remove(F.VISIBLE),this.element.classList.add(F.HIDDEN)}},{key:"init",value:function(){this.addClasses([F.SHUFFLE_ITEM,F.VISIBLE]),this.applyCss(t.Css.INITIAL),this.scale=t.Scale.VISIBLE,this.point=new A}},{key:"addClasses",value:function(t){var e=this;t.forEach(function(t){e.element.classList.add(t)})}},{key:"removeClasses",value:function(t){var e=this;t.forEach(function(t){e.element.classList.remove(t)})}},{key:"applyCss",value:function(t){var e=this;Object.keys(t).forEach(function(i){e.element.style[i]=t[i]})}},{key:"dispose",value:function(){this.removeClasses([F.HIDDEN,F.VISIBLE,F.SHUFFLE_ITEM]),this.element.removeAttribute("style"),this.element=null}}]),t}();B.Css={INITIAL:{position:"absolute",top:0,left:0,visibility:"visible","will-change":"transform"},VISIBLE:{before:{opacity:1,visibility:"visible"},after:{}},HIDDEN:{before:{opacity:0},after:{visibility:"hidden"}}},B.Scale={VISIBLE:1,HIDDEN:.001};var O=document.body||document.documentElement,V=document.createElement("div");V.style.cssText="width:10px;padding:2px;box-sizing:border-box;",O.appendChild(V);var W="10px"===window.getComputedStyle(V,null).width;O.removeChild(V);var R={reverse:!1,by:null,randomize:!1,key:"element"},H={},q="transitionend",P=0,U=0,Y=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};D(this,t),this.options=w(t.options,i),this.useSizer=!1,this.lastSort={},this.group=t.ALL_ITEMS,this.lastFilter=t.ALL_ITEMS,this.isEnabled=!0,this.isDestroyed=!1,this.isInitialized=!1,this._transitions=[],this.isTransitioning=!1,this._queue=[];var n=this._getElementOption(e);if(!n)throw new TypeError("Shuffle needs to be initialized with an element.");this.element=n,this.id="shuffle_"+U,U+=1,this._init(),this.isInitialized=!0}return M(t,[{key:"_init",value:function(){this.items=this._getItems(),this.options.sizer=this._getElementOption(this.options.sizer),this.options.sizer&&(this.useSizer=!0),this.element.classList.add(t.Classes.BASE),this._initItems(),this._onResize=this._getResizeFunction(),window.addEventListener("resize",this._onResize);var e=window.getComputedStyle(this.element,null),i=t.getSize(this.element).width;this._validateStyles(e),this._setColumns(i),this.filter(this.options.group,this.options.initialSort),this.element.offsetWidth,this._setTransitions(),this.element.style.transition="height "+this.options.speed+"ms "+this.options.easing}},{key:"_getResizeFunction",value:function(){var t=this._handleResize.bind(this);return this.options.throttle?this.options.throttle(t,this.options.throttleTime):t}},{key:"_getElementOption",value:function(t){return"string"==typeof t?this.element.querySelector(t):t&&t.nodeType&&1===t.nodeType?t:t&&t.jquery?t[0]:null}},{key:"_validateStyles",value:function(t){"static"===t.position&&(this.element.style.position="relative"),"hidden"!==t.overflow&&(this.element.style.overflow="hidden")}},{key:"_filter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.lastFilter,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.items,i=this._getFilteredSets(t,e);return this._toggleFilterClasses(i),this.lastFilter=t,"string"==typeof t&&(this.group=t),i}},{key:"_getFilteredSets",value:function(e,i){var n=this,s=[],o=[];return e===t.ALL_ITEMS?s=i:i.forEach(function(t){n._doesPassFilter(e,t.element)?s.push(t):o.push(t)}),{visible:s,hidden:o}}},{key:"_doesPassFilter",value:function(e,i){function n(t){return g(o,t)}if("function"==typeof e)return e.call(i,i,this);var s=i.getAttribute("data-"+t.FILTER_ATTRIBUTE_KEY),o=this.options.delimeter?s.split(this.options.delimeter):JSON.parse(s);return Array.isArray(e)?this.options.filterMode===t.FilterMode.ANY?e.some(n):e.every(n):g(o,e)}},{key:"_toggleFilterClasses",value:function(t){var e=t.visible,i=t.hidden;e.forEach(function(t){t.show()}),i.forEach(function(t){t.hide()})}},{key:"_initItems",value:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.items).forEach(function(t){t.init()})}},{key:"_disposeItems",value:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.items).forEach(function(t){t.dispose()})}},{key:"_updateItemCount",value:function(){this.visibleItems=this._getFilteredItems().length}},{key:"_setTransitions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.items,e=this.options.speed,i=this.options.easing,n=this.options.useTransforms?"transform "+e+"ms "+i+", opacity "+e+"ms "+i:"top "+e+"ms "+i+", left "+e+"ms "+i+", opacity "+e+"ms "+i;t.forEach(function(t){t.element.style.transition=n})}},{key:"_getItems",value:function(){var t=this;return y(this.element.children).filter(function(e){return I(e,t.options.itemSelector)}).map(function(t){return new B(t)})}},{key:"_updateItemsOrder",value:function(){var t=this.element.children;this.items=l(this.items,{by:function(e){return Array.prototype.indexOf.call(t,e)}})}},{key:"_getFilteredItems",value:function(){return this.items.filter(function(t){return t.isVisible})}},{key:"_getConcealedItems",value:function(){return this.items.filter(function(t){return!t.isVisible})}},{key:"_getColumnSize",value:function(e,i){var n=void 0;return 0===(n="function"==typeof this.options.columnWidth?this.options.columnWidth(e):this.useSizer?t.getSize(this.options.sizer).width:this.options.columnWidth?this.options.columnWidth:this.items.length>0?t.getSize(this.items[0].element,!0).width:e)&&(n=e),n+i}},{key:"_getGutterSize",value:function(t){return"function"==typeof this.options.gutterWidth?this.options.gutterWidth(t):this.useSizer?o(this.options.sizer,"marginLeft"):this.options.gutterWidth}},{key:"_setColumns",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getSize(this.element).width,i=this._getGutterSize(e),n=this._getColumnSize(e,i),s=(e+i)/n;Math.abs(Math.round(s)-s)<this.options.columnThreshold&&(s=Math.round(s)),this.cols=Math.max(Math.floor(s),1),this.containerWidth=e,this.colWidth=n}},{key:"_setContainerSize",value:function(){this.element.style.height=this._getContainerSize()+"px"}},{key:"_getContainerSize",value:function(){return f(this.positions)}},{key:"_getStaggerAmount",value:function(t){return Math.min(t*this.options.staggerAmount,this.options.staggerAmountMax)}},{key:"_dispatch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!this.isDestroyed&&(e.shuffle=this,!this.element.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!1,detail:e})))}},{key:"_resetCols",value:function(){var t=this.cols;for(this.positions=[];t;)t-=1,this.positions.push(0)}},{key:"_layout",value:function(e){var i=this,n=0;e.forEach(function(e){function s(){e.element.style.transitionDelay="",e.applyCss(B.Css.VISIBLE.after)}var o=e.point,r=e.scale,l=t.getSize(e.element,!0),a=i._getItemPosition(l);if(A.equals(o,a)&&r===B.Scale.VISIBLE)return e.applyCss(B.Css.VISIBLE.before),void s();e.point=a,e.scale=B.Scale.VISIBLE;var u=w(B.Css.VISIBLE.before);u.transitionDelay=i._getStaggerAmount(n)+"ms",i._queue.push({item:e,styles:u,callback:s}),n+=1})}},{key:"_getItemPosition",value:function(t){return p({itemSize:t,positions:this.positions,gridSize:this.colWidth,total:this.cols,threshold:this.options.columnThreshold,buffer:this.options.buffer})}},{key:"_shrink",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._getConcealedItems(),i=0;e.forEach(function(e){function n(){e.applyCss(B.Css.HIDDEN.after)}if(e.scale===B.Scale.HIDDEN)return e.applyCss(B.Css.HIDDEN.before),void n();e.scale=B.Scale.HIDDEN;var s=w(B.Css.HIDDEN.before);s.transitionDelay=t._getStaggerAmount(i)+"ms",t._queue.push({item:e,styles:s,callback:n}),i+=1})}},{key:"_handleResize",value:function(){this.isEnabled&&!this.isDestroyed&&t.getSize(this.element).width!==this.containerWidth&&this.update()}},{key:"_getStylesForTransition",value:function(t){var e=t.item,i=t.styles;i.transitionDelay||(i.transitionDelay="0ms");var n=e.point.x,s=e.point.y;return this.options.useTransforms?i.transform="translate("+n+"px, "+s+"px) scale("+e.scale+")":(i.left=n+"px",i.top=s+"px"),i}},{key:"_whenTransitionDone",value:function(t,e,i){var n=h(t,function(t){e(),i(null,t)});this._transitions.push(n)}},{key:"_getTransitionFunction",value:function(t){var e=this;return function(i){t.item.applyCss(e._getStylesForTransition(t)),e._whenTransitionDone(t.item.element,t.callback,i)}}},{key:"_processQueue",value:function(){this.isTransitioning&&this._cancelMovement();var t=this.options.speed>0,e=this._queue.length>0;e&&t&&this.isInitialized?this._startTransitions(this._queue):e?(this._styleImmediately(this._queue),this._dispatchLayout()):this._dispatchLayout(),this._queue.length=0}},{key:"_startTransitions",value:function(t){var e=this;this.isTransitioning=!0;var i=t.map(function(t){return e._getTransitionFunction(t)});z(i,this._movementFinished.bind(this))}},{key:"_cancelMovement",value:function(){this._transitions.forEach(u),this._transitions.length=0,this.isTransitioning=!1}},{key:"_styleImmediately",value:function(e){var i=this;if(e.length){var n=e.map(function(t){return t.item.element});t._skipTransitions(n,function(){e.forEach(function(t){t.item.applyCss(i._getStylesForTransition(t)),t.callback()})})}}},{key:"_movementFinished",value:function(){this._transitions.length=0,this.isTransitioning=!1,this._dispatchLayout()}},{key:"_dispatchLayout",value:function(){this._dispatch(t.EventType.LAYOUT)}},{key:"filter",value:function(e,i){this.isEnabled&&((!e||e&&0===e.length)&&(e=t.ALL_ITEMS),this._filter(e),this._shrink(),this._updateItemCount(),this.sort(i))}},{key:"sort",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.lastSort;if(this.isEnabled){this._resetCols();var e=this._getFilteredItems();e=l(e,t),this._layout(e),this._processQueue(),this._setContainerSize(),this.lastSort=t}}},{key:"update",value:function(t){this.isEnabled&&(t||this._setColumns(),this.sort())}},{key:"layout",value:function(){this.update(!0)}},{key:"add",value:function(t){var e=T(t).map(function(t){return new B(t)});this._initItems(e),this._setTransitions(e),this.items=this.items.concat(e),this._updateItemsOrder(),this.filter(this.lastFilter)}},{key:"disable",value:function(){this.isEnabled=!1}},{key:"enable",value:function(t){this.isEnabled=!0,!1!==t&&this.update()}},{key:"remove",value:function(e){var i=this;if(e.length){var n=T(e),s=n.map(function(t){return i.getItemByElement(t)}).filter(function(t){return!!t}),o=function e(){i.element.removeEventListener(t.EventType.LAYOUT,e),i._disposeItems(s),n.forEach(function(t){t.parentNode.removeChild(t)}),i._dispatch(t.EventType.REMOVED,{collection:n})};this._toggleFilterClasses({visible:[],hidden:s}),this._shrink(s),this.sort(),this.items=this.items.filter(function(t){return!g(s,t)}),this._updateItemCount(),this.element.addEventListener(t.EventType.LAYOUT,o)}}},{key:"getItemByElement",value:function(t){for(var e=this.items.length-1;e>=0;e--)if(this.items[e].element===t)return this.items[e];return null}},{key:"destroy",value:function(){this._cancelMovement(),window.removeEventListener("resize",this._onResize),this.element.classList.remove("shuffle"),this.element.removeAttribute("style"),this._disposeItems(),this.items=null,this.options.sizer=null,this.element=null,this._transitions=null,this.isDestroyed=!0}}],[{key:"getSize",value:function(t,e){var i=window.getComputedStyle(t,null),n=o(t,"width",i),s=o(t,"height",i);e&&(n+=o(t,"marginLeft",i)+o(t,"marginRight",i),s+=o(t,"marginTop",i)+o(t,"marginBottom",i));return{width:n,height:s}}},{key:"_skipTransitions",value:function(t,e){var i=t.map(function(t){var e=t.style,i=e.transitionDuration,n=e.transitionDelay;return e.transitionDuration="0ms",e.transitionDelay="0ms",{duration:i,delay:n}});e(),t[0].offsetWidth,t.forEach(function(t,e){t.style.transitionDuration=i[e].duration,t.style.transitionDelay=i[e].delay})}}]),t}();return Y.ShuffleItem=B,Y.ALL_ITEMS="all",Y.FILTER_ATTRIBUTE_KEY="groups",Y.EventType={LAYOUT:"shuffle:layout",REMOVED:"shuffle:removed"},Y.Classes=F,Y.FilterMode={ANY:"any",ALL:"all"},Y.options={group:Y.ALL_ITEMS,speed:250,easing:"ease",itemSelector:"*",sizer:null,gutterWidth:0,columnWidth:0,delimeter:null,buffer:0,columnThreshold:.01,initialSort:null,throttle:C,throttleTime:300,staggerAmount:15,staggerAmountMax:250,useTransforms:!0,filterMode:Y.FilterMode.ANY},Y.__Point=A,Y.__sorter=l,Y.__getColumnSpan=d,Y.__getAvailablePositions=m,Y.__getShortColumn=v,Y}),function(){this.JST||(this.JST={}),this.JST["templates/backbone_apps/examples/example"]=function(){return function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,($o=[]).push("<button class='button example--inner'>\n  <div class='example--activity-image' style=\"background-image:url('"+$e($c(this.activity_image_url))+"')\"></div>\n  <div class='example--header'>\n    <div class='example--type'>"+$e($c(this.type))+"</div>\n    <div class='example--icon icon' data-glyph='"+$e($c(this.icon))+"'></div>\n  </div>\n  <h2 class='example--title'>"+$e($c(this.title))+"</h2>\n  <div class='example--description'>"+$e($c(this.description))+"</div>\n</button>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Views.Examples",function(Examples){return Examples.Example=function(superClass){function Example(){return this.render=bind(this.render,this),this.customizeActivity=bind(this.customizeActivity,this),Example.__super__.constructor.apply(this,arguments)}return extend(Example,superClass),Example.prototype.className="example--item",Example.prototype.events={click:"customizeActivity"},Example.prototype.customizeActivity=function(){var options,_this;return options={includeFlashOptions:!0},this.model.getActivity(options).then((_this=this,function(activity){var base;return _this.trigger("create_poll",{activity:activity,navigate:!1,trackingData:{example_title:_this.model.get("title")}}),"function"==typeof(base=_this.app.view).showMagicBar?base.showMagicBar(null,{activity:activity,navigate:!1,trackingData:{example_title:_this.model.get("title")}}):void 0})),this.trigger("view:action","customize",{type:this.model.get("activity_type"),title:this.model.get("title")})},Example.prototype.render=function(){var exampleData;return exampleData={type:this.model.humanizedType(),icon:PollEv.Util.activityTypeToIcon(this.model.get("activity_type")),title:this.model.get("title"),description:this.model.get("description"),activity_image_url:this.model.get("activity_image_url")},this.model.get("activity_image_url")&&this.$el.addClass("example--item__has-image"),this.$el.html(JST["templates/backbone_apps/examples/example"](exampleData)),this.$el.attr("data-type",this.model.get("activity_type")),!0===this.model.get("feature")&&this.$el.attr("featured",""),this},Example}(PollEv.View.Base)})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Views.Examples",function(Examples){var Shuffle;return Shuffle=window.shuffle,Examples.List=function(superClass){function List(){return this._loadExamples=bind(this._loadExamples,this),this.loadMore=bind(this.loadMore,this),this.render=bind(this.render,this),this.renderGrid=bind(this.renderGrid,this),this.addExamples=bind(this.addExamples,this),List.__super__.constructor.apply(this,arguments)}return extend(List,superClass),List.prototype.className="examples--list row",List.prototype.initialize=function(){return this.model=new PollEv.Model.ExampleActivities},List.prototype.addExamples=function(collection,isInitial){var elements,_this;return null==isInitial&&(isInitial=!1),elements=collection.map((_this=this,function(model){var view;return view=new PollEv.Views.Examples.Example({model:model}),_this.listenTo(view,"all",_this.trigger),view.render().$el})),this.$el.append(elements),this.renderGrid(),this.trigger("add",elements)},List.prototype.renderGrid=function(){return this.shuffle=new Shuffle(this.$el,{itemSelector:".example--item",sizer:this.$(".example--item:not([featured])").get(0)})},List.prototype.render=function(){var _this;return List.__super__.render.apply(this,arguments),this._loadExamples().then((_this=this,function(){return _this.addExamples(_this.model,!0)})),this},List.prototype.loadMore=function(){return this.model.loadMore().then(this.addExamples)},List.prototype._loadExamples=function(){var $spinnerEl;return this._reportsPromise?this._reportsPromise:($spinnerEl=$((new PollEv.Spinner).spin().el).addClass("report-list--spinner"),this.$el.append($spinnerEl),this._reportsPromise=this.model.query().done(function(){return $spinnerEl.remove()}))},List}(PollEv.View.Base)})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/backbone_apps/examples/logged_in"]=function(){return function(context){return function(){var $o;return($o=[]).push("<h1>Examples</h1>\n<p class='tagline'>Customize an example activity, and start engaging the audience in seconds. From Q&A to icebreakers, each of these example polls have been field-tested by professional presenters.</p>\n<div class='examples--container'></div>\n<button class='element-button-primary examples--load-more'>\n  Load more\n</button>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View",function(View){return View.Examples=function(superClass){function Examples(){return this.renderDisabledNotice=bind(this.renderDisabledNotice,this),this.render=bind(this.render,this),this.loadMore=bind(this.loadMore,this),Examples.__super__.constructor.apply(this,arguments)}return extend(Examples,superClass),Examples.prototype.events={"click .examples--load-more":"loadMore"},Examples.prototype.initialize=function(){return this.list=new PollEv.Views.Examples.List,this.listenTo(this.list,"all",this.trigger),this.listenTo(this.list,"add",(_this=this,function(){return _this.$(".examples--load-more").toggleVisibility(_this.list.model.hasMore())}));var _this},Examples.prototype.loadMore=function(){return this.list.loadMore()},Examples.prototype.render=function(){return!1===this.app.user.get("features").examples?(this.renderDisabledNotice(),this):(this.$el.html(JST["templates/backbone_apps/examples/logged_in"]()),this.appendView(this.$(".examples--container"),this.list),this)},Examples.prototype.renderDisabledNotice=function(){return this.$el.text("This feature has been disabled for your account.")},Examples}(PollEv.View.Base)})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){var moveActivitiesToGroup,moveActivitiesToUser;return moveActivitiesToGroup=function(self,groupId){if(self.model.has("group_id"))return $.Deferred(function(deferred){var data,job,url;return data=self.modelIds(),url="/api/activities/move/to_group/"+groupId,(job=PollEv.RailsApp.Util.makeJob(data,url,"move to group")).on("complete",function(){return self.model.competitions.forEach(function(competition){var ref;return null!=(ref=competition.collection)?ref.remove(competition):void 0}),self.model.polls.forEach(function(poll){var ref;return null!=(ref=poll.collection)?ref.remove(poll):void 0}),self.model.surveys.forEach(function(survey){var ref;return null!=(ref=survey.collection)?ref.remove(survey):void 0}),self.trigger("update:group",groupId),self.app.trigger("view:action","my_polls:bulk_move_success",{user_ids:self.app.user.id,poll_ids:self.model.get("poll_ids")},{immediate:!0}),deferred.resolve()}),job.on("fail",deferred.reject)})},moveActivitiesToUser=function(self,userId){if(self.model.has("owner_id")&&self.model.get("allow_move_to_user"))return $.Deferred(function(deferred){var data,job,url;return data=self.modelIds(),url="/api/activities/move/to_user/"+userId,(job=PollEv.RailsApp.Util.makeJob(data,url,"move to user")).on("complete",function(data){var groups;return self.model.competitions.forEach(function(competition){var ref;return null!=(ref=competition.collection)?ref.remove(competition):void 0}),self.model.polls.forEach(function(poll){var ref;return null!=(ref=poll.collection)?ref.remove(poll):void 0}),self.model.surveys.forEach(function(survey){var ref;return null!=(ref=survey.collection)?ref.remove(survey):void 0}),self.model.groups.forEach(function(group){var ref;return null!=(ref=group.collection)?ref.remove(group):void 0}),groups=data.map(function(groupJson){return new PollEv.Model.Group(groupJson)}),self.trigger("new:groups",groups),
self.app.trigger("view:action","my_polls:bulk_move_success",{user_ids:self.model.get("owner_id"),poll_ids:self.model.get("poll_ids")},{immediate:!0}),deferred.resolve()}),job.on("fail",deferred.reject)})},MultiEdit.Move=function(superClass){function Move(){return this.toggleMoveToUser=bind(this.toggleMoveToUser,this),this.performAction=bind(this.performAction,this),this.confirm=bind(this.confirm,this),this.render=bind(this.render,this),Move.__super__.constructor.apply(this,arguments)}return extend(Move,superClass),Move.prototype.initialize=function(){return Move.__super__.initialize.apply(this,arguments),this.model.set({allow_move_to_user:!0}),this.movePollPanel=new MultiEdit.MovePollPanel({model:this.model}),this.panelTitle="Move"},Move.prototype.render=function(){return Move.__super__.render.apply(this,arguments),this.appendPanel(this.movePollPanel),this},Move.prototype.confirm=function(){var count,message,pluralizedItem,ref,ref1,toGroupSelected,toTarget,toUserSelected;if(!(toUserSelected=null!=(ref=this.movePollPanel.userCombobox)?ref.getSelected():void 0)||this.model.get("allow_move_to_user"))return toGroupSelected=null!=(ref1=this.movePollPanel.groupCombobox)?ref1.getSelected():void 0,toTarget=toUserSelected?" to user <strong>"+toUserSelected.fullName()+"</strong>.":toGroupSelected?" to group <strong>"+toGroupSelected.get("name")+"</strong>.":".",message="<p>You selected <strong>"+(count=this.activitiesCount())+"</strong> "+(pluralizedItem=PollEv.Util.pluralize(count,"activity",{includeNumber:!1}))+".\nClick 'Apply' to move the selected "+pluralizedItem+" "+toTarget+"</p>",toUserSelected?(message+="<p><strong>All responses will be archived. User must ",message+="create a Report to view archived responses.</strong></p>"):message+="<p>Responses are included.</p>",PollEv.Component.Modal.confirm(message,{simpleTitle:"Confirm move",allowHtml:!0,actions:{primary:"Apply"}})},Move.prototype.performAction=function(){return this.confirm().then((_this=this,function(){var moveToGroup,moveToUser;return _this.trigger("job:start"),_this.prepareActivityIds(),moveToUser=moveActivitiesToUser(_this,_this.model.get("owner_id")),moveToGroup=moveActivitiesToGroup(_this,_this.model.get("group_id")),$.when(moveToUser,moveToGroup).fail(function(){return 1<=arguments.length&&slice.call(arguments,0),PollEv.Component.Modal.alert("An error occurred. Please try again.",{simpleTitle:"Move activities"})}).always(function(){var ref,ref1,ref2,ref3;return _this.trigger("job:done"),_this.movePollPanel.$(":radio").prop("checked",!1),null!=(ref=_this.movePollPanel.userCombobox)&&ref.collection.reset(),null!=(ref1=_this.movePollPanel.userCombobox)&&ref1.$("input").val(""),null!=(ref2=_this.movePollPanel.groupCombobox)&&ref2.collection.reset(),null!=(ref3=_this.movePollPanel.groupCombobox)?ref3.$("input").val(""):void 0})}));var _this},Move.prototype.toggleMoveToUser=function(enable){return this.model.set({allow_move_to_user:enable})},Move}(MultiEdit.BulkActionCollapsibleContainer)})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){return MultiEdit.Container=function(superClass){function Container(){return this.performAction=bind(this.performAction,this),this.confirm=bind(this.confirm,this),this.render=bind(this.render,this),Container.__super__.constructor.apply(this,arguments)}return extend(Container,superClass),Container.prototype.initialize=function(){return Container.__super__.initialize.apply(this,arguments),this.panelTitle="Bulk edit"},Container.prototype.render=function(){var features;return Container.__super__.render.apply(this,arguments),features=this.app.user.get("features"),this.appendPanel(new MultiEdit.ResponsesPanel({model:this.model})),features.participant_reporting&&this.appendPanel(new MultiEdit.WhoCanRespondPanel({model:this.model})),this.appendPanel(new MultiEdit.HowPeopleCanRespondPanel({model:this.model})),this.appendPanel(new MultiEdit.CopyVisualSettingsPanel({model:this.model,users:this.users})),this},Container.prototype.confirm=function(){var message;return message="<p>You are about to <strong>modify "+PollEv.Util.pluralize(this.activitiesCount(),"activity",{includeNumber:!0})+"</strong>.</p>\n<p>This action will be permanent. It can not be undone.</p>",PollEv.Component.Modal.confirm(message,{simpleTitle:"Modify activities",allowHtml:!0,actions:{primary:"Permanently modify activities"}})},Container.prototype.performAction=function(){return this.confirm().then((_this=this,function(){return _this.model.set({id:_.pluck(_this.model.polls,"id").join(","),selected_group_ids:_.pluck(_this.model.groups,"id").join(",")}),_this.model.save().done(function(json){return _this.trigger("save",json,_this.model.polls)})}));var _this},Container}(MultiEdit.BulkActionCollapsibleContainer)})}.call(this),function(){PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){return MultiEdit.Panel=function(self){return{_bindPanelToggle:function(properties){return self.panelModel=new Backbone.Model,properties=properties.split(/\s+/),self.events||(self.events={}),self.events["click .header input"]=function(e){var enabled;return enabled=$(e.target).is(":checked"),self.trigger("header:clicked",e),self.trigger("panel:enabled",enabled)},self.delegateEvents(self.events),self.listenTo(self.panelModel,"change",function(){var checked;return checked=_.any(properties,function(p){return self.panelModel.has(p)}),self.$(".header input").prop("checked",checked),self.trigger("panel:enabled",checked)}),self.listenTo(self,"panel:enabled",function(enabled){var i,len,prop;for(self.panelEnabled=enabled,i=0,len=properties.length;i<len;i++)prop=properties[i],self.model.unset(prop);if(enabled)return self.model.set(self.panelModel.attributes)})}}}})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/my_polls/multi_edit/copy_poll"]=function(){return function(context){return function(){var $o;return($o=[]).push("<div class='multi-edit-panel-body'>\n  <ul>\n    <li class='multi-edit-copy-to-group'>\n      <label>\n        <input type='radio' name='copy_to' value='group'>To another group:</input>\n      </label>\n      <div class='multi-edit-autocomplete'></div>\n    </li>\n    <li class='multi-edit-copy-to-user'>\n      <label>\n        <input type='radio' name='copy_to' value='user'>To another user:</input>\n      </label>\n      <div class='multi-edit-autocomplete'></div>\n    </li>\n    <li class='multi-edit-copy-to-all'>\n      <label>\n        <input type='radio' name='copy_to' value='all'>To all users</input>\n      </label>\n    </li>\n  </ul>\n  <div class='hidden multi-edit-panel--item-error'></div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){var SelectedUserItem;return SelectedUserItem=function(superClass){function SelectedUserItem(){return this.render=bind(this.render,this),SelectedUserItem.__super__.constructor.apply(this,arguments)}return extend(SelectedUserItem,superClass),SelectedUserItem.prototype.className="multi-edit-copy-to-user__list-item button light-gray thin",SelectedUserItem.prototype.initialize=function(options){return null==options&&(options={}),this.label=options.label,this.listenTo(this.model,"remove",this.remove),this.listenTo(this.model.collection,"reset",this.remove)},SelectedUserItem.prototype.render=function(){return this.$el.attr("data-id",this.model.id).text(this.model.firstNameLastInitial()+" ("+this.model.get("email")+")"),this},SelectedUserItem}(Backbone.View),MultiEdit.CopyPollPanel=function(superClass){function CopyPollPanel(){return this.renderCopyToUser=bind(this.renderCopyToUser,this),this.renderCopyToGroup=bind(this.renderCopyToGroup,this),this.selectGroup=bind(this.selectGroup,this),this.render=bind(this.render,this),this.removeSelectedUser=bind(this.removeSelectedUser,this),this.updateRadio=bind(this.updateRadio,this),this.selectUser=bind(this.selectUser,this),this.clearCopyToAll=bind(this.clearCopyToAll,this),this.copyToAll=bind(this.copyToAll,this),CopyPollPanel.__super__.constructor.apply(this,arguments)}return extend(CopyPollPanel,superClass),CopyPollPanel.prototype.className="multi-edit-panel multi-edit-panel-copy",CopyPollPanel.prototype.events={"change .multi-edit-copy-to-user input[type=radio]":"clearCopyToAll","click .multi-edit-copy-to-all":"copyToAll","click .multi-edit-copy-to-user__list-item":"removeSelectedUser"},CopyPollPanel.prototype.initialize=function(){return this.include(MultiEdit.Panel),this._bindPanelToggle("group_id subuser_ids"),this.listenTo(this.panelModel,"change",this.updateRadio),this.selectedUsers=new PollEv.Model.Users,this.listenTo(this.selectedUsers,"update",(_this=this,function(){return _this.panelModel.set({subuser_ids:_this.selectedUsers.pluck("id")})}));var _this},CopyPollPanel.prototype.copyToAll=function(){return this.panelModel.set({subuser_ids:[-1]})},CopyPollPanel.prototype.clearCopyToAll=function(){if(this.panelModel.has("subuser_ids"))return this.panelModel.set({subuser_ids:this.selectedUsers.pluck("id")})},CopyPollPanel.prototype.selectUser=function(model){return model?(this.selectedUsers.get(model.id)||this.selectedUsers.add(model.clone()),this.userCombobox.clearSelected(),this.groupCombobox.clearSelected()):this.panelModel.unset("subuser_ids")},CopyPollPanel.prototype.updateRadio=function(){var ids,isAllUsers;return this.panelModel.has("subuser_ids")?(isAllUsers=1===(ids=this.panelModel.get("subuser_ids")).length&&-1===ids[0],this.$(".multi-edit-copy-to-user input[type=radio]").prop("checked",!isAllUsers&&ids.length),this.$(".multi-edit-copy-to-all input[type=radio]").prop("checked",isAllUsers)):this.panelModel.has("group_id")?this.$(".multi-edit-copy-to-group input[type=radio]").prop("checked",!0):void 0},CopyPollPanel.prototype.removeSelectedUser=function(e){var id;return id=$(e.target).data("id"),this.selectedUsers.remove(this.selectedUsers.get(id))},CopyPollPanel.prototype.render=function(){return this.renderTemplate("templates/my_polls/multi_edit/copy_poll"),this.renderCopyToUser(),this.renderCopyToGroup(),this},CopyPollPanel.prototype.selectGroup=function(model){return model?(this.panelModel.set({group_id:model.id}),this.userCombobox.clearSelected()):this.panelModel.unset("group_id")},CopyPollPanel.prototype.renderCopyToGroup=function(){var _this;return this.groupCombobox=new PollEv.Component.ComboBox({placeholderText:"Search group name",label:function(model){return model.get("name")},defaultModelId:null,filter:function(term,collection){return term.length?collection.filter(term,["name"]):collection.clearFilter()}}),this.$(".multi-edit-copy-to-group .multi-edit-autocomplete").append(this.groupCombobox.render().$el),this.listenTo(this.app.user.groups,"add",(_this=this,function(model){var nextGroup,options;return options={},model.id<0?options.at=0:model.has("next_group_id")&&(nextGroup=_this.groupCombobox.collection.get(model.get("next_group_id")))&&(options.at=_.indexOf(_this.groupCombobox.collection.models,nextGroup)),_this.groupCombobox.collection.add(model.clone(),options)})),this.listenTo(this.app.user.groups,"remove",function(_this){return function(model){return _this.groupCombobox.collection.remove(model.id)}}(this)),this.listenTo(this.app.user.groups,"change:name",function(_this){return function(model,value){return _this.groupCombobox.collection.get(model.id).set("name",value)}}(this)),this.listenTo(this.groupCombobox,"select",this.selectGroup),this.listenTo(this.groupCombobox,"clear",function(_this){return function(){return _this.panelModel.unset("group_id")}}(this))},CopyPollPanel.prototype.renderCopyToUser=function(){var usersCollection,_this;return this.selectedUserList=new PollEv.Component.List({collection:this.selectedUsers,viewClass:function(){return SelectedUserItem},className:"multi-edit-copy-to-user__list"}),(usersCollection=new PollEv.Model.Users).url="/api/account/users",this.userCombobox=new PollEv.Component.ComboBox({collection:usersCollection,placeholderText:"Search name or email",label:function(model){return model.firstNameLastInitial()+" ("+model.get("email")+")"},filter:function(term,collection){return term.length?collection.fetch({data:{search:term}}):collection.set([])}}),this.$(".multi-edit-copy-to-user .multi-edit-autocomplete").append([this.userCombobox.render().$el,this.selectedUserList.render().$el]),this.listenTo(this.app.users,"update",(_this=this,function(collection,opts){return opts.changes.added.forEach(function(model){return _this.userCombobox.collection.add(model.clone())}),opts.changes.removed.forEach(function(model){return _this.userCombobox.collection.remove(model.id)})})),this.listenTo(this.userCombobox,"select",this.selectUser)},CopyPollPanel}(PollEv.View.Base)})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/my_polls/multi_edit/copy_visual_settings"]=function(){return function(context){return function(){var $o;return($o=[]).push("<label class='header'>\n  <input type='checkbox'>\n  Copy Visual Settings\n</label>\n<div class='multi-edit-panel-body'>\n  <label>\n    <ul>\n      <li>\n        <label class='left'>\n          From poll:\n        </label>\n        <div class='multi-edit-autocomplete'></div>\n      </li>\n    </ul>\n  </label>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){var PollSearch;return PollSearch=function(superClass){function PollSearch(){return this.parse=bind(this.parse,this),PollSearch.__super__.constructor.apply(this,arguments)}return extend(PollSearch,superClass),PollSearch.prototype.url="/api/activities/search",PollSearch.prototype.model=function(attrs,options){return PollEv.Util.activityFactory(attrs,options)},PollSearch.prototype.initialize=function(_,options){return null==options&&(options={}),this.users=options.users,this.groups=new PollEv.Model.Groups,this.surveys=new PollEv.Model.ActivityCollection},PollSearch.prototype.fetch=function(options){return null==options&&(options={}),_.defaults(options,{method:"get",data:{term:options.term}}),PollSearch.__super__.fetch.call(this,options)},PollSearch.prototype.parse=function(json){var ownerIds;return this.groups.reset(PollEv.Util.popRootKeys(json.groups)),this.groups.add(new PollEv.Model.Group({name:"Ungrouped",id:-1})),this.surveys.reset(PollEv.Util.popRootKeys(json.surveys)),ownerIds=_.pluck(this.users,"id"),_.filter(PollEv.Util.popRootKeys(json.polls),function(json){return ownerIds.indexOf(json.owner_id)>-1})},PollSearch}(Backbone.Collection),MultiEdit.CopyVisualSettingsPanel=function(superClass){function CopyVisualSettingsPanel(){return this.render=bind(this.render,this),this.unsetPoll=bind(this.unsetPoll,this),CopyVisualSettingsPanel.__super__.constructor.apply(this,arguments)}return extend(CopyVisualSettingsPanel,superClass),CopyVisualSettingsPanel.prototype.className="multi-edit-panel visual-settings",CopyVisualSettingsPanel.prototype.initialize=function(options){var _this;return null==options&&(options={}),this.users=options.users,this.include(MultiEdit.Panel),this._bindPanelToggle("flash_src_id"),this.combobox=new PollEv.Component.ComboBox({collection:new PollSearch(null,{users:this.users}),placeholderText:"Search poll title",label:(_this=this,function(model){var containerName,groupId,groupName,owner,ref,ref1,ref2,ref3,surveyId,surveyName,tokens;return tokens=[model.cleanTitle()],groupId=model.get("group_id"),groupName=null!=(ref=model.collection)&&null!=(ref1=ref.groups.get(groupId))?ref1.get("name"):void 0,model.has("survey_id")&&(surveyId=model.get("survey_id"),surveyName=null!=(ref2=model.collection)&&null!=(ref3=ref2.surveys.get(surveyId,"survey"))?ref3.cleanTitle():void 0),containerName=groupName||surveyName,model.get("owner_id")!==_this.app.user.id&&null!=(owner=_this.app.users.get(model.get("owner_id")))&&(containerName=containerName+" - "+owner.firstNameLastInitial()),containerName&&tokens.push("("+containerName+")"),tokens.join(" ")}),filter:function(term,collection){return term.length>2?collection.fetch({term:term}):0===term.length?collection.set([]):void 0}}),this.listenTo(this.combobox,"select",function(_this){return function(model){return model?_this.panelModel.set({flash_src_id:model.id}):_this.unsetPoll}}(this))},CopyVisualSettingsPanel.prototype.unsetPoll=function(){return this.panelModel.unset("flash_src_id")},CopyVisualSettingsPanel.prototype.render=function(){return this.renderTemplate("templates/my_polls/multi_edit/copy_visual_settings"),this.$(".multi-edit-autocomplete").append(this.combobox.render().$el),this},CopyVisualSettingsPanel}(PollEv.View.Base)})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/my_polls/multi_edit/how_people_can_respond"]=function(){return function(context){return function(){var $o;return($o=[]).push("<label class='header'>\n  <input type='checkbox'>\n  How People Can Respond\n</label>\n<div class='multi-edit-panel-body'>\n  <ul>\n    <li>\n      <label>\n        <input class='sms' type='checkbox'>\n        Text messages\n      </label>\n    </li>\n    <li>\n      <label>\n        <input class='web' type='checkbox'>\n        Web Devices on\n        <a target='_blank' rel='noopener'></a>\n      </label>\n    </li>\n  </ul>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){return MultiEdit.HowPeopleCanRespondPanel=function(superClass){function HowPeopleCanRespondPanel(){return this.render=bind(this.render,this),this.toggleWeb=bind(this.toggleWeb,this),this.toggleSMS=bind(this.toggleSMS,this),this.enablePanel=bind(this.enablePanel,this),this.updateCheckboxes=bind(this.updateCheckboxes,this),HowPeopleCanRespondPanel.__super__.constructor.apply(this,arguments)}return extend(HowPeopleCanRespondPanel,superClass),HowPeopleCanRespondPanel.prototype.className="multi-edit-panel how-people-can-respond",HowPeopleCanRespondPanel.prototype.events={"click .sms":"toggleSMS","click .web":"toggleWeb"},HowPeopleCanRespondPanel.prototype.initialize=function(){return this.include(MultiEdit.Panel),this._bindPanelToggle("sms_enabled web_enabled"),this.listenTo(this.panelModel,"change",this.updateCheckboxes),this.listenTo(this,"header:clicked",this.enablePanel),this.listenTo(this,"panel:enabled",this.enablePanel)},HowPeopleCanRespondPanel.prototype.updateCheckboxes=function(){return this.$(".sms").prop("checked",!!this.panelModel.get("sms_enabled")),this.$(".web").prop("checked",!!this.panelModel.get("web_enabled"))},HowPeopleCanRespondPanel.prototype.enablePanel=function(){if(this.$(".header input").is(":checked"))return this.panelModel.set({sms_enabled:!!this.panelModel.get("sms_enabled")||!1,web_enabled:!!this.panelModel.get("web_enabled")||!1})},HowPeopleCanRespondPanel.prototype.toggleSMS=function(){return this.panelModel.set({sms_enabled:this.$(".sms").is(":checked")})},HowPeopleCanRespondPanel.prototype.toggleWeb=function(){return this.panelModel.set({web_enabled:this.$(".web").is(":checked")})},HowPeopleCanRespondPanel.prototype.render=function(){var login;return this.renderTemplate("templates/my_polls/multi_edit/how_people_can_respond"),login=this.app.user.get("login"),this.$("a").attr("href","https://pollev.com/"+login).text("pollev.com/"+login),this},HowPeopleCanRespondPanel}(PollEv.View.Base)})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/my_polls/multi_edit/move_poll"]=function(){return function(context){return function(){var $o;return($o=[]).push("<div class='multi-edit-panel-body'>\n  <ul>\n    <li class='multi-edit-move-to-group'>\n      <label>\n        <input type='radio' name='move_to' value='group'>To another group:</input>\n      </label>\n      <div class='multi-edit-autocomplete'></div>\n    </li>\n    <li class='multi-edit-move-to-user'>\n      <label>\n        <input type='radio' name='move_to' value='user'>To another user:</input>\n      </label>\n      <div class='multi-edit-autocomplete'></div>\n    </li>\n  </ul>\n  <div class='hidden multi-edit-panel--item-error'></div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){var showMoveSharedWarning;return showMoveSharedWarning=function(self){var message;return self.$(".multi-edit-move-to-user :radio").prop("checked",!1),message="One or more of the selected activities are shared with other presenters on the account<br /><br /> Unshare these activities to move the activities",self.modal||(self.modal=new PollEv.Component.Modal.Dialog({content:message,size:"small",header:!1,actions:{primary:"OK"}})),self.modal.open(),self.modal.on("click:primary",self.modal.close)},MultiEdit.MovePollPanel=function(superClass){function MovePollPanel(){return this.renderMoveToUser=bind(this.renderMoveToUser,this),this.selectUser=bind(this.selectUser,this),this.renderMoveToGroup=bind(this.renderMoveToGroup,this),this.render=bind(this.render,this),this.removeMoveToUser=bind(this.removeMoveToUser,this),this.singleUserAccount=bind(this.singleUserAccount,this),this.updateRadio=bind(this.updateRadio,this),MovePollPanel.__super__.constructor.apply(this,arguments)}return extend(MovePollPanel,superClass),MovePollPanel.prototype.className="multi-edit-panel multi-edit-panel-move",MovePollPanel.prototype.events={"click .multi-edit-move-to-user":function(){if(!this.model.get("allow_move_to_user"))return showMoveSharedWarning(this)}},MovePollPanel.prototype.initialize=function(){return this.include(MultiEdit.Panel),this._bindPanelToggle("group_id owner_id"),this.listenTo(this.panelModel,"change",this.updateRadio),this.listenTo(this.model,"change:allow_move_to_user",(_this=this,function(){var opacity;if(opacity=_this.model.get("allow_move_to_user")?1:.6,_this.$(".multi-edit-move-to-user").css("opacity",opacity),_this.$el.is(":visible")&&!_this.model.get("allow_move_to_user"))return showMoveSharedWarning(_this)}));var _this},MovePollPanel.prototype.updateRadio=function(){return this.panelModel.has("owner_id")?this.$(".multi-edit-move-to-user input[type=radio]").prop("checked",!0):this.panelModel.has("group_id")?this.$(".multi-edit-move-to-group input[type=radio]").prop("checked",!0):void 0},MovePollPanel.prototype.singleUserAccount=function(){return this.app.user.get("user_count")<=1},MovePollPanel.prototype.removeMoveToUser=function(){return this.$(".multi-edit-move-to-user").remove(),this.$(".multi-edit-move-to-group :radio").remove()},MovePollPanel.prototype.render=function(){return this.renderTemplate("templates/my_polls/multi_edit/move_poll"),this.renderMoveToGroup(),this.singleUserAccount()?this.removeMoveToUser():this.renderMoveToUser(),this},MovePollPanel.prototype.renderMoveToGroup=function(){var _this;return this.groupCombobox=new PollEv.Component.ComboBox({placeholderText:"Search group name",label:function(model){return model.get("name")},defaultModelId:null,filter:function(term,collection){return term.length?collection.filter(term,["name"]):collection.clearFilter()}}),this.$(".multi-edit-move-to-group .multi-edit-autocomplete").append(this.groupCombobox.render().$el),this.listenTo(this.app.user.groups,"add",(_this=this,function(model){var nextGroup,options;return options={},model.id<0?options.at=0:model.has("next_group_id")&&(nextGroup=_this.groupCombobox.collection.get(model.get("next_group_id")))&&(options.at=_.indexOf(_this.groupCombobox.collection.models,nextGroup)),_this.groupCombobox.collection.add(model.clone(),options)})),this.listenTo(this.app.user.groups,"remove",function(_this){return function(model){return _this.groupCombobox.collection.remove(model.id)}}(this)),this.listenTo(this.app.user.groups,"change:name",function(_this){return function(model,value){return _this.groupCombobox.collection.get(model.id).set("name",value)}}(this)),this.listenTo(this.groupCombobox,"select",function(_this){return function(model){var ref;return model?(_this.panelModel.set({group_id:model.id}),null!=(ref=_this.userCombobox)?ref.clearSelected():void 0):_this.panelModel.unset("group_id")}}(this)),this.listenTo(this.groupCombobox,"clear",function(_this){return function(){return _this.panelModel.unset("group_id")}}(this))},MovePollPanel.prototype.selectUser=function(model){return model?(this.panelModel.set({owner_id:model.id}),this.groupCombobox.clearSelected()):this.panelModel.unset("owner_id")},MovePollPanel.prototype.renderMoveToUser=function(){var usersCollection,_this;return(usersCollection=new PollEv.Model.Users).url="/api/account/users",this.userCombobox=new PollEv.Component.ComboBox({collection:usersCollection,placeholderText:"Search name or email",label:function(model){return model.firstNameLastInitial()+" ("+model.get("email")+")"},filter:function(term,collection){return term.length?collection.fetch({data:{search:term}}):collection.set([])}}),this.$(".multi-edit-move-to-user .multi-edit-autocomplete").append(this.userCombobox.render().$el),this.listenTo(this.app.users,"update",(_this=this,function(collection,opts){return opts.changes.added.forEach(function(model){return _this.userCombobox.collection.add(model.clone())}),opts.changes.removed.forEach(function(model){return _this.userCombobox.collection.remove(model.id)})})),this.listenTo(this.userCombobox,"select",this.selectUser),this.listenTo(this.userCombobox,"clear",function(_this){return function(){return _this.panelModel.unset("owner_id")}}(this))},MovePollPanel}(PollEv.View.Base)})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/my_polls/multi_edit/responses"]=function(){return function(context){return function(){var $o;return($o=[]).push("<label class='header'>\n  <input type='checkbox'>\n  Responses\n</label>\n<div class='multi-edit-panel-body'>\n  <p>Each person may respond</p>\n  <ul>\n    <li>\n      <label>\n        <input class='max-votes-limited' type='radio' name='max_votes' value='limited'>\n        up to\n        <input class='max-votes-count thin' type='text' size='2' value='1'>\n        <span class='max-votes-singular'>\n          time\n        </span>\n        <span class='hidden max-votes-plural'>\n          times\n        </span>\n      </label>\n    </li>\n    <li>\n      <label>\n        <input class='max-votes-unlimited' type='radio' name='max_votes' value='unlimited'>\n        as many times as they like\n      </label>\n    </li>\n  </ul>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){return MultiEdit.ResponsesPanel=function(superClass){function ResponsesPanel(){return this.render=bind(this.render,this),this.pluralize=bind(this.pluralize,this),this.unlimitVotes=bind(this.unlimitVotes,this),this.limitVotes=bind(this.limitVotes,this),this.enablePanel=bind(this.enablePanel,this),ResponsesPanel.__super__.constructor.apply(this,arguments)}return extend(ResponsesPanel,superClass),ResponsesPanel.prototype.className="multi-edit-panel responses",ResponsesPanel.prototype.events={"click .max-votes-limited":"limitVotes","click .max-votes-unlimited":"unlimitVotes","focus .max-votes-count":"limitVotes","keyup .max-votes-count":"limitVotes"},ResponsesPanel.prototype.initialize=function(){return this.include(MultiEdit.Panel),this._bindPanelToggle("max_votes_select max_votes"),this.listenTo(this,"header:clicked",this.enablePanel)},ResponsesPanel.prototype.enablePanel=function(){if(this.$(".header input").is(":checked")){if(this.$(".max-votes-unlimited").prop("checked"))return this.unlimitVotes();if(this.$(".max-votes-limited").prop("checked"))return this.limitVotes()}},ResponsesPanel.prototype.limitVotes=function(){return this.panelModel.set({max_votes_select:"limited",max_votes:parseInt(this.$(".max-votes-count").val())}),this.$(".max-votes-limited").prop("checked",!0),this.pluralize()},ResponsesPanel.prototype.unlimitVotes=function(){return this.panelModel.set({max_votes_select:"unlimited"})},ResponsesPanel.prototype.pluralize=function(){var plural;return plural=parseInt(this.$(".max-votes-count").val())>1,this.$(".max-votes-plural").toggleVisibility(plural),this.$(".max-votes-singular").toggleVisibility(!plural)},ResponsesPanel.prototype.render=function(){return this.renderTemplate("templates/my_polls/multi_edit/responses"),this.pluralize(),this},ResponsesPanel}(PollEv.View.Base)})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/my_polls/multi_edit/who_can_respond"]=function(){return function(context){return function(){var $o;return($o=[]).push("<label class='header'>\n  <input type='checkbox'>\n  <span class='who-can-respond-title'>Who Can Respond</span>\n</label>\n<div class='multi-edit-panel-body'>\n  <ul>\n    <li>\n      <label class='everyone-can-respond-radio-list'>\n        <input class='everyone-can-respond' type='radio' name='registered_participants_only' value='false'>\n        <span class='who-can-respond--everyone-label'>Everybody</span>\n      </label>\n      <div class='account-registered-participants-only hidden tip-content'>\n        This option has been disabled by your account administrator.\n      </div>\n    </li>\n    <li>\n      <label>\n        <input class='registered-only' type='radio' name='registered_participants_only' value='true'>\n        <span class='who-can-respond--registered-only-label'>Only registered participants</span>\n      </label>\n    </li>\n  </ul>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;PollEv.namespace("PollEv.Editor.View.MultiEdit",function(MultiEdit){return MultiEdit.WhoCanRespondPanel=function(superClass){function WhoCanRespondPanel(){return this.requireRegisteredParticipants=bind(this.requireRegisteredParticipants,this),this.render=bind(this.render,this),this.registeredOnly=bind(this.registeredOnly,this),this.everybody=bind(this.everybody,this),WhoCanRespondPanel.__super__.constructor.apply(this,arguments)}return extend(WhoCanRespondPanel,superClass),WhoCanRespondPanel.prototype.className="multi-edit-panel who-can-respond",WhoCanRespondPanel.prototype.events={
"click .everyone-can-respond":"everybody","click .registered-only":"registeredOnly"},WhoCanRespondPanel.prototype.initialize=function(){return this.include(MultiEdit.Panel),this._bindPanelToggle("registered_participants_only")},WhoCanRespondPanel.prototype.everybody=function(){return this.panelModel.set({registered_participants_only:!1})},WhoCanRespondPanel.prototype.registeredOnly=function(){return this.panelModel.set({registered_participants_only:!0})},WhoCanRespondPanel.prototype.render=function(){return this.renderTemplate("templates/my_polls/multi_edit/who_can_respond"),this.requireRegisteredParticipants(),PollEv.app.user.get("screen_names_enabled")&&(this.$(".who-can-respond-title").text("Who can participate?"),this.$(".who-can-respond--everyone-label").text("Everyone - no restrictions"),this.$(".who-can-respond--registered-only-label").text("Restrict to registered participants only")),this},WhoCanRespondPanel.prototype.requireRegisteredParticipants=function(){if(this.app.user.get("account_registered_participants_only"))return this.$(".everyone-can-respond").prop("disabled",!0),this.$(".everyone-can-respond-radio-list").tooltip({content:this.$(".tip-content.account-registered-participants-only").html()}),this.$(".registered-only").prop({disabled:!0,checked:!0})},WhoCanRespondPanel}(PollEv.View.Base)})}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/backbone_apps/poll/scheduled_lock_unlock"]=function(){return function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,($o=[]).push("<div class='start-stop'>\n  <strong>"+$e($c(this.header))+"</strong>\n  <span class='dater unset'>\n    <span class='date'></span>\n    <span class='time'></span>\n  </span>\n  <label class='radio-list'>\n    <input type='radio' name='"+$e($c(this.radioname))+"' value='dont' data-cutlass-event='poll_config:schedule_lock_unlock'>\n    Do not automatically "+this.type+"\n  </label>"),this.fromnow&&$o.push("  <label class='radio-list'>\n    <input type='radio' name='"+$e($c(this.radioname))+"' value='fivemin' data-cutlass-event='poll_config:schedule_lock_unlock'>\n    5 minutes from now\n  </label>\n  <label class='radio-list'>\n    <input type='radio' name='"+$e($c(this.radioname))+"' value='hour' data-cutlass-event='poll_config:schedule_lock_unlock'>\n    1 hour from now\n  </label>\n  <label class='radio-list'>\n    <input type='radio' name='"+$e($c(this.radioname))+"' value='day' data-cutlass-event='poll_config:schedule_lock_unlock'>\n    1 day from now\n  </label>"),this.fromstart&&$o.push("  <label class='radio-list'>\n    <input type='radio' name='"+$e($c(this.radioname))+"' value='fivemin' data-cutlass-event='poll_config:schedule_lock_unlock'>\n    5 minutes from auto-unlock time\n  </label>\n  <label class='radio-list'>\n    <input type='radio' name='"+$e($c(this.radioname))+"' value='hour' data-cutlass-event='poll_config:schedule_lock_unlock'>\n    1 hour from auto-unlock time\n  </label>\n  <label class='radio-list'>\n    <input type='radio' name='"+$e($c(this.radioname))+"' value='day' data-cutlass-event='poll_config:schedule_lock_unlock'>\n    1 day from auto-unlock time\n  </label>"),$o.push("  <label class='radio-list'>\n    <input type='radio' name='"+$e($c(this.radioname))+"' value='custom' data-cutlass-event='poll_config:schedule_lock_unlock'>\n    Custom\n  </label>\n  <div class='hyperedit' style='display: none'>\n    <div></div>\n  </div>"),"start"===this.type&&$o.push("  Auto-unlocking will do nothing if a poll is already started."),"stop"===this.type&&$o.push("  Auto-locking will do nothing if a poll is already started."),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var DateView,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;DateView=function(superClass){function DateView(){return this.getFrom=bind(this.getFrom,this),this.notcustom=bind(this.notcustom,this),this.custom=bind(this.custom,this),this.dayfrom=bind(this.dayfrom,this),this.hourfrom=bind(this.hourfrom,this),this.fivefrom=bind(this.fivefrom,this),this.saveDate=bind(this.saveDate,this),this.setDate=bind(this.setDate,this),this.convertToAccountTimezone=bind(this.convertToAccountTimezone,this),this.clear=bind(this.clear,this),this.updateInput=bind(this.updateInput,this),this.updateDate=bind(this.updateDate,this),this.remove=bind(this.remove,this),this.renderPicker=bind(this.renderPicker,this),this.render=bind(this.render,this),DateView.__super__.constructor.apply(this,arguments)}return extend(DateView,superClass),DateView.prototype.template=JST["templates/backbone_apps/poll/scheduled_lock_unlock"],DateView.prototype.UNSET_DATE="Not set",DateView.prototype.DATE_FORMAT="ddd MM/DD/YYYY",DateView.prototype.TIME_FORMAT="h:mm a",DateView.prototype.events={"click [value='dont']":"clear","click [value='fivemin']":"fivefrom","click [value='hour']":"hourfrom","click [value='day']":"dayfrom","click [value='custom']":"custom","click [type='radio']:not([value='custom'])":"notcustom"},DateView.prototype.initialize=function(opts){var _this;return this.options=opts,this.prop=opts.prop,this.listenTo(this.model,"change:"+this.prop,this.updateDate),this.listenTo(this.model,"change:"+this.prop,this.updateInput),"stop_at"===this.prop&&this.listenTo(this.model,"change:start_at",(_this=this,function(){if(0===_this.$("[type='radio'][value='custom']:checked").length)return _this.clear(),_this.render()})),this.input=this.$("input[type='hidden']")},DateView.prototype.render=function(){var isStart;return this.now="stop_at"!==this.prop||!this.model.get("start_at"),this.$(">div").remove(),isStart="start_at"===this.prop,this.label=isStart?"Auto-unlock time":"Auto-lock time",this.$el.prepend(this.template({header:this.label,radioname:isStart?"startin":"stopin",type:isStart?"unlock":"lock",fromnow:this.now,fromstart:!this.now})),this.renderPicker(),this.updateDate()},DateView.prototype.renderPicker=function(){var maxDate,_this;return maxDate=new Date((new Date).getTime()+15552e6),this.picker=new Pikaday({showTime:!0,timeLabel:this.options.timezoneLabel,use24hour:!1,incrementMinuteBy:5,minDate:new Date,maxDate:maxDate,format:"YYYY-MM-DDTHH:mm:ss",defaultDate:new Date,focusDateOnSelect:!0,onSelect:(_this=this,function(date){if(_this.picker.isVisible())return date=_this.picker.toString()+_this.options.timezone,_this.saveDate(date)})}),this.picker.hide(),this.$(".hyperedit > div").append(this.picker.el)},DateView.prototype.remove=function(){return this.picker.destroy(),DateView.__super__.remove.apply(this,arguments)},DateView.prototype.updateDate=function(){var date,time;return date=this.UNSET_DATE,time="",this.model.get(this.prop)&&(this.dateobj=this.convertToAccountTimezone(new Date(this.model.get(this.prop))),date=moment(this.dateobj).format(this.DATE_FORMAT),time=moment(this.dateobj).format(this.TIME_FORMAT),time+=" "+this.options.timezoneLabel),this.$(".date").text(date),this.$(".time").text(time),this.$(".dater").toggleClass("unset","Not set"===date)},DateView.prototype.updateInput=function(){return this.model.has(this.prop)?this.input.val(this.model.get(this.prop)):this.input.val("")},DateView.prototype.clear=function(){return this.setDate(null)},DateView.prototype.convertToAccountTimezone=function(date){var accountOffset,computerOffset,offset;return offset=parseFloat(this.options.timezone.replace(":",".")),computerOffset=6e4*date.getTimezoneOffset(),accountOffset=36e5*offset,new Date(date.getTime()+computerOffset+accountOffset)},DateView.prototype.setDate=function(date){var value;return value=date?date.toISOString():"",this.saveDate(value)},DateView.prototype.saveDate=function(date){return this.model.toggle(this.prop,{},date)},DateView.prototype.fivefrom=function(){var date;return(date=this.getFrom()).setMinutes(date.getMinutes()+5),this.setDate(date)},DateView.prototype.hourfrom=function(){var date;return(date=this.getFrom()).setHours(date.getHours()+1),this.setDate(date)},DateView.prototype.dayfrom=function(){var date;return(date=this.getFrom()).setDate(date.getDate()+1),this.setDate(date)},DateView.prototype.custom=function(){var adjustedDate,initialDate,minDate,minutesUntilHalfHour;return minDate=new Date((new Date).getTime()+3e5),initialDate=(this.model.get(this.prop)?new Date(this.model.get(this.prop)):void 0)||minDate,minutesUntilHalfHour=30-(adjustedDate=moment(this.convertToAccountTimezone(initialDate))).minute()%30,adjustedDate=adjustedDate.add("minutes",minutesUntilHalfHour),this.picker.setMinDate(minDate),this.picker.setMoment(adjustedDate),this.setDate(initialDate),this.picker.show(),this.$(".hyperedit").slideDown()},DateView.prototype.notcustom=function(){return this.picker.hide(),this.$(".hyperedit").slideUp(),!0},DateView.prototype.getFrom=function(){return this.now?new Date:Date.parseJSON(this.model.get("start_at"))},DateView}(Backbone.View),window.PollScheduleView=function(superClass){function PollScheduleView(){return this.render=bind(this.render,this),this.remove=bind(this.remove,this),PollScheduleView.__super__.constructor.apply(this,arguments)}return extend(PollScheduleView,superClass),PollScheduleView.prototype.initialize=function(opts){var $start,$stop;return $start=this.$("#schedulestart").length?this.$("#schedulestart"):"#schedulestart",$stop=this.$("#schedulestop").length?this.$("#schedulestop"):"#schedulestop",this.options=opts,this.startView=new DateView({el:$start,model:this.model,prop:"start_at",timezone:this.options.timezone,timezoneLabel:this.options.timezoneLabel,templateOverride:opts.templateOverride}),this.stopView=new DateView({el:$stop,model:this.model,prop:"stop_at",timezone:this.options.timezone,timezoneLabel:this.options.timezoneLabel,templateOverride:opts.templateOverride})},PollScheduleView.prototype.remove=function(){return this.startView.remove(),this.stopView.remove(),PollScheduleView.__super__.remove.apply(this,arguments)},PollScheduleView.prototype.render=function(){return this.startView.render(),this.stopView.render()},PollScheduleView}(Backbone.View)}.call(this),function(){var $,defaults;$=jQuery,defaults={position:{my:"right center",at:"left center"},hide:{event:"mouseleave unfocus",delay:400,fixed:!0},show:{event:"mouseenter",solo:!0,delay:400},style:{classes:"qtip-pe-black",tip:{width:20,height:7}},events:{render:function(event,api){return $(api.elements.tooltip).click(function(){return api.hide()})}}},$.fn.tooltip=function(opts){return null==opts&&(opts={}),$(this).qtip(_.defaults(opts,defaults))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/my_polls/my_polls"]=function(){return function(context){return function(){var $o;return($o=[]).push("<div class='header hidden polls-bulk-controls'>\n  <button class='element-button element-button--fullwidth element-button-primary new-poll' js-fixed-create-poll data-trackable-href='/my/polls#!/my/polls/new'>Create</button>\n  <ul class='horizontal menu'>\n    <li class='element-search-box' role='search'>\n      <input type='text' placeholder='Search by activity title' aria-label='Search by activity title'>\n      <div class='element-search-box__search'></div>\n      <button class='element-search-box__clear'></button>\n    </li>\n    <li class='bulk-controls'>\n      <div class='vue'></div>\n    </li>\n  </ul>\n</div>\n<div class='hidden multi-edit'></div>\n<div class='body hidden'>\n  <div id='owners'></div>\n  <div class='hidden load-more'>\n    <button>Load more</button>\n    <div class='load-more--status'></div>\n  </div>\n  <div class='hidden' id='explain_alone_on_account_with_teams_enabled'>\n    <div class='notice'>\n      <a class='light-blue right_tip tip' href='javascript:void(0)' tip='Only users in the same team can collaborate on activities. The account administrator must enable <a href=\"/features/team-collaboration\" target=\"_blank\" rel=\"noopener\">Team Collaboration</a> and then assign you to a <a href=\"/support/articles/account-management/teams\" target=\"_blank\" rel=\"noopener\">team</a>.'>Why don't I see other people here?</a>\n    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(context)}}.call(this)}.call(this),function(){var $;($=jQuery).fn.disable=function(){return this.each(function(){return $(this).prop("disabled",!0)})},$.fn.enable=function(){return this.each(function(){return $(this).prop("disabled",!1)})}}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;PollEv.namespace("PollEv.Editor.View",function(View){var PER_PAGE,addGroups,addPolls,bulkControlMenuItems,checkBrowserVersion,clearActivationState,clearSearch,createGroupWithPolls,downloadSlides,enablePositionManager,generateSlideData,getView,handleActivate,handleAdd,handleCheck,handleConvert,handleDuplicate,handleEditEvent,handleExpand,handleReportEvent,hideSpinner,inconsistentGroupData,initSearchView,lockUnlockActivities,reloadGroup,renderBulkControls,renderInvitationsNagger,renderSortPollsBy,search,searchOnInput,shareGroup,showShareModal,showSpinner,toggleEmptyState,toggleMoveToUser,trashSuccessMessage,userViewOptions;return PollEv.Util.regexSearch,PER_PAGE=50,enablePositionManager=function(self){return self.repoMan=new PollEv.Component.ActivitySelector.PositionManager({containerEl:self.$("#owners"),canMove:function(model){return model.get("owner_id")===self.app.user.id||self.app.user.isAdmin()||self.app.user.isOwner()}}),self.listenTo(self.repoMan,"error",function(statusCode,textStatus,data){var $textStatus,ref,ref1;return $textStatus=$("<span />",{text:"Please wait one moment while we update the new order."}),self.app.users.forEach(function(user){var groupActivitiesProm,view;if(view=getView(self,user.id))return groupActivitiesProm=view.groups.filter(function(group){return!group.get("collapsed")}).map(function(group){return group.activities.fetch({add:!0,remove:!0,merge:!0})}),$.when.apply($,groupActivitiesProm).then(function(){return enablePositionManager(self),self.app.trigger("notify:clear")})}),self.app.trigger("notify:error",$textStatus.append(" ",$textStatus),{autoHideAfter:-1}),"undefined"!=typeof rollbar&&null!==rollbar?rollbar.error("Positioning Error",{status:data.xhr.status,data:data.xhr.data,model:data.model.pick("type","id"),target:data.target.pick("type","id"),prev:null!=(ref=data.prev)?ref.pick("type","id"):void 0,next:null!=(ref1=data.next)?ref1.pick("type","id"):void 0}):void 0}),self.listenTo(self.repoMan,"move:group",function(){return self.trigger("view:action","reposition:group")}),self.listenTo(self.repoMan,"move:activity",function(arg){var eventName,fromCollection,fromGroup,fromSurvey,model,target,targetIsSurvey;return model=arg.model,fromCollection=arg.fromCollection,target=arg.target,arg.prev,arg.next,targetIsSurvey=target instanceof PollEv.Model.Survey,fromGroup=fromCollection instanceof PollEv.Model.ActivityCollection,fromSurvey=fromCollection instanceof PollEv.Model.Polls&&fromCollection.survey,eventName=fromGroup&&targetIsSurvey?"reposition:into_survey":fromSurvey&&!targetIsSurvey?"reposition:out_of_survey":"reposition:activity",self.trigger("view:action",eventName,{type:model.type()})})},trashSuccessMessage=function(activityCount){var $successMessage,activityCountSnippet;return($successMessage=$("<div/>")).append("Visit trash to restore activities or delete them forever."),activityCountSnippet=PollEv.Util.pluralize(activityCount,"activity",{includeNumber:!0})+" moved to trash",$successMessage.prepend($("<div/>").addClass("component-notification--toast__header").text(activityCountSnippet))},lockUnlockActivities=function(self,lock,polls,surveys,competitions,groups){var action,data,job,url;return data={group_ids:groups.map(function(model){return model.id}),poll_ids:polls.map(function(model){return model.id}),survey_ids:surveys.map(function(model){return model.id}),competition_ids:competitions.map(function(model){return model.id})},url="/api/activities/"+(action=lock?"lock":"unlock"),(job=PollEv.RailsApp.Util.makeJob(data,url,action)).on("complete",function(data){return data.forEach(function(set){var ref,userView;return(userView=getView(self,null!=(ref=set.owner)?ref.id:void 0)).groups.add(set.groups,{merge:!0}),set.groups.forEach(function(groupSet){var group;if(group=userView.groups.get(groupSet.id))return group.activities.set(groupSet.activities),(surveys=_.filter(groupSet.activities,function(obj){return"survey"===obj.type})).forEach(function(obj){var id,ref1;return id=group.activities.modelId(obj),null!=(ref1=group.activities.get(id))?ref1.polls.set(obj.polls):void 0}),(competitions=_.filter(groupSet.activities,function(obj){return"competition"===obj.type})).forEach(function(obj){var id,ref1;return id=group.activities.modelId(obj),null!=(ref1=group.activities.get(id))?ref1.polls.set(obj.polls):void 0})}),userView.clearSelected()})}),job},generateSlideData=function(polls,surveys,competitions){var slides;return slides=[],polls.forEach(function(poll){var url;return url=PollEv.env.get("api_url").path(poll.showUrl()).toString(),slides.push({title:poll.get("title"),url:url})}),surveys.forEach(function(survey){var url;return url=PollEv.env.get("api_url").path(survey.showUrl()).toString(),slides.push({title:survey.name(),url:url}),survey.polls.each(function(poll){return url=PollEv.env.get("api_url").path(poll.showUrl()).toString(),slides.push({title:poll.get("title"),url:url})})}),competitions.forEach(function(competition){return competition.polls.each(function(poll){var url;return url=PollEv.env.get("api_url").path(poll.showUrl()).toString(),slides.push({title:poll.get("title"),url:url})})}),slides},downloadSlides=function(self,polls,surveys,competitions){var $brandEl,$slideEl,brand,data,ref;return data=JSON.stringify(generateSlideData(polls,surveys,competitions)),$slideEl=$("<input type='hidden' name='slides'></input>").val(data),brand=(null!=(ref=self.app.user.get("features"))?ref.use_liveslides:void 0)?"liveslides":"polleverywhere",$brandEl=$("<input type='hidden' name='brand'></input>").val(brand),$("<form method='post'></form>").attr("action",PollEv.env.get("slides_server_url").toString()).append($slideEl).append($brandEl).appendTo($("body")).submit().remove()},showSpinner=function(self){var spinner;return spinner=$("<div/>",{"class":"loading-spinner"}).append(new PollEv.Spinner({zIndex:10}).spin().el),self.$("#owners").append(spinner)},hideSpinner=function(self){return self.$("#owners .loading-spinner").remove()},search=function(self){var inputVal;return(inputVal=self.$(".element-search-box input[type='text']").val().trim()).length>0&&inputVal!==self._lastSearchValue?(self._lastSearchValue=inputVal,self.selectNone(),showSpinner(self),null==self.searchView&&initSearchView(self),self.searchView.search(inputVal),self.trigger("view:action","search")):0===inputVal.length&&null!=self.searchView?clearSearch(self):void 0},searchOnInput=function(self){var inputVal;return(inputVal=self.$(".element-search-box input[type='text']").val().trim()).length>2&&inputVal!==self._lastSearchValue?search(self):0===inputVal.length&&null!=self.searchView?clearSearch(self):void 0},clearSearch=function(self){var promises,ref;return self.selectNone(),self.$(".element-search-box input[type='text']").val(""),self._lastSearchValue="",null!=(ref=self.searchView)&&ref.remove(),self.searchView=null,showSpinner(self),promises=self.users.map(function(user){var ref1;return null!=(ref1=user.view)?ref1.reload():void 0}),$.when.apply(self.users,promises).then(function(){return self.$("#owners .component-activity-selector__user").show(),hideSpinner(self)})},userViewOptions=function(self,user){var hasTeam,isAdmin,isCurrentUser,onMyPolls,sharedActivitiesEnabled,sharingEnabled;return isAdmin=self.app.user.isAdmin()||self.app.user.isOwner(),isCurrentUser=self.app.user.id===user.id,onMyPolls=window.location.pathname.includes("my/polls"),sharedActivitiesEnabled=self.app.user.get("features").shared_activities,hasTeam=self.app.user.get("team_ids").length,{group:{addable:isCurrentUser,blockLink:!1,duplicatable:isCurrentUser,convertible:isCurrentUser,deletable:!1,editable:isCurrentUser||isAdmin,sharable:sharingEnabled=onMyPolls&&sharedActivitiesEnabled&&(isAdmin||hasTeam),showSharingDetails:sharingEnabled},competition:{addable:!1,activatable:!1,blockLink:!1,duplicatable:isCurrentUser,editable:!1,shareable:!1,convertible:!1,reportable:isCurrentUser},survey:{addable:isCurrentUser,activatable:isCurrentUser||isAdmin,blockLink:!1,duplicatable:isCurrentUser,editable:isCurrentUser||isAdmin,shareable:!1,convertible:isCurrentUser,reportable:isCurrentUser,poll:{editable:isCurrentUser,activatable:isCurrentUser||isAdmin,duplicatable:isCurrentUser,shareable:!1}},poll:{activatable:isCurrentUser||isAdmin,duplicatable:isCurrentUser,shareable:!1,editable:isCurrentUser||isAdmin,reportable:isCurrentUser}}},initSearchView=function(self){var ref;return null!=(ref=self.searchView)&&ref.remove(),self.searchView=new PollEv.Component.ActivitySelector.Search({users:self.users,user:function(user){return userViewOptions(self,user)}}),self.listenTo(self.searchView,"check",_.partial(handleCheck,self)),self.listenTo(self.searchView,"share",_.partial(showShareModal,self)),self.listenTo(self.searchView,"duplicate",_.partial(handleDuplicate,self)),self.listenTo(self.searchView,"edit",_.partial(handleEditEvent,self)),self.listenTo(self.searchView,"activate",_.partial(handleActivate,self)),self.listenTo(self.searchView,"add",_.partial(handleAdd,self)),self.listenTo(self.searchView,"convert",_.partial(handleConvert,self)),self.listenTo(self.searchView,"expand",_.partial(handleExpand,self)),self.listenTo(self.searchView,"report",_.partial(handleReportEvent,self)),self.listenTo(self.searchView,"done",function(){return self.$("#owners .component-activity-selector__user").hide(),hideSpinner(self)}),self.$("#owners").after(self.searchView.render().$el)},inconsistentGroupData=function(group){return group.activities.length!==group.get("activities_count")},addGroups=function(self,groups){return groups.forEach(function(group){var view;if(view=getView(self,group.get("owner_id")))return group.set({collapsed:!0},{silent:!0}),view.groups.add(group)})},reloadGroup=function(self,groupId){var group,view;if((view=getView(self,self.app.user.id))&&(group=view.groups.get(groupId)))return group.fetch().then(function(){if(inconsistentGroupData(group)||!group.isRealGroup())return group.activities.fetch()})},renderSortPollsBy=function(self,order){var $groups,$groupsContainer;return $groupsContainer=($groups=self.$("[data-type='group']:visible")).parent(),$groups.detach(),$groups.map(function(idx,group){var $groupActivities,$groupActivitiesContainer,$sortedGroupActivities;return $groupActivitiesContainer=($groupActivities=$(".component-activity-selector__group__activities > [data-position]",group)).parent(),$sortedGroupActivities=$groupActivities.sort(function(a,b){return naturalSort.insensitive=!0,naturalSort($(a).data("model").get(order),$(b).data("model").get(order))}),$groupActivities.detach(),$groupActivitiesContainer.append($sortedGroupActivities),group}),$groupsContainer.append($groups),self},getView=function(self,userId){var user;return null!=(user=_.find(self.users,function(user){return user.id===userId}))?user.view:void 0},addPolls=function(self,models){return(Array.isArray(models)?models:[models]).map(function(poll){var view;if(view=getView(self,poll.get("owner_id")))return poll.set({group_id:poll.get("group_id")||-1}),view.groups.get(poll.get("group_id")).activities.add(poll)})},shareGroup=function(self,model){var view;return view=new View.Polls.ShareGroup({model:model,orgName:self.app.user.get("organization")}),$(".site-container").hide(),$("body").append(view.render().$el),self.toast=new PollEv.Component.Notification({mode:"toast",autoLink:!0}),$("body").append(self.toast.render().$el),self.listenTo(view,"success",function(message,options){return null==options&&(options={}),view.trigger("dismiss"),self.toast.success(message,options),self.trigger("view:action","shared_with_presenter")}),self.listenTo(view,"error",function(message,options){return null==options&&(options={}),view.trigger("dismiss"),self.toast.error(message,options)}),self.listenTo(view,"dismiss",function(){var event;return view.remove(),$(".site-container").show(),(event=document.createEvent("Event")).initEvent("resize",!1,!0),window.dispatchEvent(event)})},checkBrowserVersion=function(self){return Backbone.ajax({url:"/api/browser_check",data:"app=rails"}).done(function(info){var banner;if("unsupported"===info.status)return(banner=new PollEv.Component.Notification({mode:"banner-alert",autoLink:!0,autoHideAfter:-1})).render(),self.$(".body").before(banner.$el),banner.warning("<b>Outdated web browser</b><br />Please update your web browser for a better Poll Everywhere experience. <a href='/support/articles/troubleshooting/supported-browsers'>Learn more</a>")})},showShareModal=function(self,model){var $share,link,ref,share;return model instanceof PollEv.Model.Group?self.app.user.get("features").shared_activities?shareGroup(self,model):(link="/profile/account_settings/edit",self.toast.notice("You must <a href="+link+">enable teams</a> to start sharing",{autoHideAfter:-1})):(share=new PollEv.Editor.View.Activities.Share({model:model,activityType:model instanceof PollEv.Model.Survey?"survey":"poll"}),self.listenTo(share,"view:action",function(name,data,options){return self.trigger("view:action","activity_row:"+name,data,options)}),self.trigger("view:action","show_share_modal"),$share=share.render().$el,share.hideSecondaryActions(),null!=(ref=self.dialog)&&ref.remove(),self.dialog=new PollEv.Component.Modal.Dialog({content:$share,size:"medium",header:{title:"Share"},actions:{primary:"Done",secondary:"More sharing options"}}),self.dialog.open(),self.listenTo(self.dialog,"click:primary",function(){return self.dialog.close()}),self.listenTo(self.dialog,"click:secondary",function(){return self.dialog.$(".modal-dialog--secondary").toggleVisibility(!1),share.showSecondaryActions()}))},createGroupWithPolls=function(name,polls,surveys,competitions){var data,group;return group=new PollEv.Model.Group,data={name:name||"New group",poll_ids:_.pluck(polls,"id"),survey_ids:_.pluck(surveys,"id"),competition_ids:_.pluck(competitions,"id")},group.save(data).then(function(){return surveys.forEach(function(survey){return survey.collection.remove(survey),survey.set({group_id:group.id})}),competitions.forEach(function(competition){return competition.collection.remove(competition),competition.set({group_id:group.id})}),polls.forEach(function(p){return p.collection.remove(p),p.set({group_id:group.id})}),group.activities.add(_.union(polls,surveys,competitions)),group})},clearActivationState=function(self,userId){var activatedEl;if((activatedEl=getView(self,userId).$(".component-activity-selector__poll--activated, .component-activity-selector__survey--activated")).length)return activatedEl.data("model").set({current:!1})},handleActivate=function(self,model){var type;return type=model instanceof PollEv.Model.Poll?"poll":model.get("type"),model.get("current")?(self.trigger("view:action","deactivate",{activity_type:type}),model.deactivate()):(clearActivationState(self,model.get("owner_id")),self.trigger("view:action","activate",{activity_type:type}),model.activate())},handleCheck=function(self){var _this;return[this.moveView,this.copyView,this.multiEditView].forEach((_this=this,function(view){return view.updateSelectedActivities({competitions:_this.selectedCompetitions(),polls:_this.selectedPolls(),surveys:_this.selectedSurveys(),groups:_this.selectedGroups()})})),self._selectedObjects(),toggleMoveToUser(self)},handleDuplicate=function(self,model){var data,job,notifyDuplicate,url;return notifyDuplicate=function(noticeType,modelType){var notice;return notice="success"===noticeType?modelType+" duplicated successfully.":"error"===noticeType?"Failed to duplicate "+modelType+".":void 0,self.app.trigger("notify:"+noticeType,PollEv.Util.capitalize(notice))},model instanceof PollEv.Model.Poll?model.duplicate({data:{exclude:"options,results,flash_options,visual_settings"}}).then(function(obj){return obj.error?$.notify(obj.error):(model.collection.add(obj),self.trigger("view:action","copy",{type:"poll"}),notifyDuplicate("success","activity"))}).fail(function(){return notifyDuplicate("error","activity")}).always(function(){var surveyModel;if(isActiveSurveyPoll)return(surveyModel=model.collection.survey).trigger("change:current",surveyModel,!0)}):model instanceof PollEv.Model.Survey?model.duplicate({data:{include:"poll_instances",exclude:"options,results,flash_options,visual_settings"}}).then(function(json){return model.collection.add(json),self.trigger("view:action","copy",{type:"survey"}),notifyDuplicate("success","activity")}).fail(function(){return notifyDuplicate("error","activity")}):model instanceof PollEv.Model.Competition?model.duplicate({data:{exclude:"visual_settings"}}).then(function(json){return model.collection.add(json),self.trigger("view:action","copy",{type:"competition"}),notifyDuplicate("success","activity")}).fail(function(){return notifyDuplicate("error","activity")}):model instanceof PollEv.Model.Group?(data={group_ids:[model.id]},url="/api/activities/copy",(job=PollEv.RailsApp.Util.makeJob(data,url,"duplicate group")).on("complete",function(data){var groups;return groups=data.map(function(json){var group;return(group=new PollEv.Model.Group(json)).activities.add(json.activities),group}),addGroups(self,groups),notifyDuplicate("success","group"),self.trigger("view:action","copy",{type:"group"})}),job.on("fail",function(){return notifyDuplicate("error","group")})):void 0},handleExpand=function(self,model){return model instanceof PollEv.Model.Group?self.trigger("view:action","expand",{type:"group"}):self.trigger("view:action","expand",{type:model.type()})},handleConvert=function(self,model){var convertToType,modelType;if(modelType=("function"==typeof model.type?model.type():void 0)||"group",convertToType=model instanceof PollEv.Model.Group?"survey":model instanceof PollEv.Model.Survey?"group":void 0)return self.trigger("view:action","convert",{type:convertToType}),model.collection.remove(model),model.convertTo(convertToType).fail(function(){return self.app.trigger("notify:error","Failed to convert "+modelType+" to a "+convertToType+". Please refresh and try again.",arguments)}).then(function(data){var confirmationMessage,group,ref,survey,view;if(view=getView(self,model.get("owner_id"))){switch(confirmationMessage=modelType+" converted to "+convertToType+" successfully",convertToType){case"group":(group=new PollEv.Model.Group(data)).activities.add(data.polls),group.set({collapsed:!1}),null!=view&&null!=(ref=view.groups)&&ref.add(group);break;case"survey":reloadGroup(self,-1),survey=new PollEv.Model.Survey(data),null!=(group=view.groups.get(-1))&&group.activities.add(survey),confirmationMessage+=' in "Ungrouped"'}return self.app.trigger("notify:success",PollEv.Util.capitalize(confirmationMessage+"."))}})},handleAdd=function(self,model){return self.trigger("view:action","add"),self.app.trigger("create_poll",{target:model})},handleEditEvent=function(self,model){return self.trigger("view:action","edit",{},{immediate:!0}),model instanceof PollEv.Model.Group?PollEv.Component.Modal.prompt("Update group name",model.get("name"),{simpleTitle:"Edit group",actions:{primary:"Update name"},validator:function(val){return val.trim().length>0}}).then(function(val){return model.save({name:val},{patch:!0}).fail(function(){return self.app.trigger("notify:error","Saving the updated group name failed",arguments)})}):window.location.href=model.editUrl()},handleReportEvent=function(self,model){var resultsUrl;return(resultsUrl=model.resultsUrl&&model.resultsUrl())?window.location=resultsUrl:"competition"===model.type()?window.location=model.showUrl()+"/results":self.redirectToCreateReport(model.polls.pluck("id")||model.id,"summary")},bulkControlMenuItems=function(_view){var controls,menuItems
;return menuItems=[(controls=PollEv.Component.BulkControls.Controls).select,controls.sort,controls.group,controls.ungroup,controls.download,controls.report,controls.clear,controls.trash,controls.edit,controls.move,controls.copy,controls.lock,controls.unlock],_view.app.user.get("features").poll_sorting||(menuItems=menuItems.filter(function(control){return"sort"!==control.name})),_view.app.user.get("user_count")<2&&(menuItems=menuItems.filter(function(control){return"copy"!==control.name})),menuItems},renderInvitationsNagger=function(self){var $banner;if(($banner=$(".component-notification--banner-alert").detach()).length>=1)return self.$(".body").before($banner)},renderBulkControls=function(){var _view,_this;return _view=this,PollEv.Util.inDOM(this.$(".bulk-controls > .vue").get(0)).then((_this=this,function(){return _this.bulkControlsVue=_this.bulkControlsVue||new Vue({data:{selectedObjects:[]},render:function(h){return h(PollEv.Component.BulkControls,{props:{selectedItems:this.selectedObjects,user:_view.app.user,controls:bulkControlMenuItems(_view)},on:{click:function(bulkAction){if(bulkAction)switch(bulkAction){case"select-all":return _view.selectAll();case"select-none":return _view.selectNone();case"select-unlocked":return _view.selectStarted();case"select-locked":return _view.selectStopped();case"collapse-all":return _view.collapseAllGroups();case"sort-myorder":return _view.sortByMine();case"sort-title":return _view.sortByTitle();case"sort-created":return _view.sortByDateCreated();case"group":return _view.debouncedGroupPolls();case"ungroup":return _view.ungroupPolls();case"report":return _view.generateReport();case"clear":return _view.clearSelected();case"trash":return _view.trashSelected();case"edit":return _view.toggleMultiEdit();case"move":return _view.toggleMoveMultiEdit();case"copy":return _view.toggleCopyMultiEdit();case"download-slides":return _view.downloadSlides();case"download-screenshots":return _view.downloadScreenshots();case"lock":return _view.stopSelected();case"unlock":return _view.startSelected()}}}})}}).$mount(_view.$(".bulk-controls > .vue").get(0))}))},toggleEmptyState=function(show){var ref;return this.$(".polls-bulk-controls").toggleVisibility(!show),this.$(".multi-edit").toggleVisibility(!show),this.$(".body").toggleVisibility(!show),show?(this.emptyStateView=new PollEv.Component.AdvisoryMessage({icon:"poll-topic",subject:"Create a new activity",message:"Once created, polls and activities will appear here.",alignment:"center",resolutionLabel:"Create activity"}),this.listenTo(this.emptyStateView,"resolve",function(){return this.app.trigger("create_poll")}),this.$el.append(this.emptyStateView.render().$el)):(null!=(ref=this.emptyStateView)&&ref.remove(),this.showBulkControls?renderBulkControls.call(this):void 0)},toggleMoveToUser=function(self){var disable;return disable=self._selectedObjects().some(function(item){return item instanceof PollEv.Model.Group?item.get("shared_activity_groups").length:!!item.has("group_id")&&self.users[0].groups.get(item.get("group_id")).get("shared_activity_groups").length}),self.moveView.toggleMoveToUser(!disable)},View.Polls=function(superClass){function Polls(){return this.toggleLonelyBigAccountNotice=bind(this.toggleLonelyBigAccountNotice,this),this.render=bind(this.render,this),this.togglePollSorting=bind(this.togglePollSorting,this),this.ensureSelection=bind(this.ensureSelection,this),this.getSelected=bind(this.getSelected,this),this.toggleMultiEditMenu=bind(this.toggleMultiEditMenu,this),this.toggleMultiEdit=bind(this.toggleMultiEdit,this),this.toggleCopyMultiEdit=bind(this.toggleCopyMultiEdit,this),this.toggleMoveMultiEdit=bind(this.toggleMoveMultiEdit,this),this.downloadSlides=bind(this.downloadSlides,this),this.generateReport=bind(this.generateReport,this),this.ungroupPolls=bind(this.ungroupPolls,this),this.groupPolls=bind(this.groupPolls,this),this._selectedObjects=bind(this._selectedObjects,this),this.selectedCompetitions=bind(this.selectedCompetitions,this),this.selectedSurveys=bind(this.selectedSurveys,this),this.selectedGroups=bind(this.selectedGroups,this),this.selectedPolls=bind(this.selectedPolls,this),this.downloadScreenshots=bind(this.downloadScreenshots,this),this.clearSelected=bind(this.clearSelected,this),this.trashSelected=bind(this.trashSelected,this),this.stopSelected=bind(this.stopSelected,this),this.startSelected=bind(this.startSelected,this),this.sortByDateCreated=bind(this.sortByDateCreated,this),this.sortByTitle=bind(this.sortByTitle,this),this.sortByMine=bind(this.sortByMine,this),this.collapseAllGroups=bind(this.collapseAllGroups,this),this.selectStopped=bind(this.selectStopped,this),this.selectStarted=bind(this.selectStarted,this),this.selectNone=bind(this.selectNone,this),this.selectAll=bind(this.selectAll,this),this._loadMoreUsers=bind(this._loadMoreUsers,this),this._toggleMoreButton=bind(this._toggleMoreButton,this),this.showUsers=bind(this.showUsers,this),this.toggleFixedHeader=bind(this.toggleFixedHeader,this),this.resetFixedHeader=bind(this.resetFixedHeader,this),Polls.__super__.constructor.apply(this,arguments)}return extend(Polls,superClass),Polls.prototype.className="editor-polls",Polls.prototype.events={"keyup .element-search-box input[type='text']":function($evt){var ENTER_KEYCODE;return ENTER_KEYCODE=13,$evt.which===ENTER_KEYCODE?search(this):this.debounceSearchOnInput()},"click .element-search-box__clear":function(){return clearSearch(this)},"click .load-more":function(){return this._loadMoreUsers()},"click .load-more--all":function(){return this._loadMoreUsers(-1)}},Polls.prototype.initialize=function(opts){var _this;return this.emptyStateView=null,this.bulkControlsVue=null,this.copyStylesList=this.$("#copy_src_polls"),this.users=opts.users,this.showHeader=opts.showHeader,this.showingAllUsers=opts.showingAllUsers,this.showBulkControls=opts.showBulkControls,this.delayNagger=opts.delayNagger,this.multiEditView=new View.MultiEdit.Container({users:this.users}),this.moveView=new View.MultiEdit.Move({users:this.users}),this.copyView=new View.MultiEdit.Copy({users:this.users}),this.listenTo(this.multiEditView,"save",function(){return this.selectNone()}),this.listenTo(this.moveView,"new:groups",_.partial(addGroups,this)),this.listenTo(this.moveView,"update:group",_.partial(reloadGroup,this)),this.listenTo(this.moveView,"job:start",_.partial(showSpinner,this)),this.listenTo(this.moveView,"job:done",(_this=this,function(){return _this.selectNone(),hideSpinner(_this)})),this.listenTo(this.copyView,"new:groups",_.partial(addGroups,this)),this.listenTo(this.copyView,"update:group",_.partial(reloadGroup,this)),this.listenTo(this.copyView,"job:start",_.partial(showSpinner,this)),this.listenTo(this.copyView,"job:done",function(_this){return function(){return _this.selectNone(),hideSpinner(_this)}}(this)),this.listenTo(this.app.user,"activity:add",_.partial(addPolls,this)),this.debounceSearchOnInput=_.debounce(_.partial(searchOnInput,this),350),this.debouncedGroupPolls=_.debounce(this.groupPolls,350),this._loadedUserCount=0,this._lastSearchValue="",$(window).on("scroll",_.throttle(this.toggleFixedHeader,10)),$(".nag .close").click(this.resetFixedHeader)},Polls.prototype.resetFixedHeader=function(){return this.controlsHeight=this.originalPosition=0},Polls.prototype.toggleFixedHeader=function(e){var fixedHeader,ref;if(!this.$(".multi-edit-container").is(":visible"))return this.controlsHeight||(this.controlsHeight=this.$(".polls-bulk-controls").outerHeight()),this.originalPosition||(this.originalPosition=this.$(".body").position().top),(fixedHeader=((null!=e&&null!=(ref=e.currentTarget)?ref.scrollY:void 0)||$(window).scrollTop())>this.originalPosition+this.controlsHeight)?this.$(".body").css("padding-top",this.controlsHeight):this.$(".body").css("padding-top",0),this.$("[js-fixed-create-poll]").toggleClass("hidden",!fixedHeader),this.$(".polls-bulk-controls").toggleClass("fixed",fixedHeader),$(window).trigger("resize")},Polls.prototype.showUsers=function(){return 1===this.users.length&&showSpinner(this),this._loadMoreUsers(),this.$("#explain_alone_on_account_with_teams_enabled").toggleVisibility(!1)},Polls.prototype._nextBatch=function(howMany){var length,rangeEnd;return rangeEnd=this._loadedUserCount-1+howMany,length=this.users.length,(-1===howMany||length-rangeEnd<howMany)&&(rangeEnd=length-1),length?this.users.slice(this._loadedUserCount,+rangeEnd+1||9e9):[]},Polls.prototype._toggleMoreButton=function(){var hasMoreItems;return hasMoreItems=this._loadedUserCount<this.users.length,this.$(".load-more").toggleVisibility(hasMoreItems),this.$(".load-more--status").html("Currently showing "+this._loadedUserCount+" of "+this.users.length+' users.\n<a class="load-more--all">Load all</a>')},Polls.prototype._loadMoreUsers=function(howMany){var nextBatch,pageSize,views,_this;return null==howMany&&(howMany=PER_PAGE),pageSize=(nextBatch=this._nextBatch(howMany)).length,this._loadedUserCount+=pageSize,views=_.map(nextBatch,(_this=this,function(user){var options,view;return options=userViewOptions(_this,user),_.extend(options,{model:user,collapsed:_this.users.length>1,collapsible:_this.showHeader,collection:user.groups}),view=new PollEv.Component.ActivitySelector.User(options),_this.listenTo(view,"check",_.partial(handleCheck,_this)),_this.listenTo(view,"share",_.partial(showShareModal,_this)),_this.listenTo(view,"duplicate",_.partial(handleDuplicate,_this)),_this.listenTo(view,"edit",_.partial(handleEditEvent,_this)),_this.listenTo(view,"activate",_.partial(handleActivate,_this)),_this.listenTo(view,"add",_.partial(handleAdd,_this)),_this.listenTo(view,"convert",_.partial(handleConvert,_this)),_this.listenTo(view,"expand",_.partial(handleExpand,_this)),_this.listenTo(view,"report",_.partial(handleReportEvent,_this)),user.id!==_this.app.user.id&&1!==_this.users.length||_this.listenTo(view,"loading:done",function(){return _this.app.user.groups.add(view.groups.map(function(g){return g.clone()})),_this.app.trigger("activity_selector:ready",{groups:view.groups}),hideSpinner(_this),_this.listenTo(view,"addGroup",function(groupView){var ref;return null!=groupView&&null!=(ref=groupView.$el)?ref.addClass("to-flash"):void 0}),_this.listenTo(view,"sort",function(){var $groupView;return $groupView=view.$el.find(".to-flash").first(),_this.$(".to-flash, .flash-me").removeClass("to-flash flash-me"),$groupView.get(0).scrollIntoView(!1),$groupView.addClass("flash-me").delay(400).queue(function(){return $(this).removeClass("flash-me").dequeue()})})}),user.view=view,view})),this.appendView("#owners",views),this._toggleMoreButton()},Polls.prototype.selectAll=function(e){return null!=e&&e.preventDefault(),(null!=this.searchView?this.searchView.$el.find("input:checkbox:visible"):this.$("#owners input:checkbox:visible")).prop("checked",!0)},Polls.prototype.selectNone=function(e){return null!=e&&e.preventDefault(),(null!=this.searchView?this.searchView.$el.find("input:checkbox"):this.$("#owners input:checkbox")).prop("checked",!1).prop("indeterminate",!1)},Polls.prototype.selectStarted=function(e){return null!=e&&e.preventDefault(),this.selectNone(),(null!=this.searchView?this.searchView.$el:this.$("#owners")).find(".component-activity-selector__poll:visible").not(".component-activity-selector__poll--closed").find("input:checkbox").prop("checked",!0)},Polls.prototype.selectStopped=function(e){return null!=e&&e.preventDefault(),this.selectNone(),(null!=this.searchView?this.searchView.$el:this.$("#owners")).find(".component-activity-selector__poll--closed:visible").find("input:checkbox").prop("checked",!0)},Polls.prototype.collapseAllGroups=function(){return this.users.map(function(user){return user.view.groups.map(function(group){return group.isRealGroup()?group.save({collapsed:!0},{patch:!0}):group.set({collapsed:!0})})}),this.trigger("view:action","collapse_all_groups")},Polls.prototype.sortByMine=function(e){return null!=e&&e.preventDefault(),renderSortPollsBy(this,"position"),this.trigger("view:action","sort",{sort_by:"position"})},Polls.prototype.sortByTitle=function(e){return null!=e&&e.preventDefault(),renderSortPollsBy(this,"title"),this.trigger("view:action","sort",{sort_by:"title"})},Polls.prototype.sortByDateCreated=function(e){return null!=e&&e.preventDefault(),renderSortPollsBy(this,"created_at"),this.trigger("view:action","sort",{sort_by:"created_at"})},Polls.prototype.startSelected=function(e){return null!=e&&e.preventDefault(),this.ensureSelection((_this=this,function(polls,surveys,competitions,groups){var job;return null==polls&&(polls=[]),null==surveys&&(surveys=[]),null==competitions&&(competitions=[]),null==groups&&(groups=[]),_this.trigger("view:action","start_selected",{poll_count:polls.length,survey_count:surveys.length,competition_count:competitions.length,group_count:groups.length}),(job=lockUnlockActivities(_this,!1,polls,surveys,competitions,groups)).on("complete",function(){return _this.app.trigger("notify:success","Unlocked selected activities")}),job.on("fail",function(){return _this.app.trigger("notify:error","Uh oh. We couldn't unlock the selected activities.")})}));var _this},Polls.prototype.stopSelected=function(e){return null!=e&&e.preventDefault(),this.ensureSelection((_this=this,function(polls,surveys,competitions,groups){var job;return null==polls&&(polls=[]),null==surveys&&(surveys=[]),null==competitions&&(competitions=[]),null==groups&&(groups=[]),_this.trigger("view:action","stop_selected",{poll_count:polls.length,survey_count:surveys.length,competition_count:competitions.length,group_count:groups.length}),(job=lockUnlockActivities(_this,!0,polls,surveys,competitions,groups)).on("complete",function(){return _this.app.trigger("notify:success","Locked selected activities")}),job.on("fail",function(){return _this.app.trigger("notify:error","Uh oh. We couldn't lock the selected activities.")})}));var _this},Polls.prototype.trashSelected=function(e){return null!=e&&e.preventDefault(),this.ensureSelection((_this=this,function(polls,surveys,competitions,groups){var data,job,url;return null==polls&&(polls=[]),null==surveys&&(surveys=[]),null==competitions&&(competitions=[]),null==groups&&(groups=[]),_this.trigger("view:action","trash_selected",{poll_count:polls.length,survey_count:surveys.length,competition_count:competitions.length,group_count:groups.length}),data={poll_ids:_.pluck(polls,"id"),survey_ids:_.pluck(surveys,"id"),competition_ids:_.pluck(competitions,"id"),group_ids:_.pluck(groups,"id")},url="/api/activities/trash",(job=PollEv.RailsApp.Util.makeJob(data,url,"trash")).on("fail",function(){return _this.trashToast.error("Error moving activities to the trash - please try again later")}),job.on("complete",function(){var $successMessage,activityCount,reducer,totalActivityCount;return activityCount=groups.reduce(function(acc,group){return acc+group.activities.length},0)+surveys.length+competitions.length+polls.length,groups.forEach(function(group){return group.collection.remove(group)}),surveys.forEach(function(survey){return survey.collection.remove(survey)}),competitions.forEach(function(competition){return competition.collection.remove(competition)}),polls.forEach(function(poll){return poll.collection.remove(poll)}),0===activityCount&&groups.length>0?($successMessage=$("<div/>")).addClass("component-notification--toast__header").text(groups.length+" group"+(groups.length>1?"s":"")+" permanently deleted."):$successMessage=trashSuccessMessage(activityCount),_this.trashToast.success($successMessage[0]),_this.selectNone(e),reducer=function(count,group){return count+group.activities.length},totalActivityCount=_this.app.user.groups.reduce(reducer,0),toggleEmptyState.call(_this,0===totalActivityCount)})}));var _this},Polls.prototype.clearSelected=function(e){return null!=e&&e.preventDefault(),this.ensureSelection((_this=this,function(polls,surveys,competitions,groups){var html,name,reportText;return null==polls&&(polls=[]),null==surveys&&(surveys=[]),null==competitions&&(competitions=[]),null==groups&&(groups=[]),_this.trigger("view:action","clear_selected",{poll_count:polls.length,survey_count:surveys.length,competition_count:competitions.length,group_count:groups.length}),name=(new XDate).toString("MMMM d, yyyy 'at' h:mm:ss TT"),reportText="You can access these in Reports.",_this.app.user.get("features").reports||(reportText="Paid accounts can access these in Reports.\n<p>You will not have access to this archived data unless you upgrade to a paid account."),html="<p>Clearing will save your responses as an archived run. "+reportText+"\n<p>Name this archive:",PollEv.Component.Modal.prompt(html,name,{allowHtml:!0,header:{title:"Clear and archive responses"}}).then(function(name){var data,url;return url="/api/activities/clear",data={name:name,group_ids:_.pluck(groups,"id"),survey_ids:_.pluck(surveys,"id"),competition_ids:_.pluck(competitions,"id"),poll_ids:_.pluck(polls,"id"),presenter_id:_this.bulkControlsVue.selectedObjects[0].get("owner_id")},PollEv.RailsApp.Util.makeJob(data,url,"clear results").on("complete",function(){return polls.forEach(function(poll){return poll.set({results_count:0})}),surveys.forEach(function(survey){return survey.polls.forEach(function(poll){return poll.set({results_count:0})})}),competitions.forEach(function(competition){return competition.set("results_count",0),competition.polls.forEach(function(poll){return poll.set({results_count:0})})}),groups.forEach(function(group){return group.activities.forEach(function(activity){return activity instanceof PollEv.Model.Poll?activity.set({results_count:0}):activity instanceof PollEv.Model.Survey?activity.polls.forEach(function(poll){return poll.set({results_count:0})}):void 0})}),_this.selectNone(e)})})}));var _this},Polls.prototype.downloadScreenshots=function(e){return null!=e&&e.preventDefault(),this.ensureSelection(10,(_this=this,function(polls,surveys,competitions,groups){var name,poll,url;return null==polls&&(polls=[]),null==surveys&&(surveys=[]),null==competitions&&(competitions=[]),null==groups&&(groups=[]),_this.trigger("view:action","download_screenshots",{poll_count:polls.length,survey_count:surveys.length,competition_count:competitions.length,group_count:groups.length}),groups.forEach(function(group){return group.activities.each(function(activity){return activity instanceof PollEv.Model.Survey&&surveys.push(activity),activity instanceof PollEv.Model.Competition?competitions.push(activity):polls.push(activity)})}),surveys.forEach(function(survey){return polls=polls.concat(survey.polls.toArray())}),competitions.forEach(function(competition){return polls=polls.concat(competition.polls.toArray())}),1===polls.length?(name=(poll=polls[0]).cleanTitle(),name=_.str.slugify(name),url=poll.screenshotUrl({attachment:!0,name:name,_:Date.now(),viewport:"1600x900"}),window.location.href=url):_this.supportsJSZip()?_this.downloadMultipleScreenshots(polls):alert("Downloading more than 1 screenshot at a time is not supported in your browser.")}));var _this},Polls.prototype.supportsJSZip=function(){return _.isFunction(saveAs)&&(!$.browser.safari||$.browser.safari&&parseFloat($.browser.version)>=10.1)},Polls.prototype.downloadMultipleScreenshots=function(polls){var downloads;return 0,downloads=_.map(polls,function(poll,idx){var deferred,name,url;return name=idx+1+" "+(name=poll.cleanTitle()),name=_.str.slugify(name),url=poll.screenshotUrl({attachment:!0,name:name,_:Date.now(),viewport:"1600x900"}),deferred=$.Deferred(),JSZipUtils.getBinaryContent(url,function(err,data){return name=name.substring(0,50)+".png",err?deferred.reject(err.message):deferred.resolve({filename:name,data:data})}),deferred}),$.when.apply($,downloads).done(function(){var blob,files,zip;return files=1<=arguments.length?slice.call(arguments,0):[],zip=new JSZip,files.forEach(function(file){return zip.file(file.filename,file.data)}),blob=zip.generate({type:"blob"}),saveAs(blob,"poll-screenshots.zip")}).fail(function(){var errors;return errors=1<=arguments.length?slice.call(arguments,0):[],alert("Errors were encountered when generating screenshots.\n\n"+errors.join(". "))})},Polls.prototype.selectedPolls=function(){return _.filter(this._selectedObjects(),function(model){return model instanceof PollEv.Model.Poll})},Polls.prototype.selectedGroups=function(){return _.filter(this._selectedObjects(),function(model){return model instanceof PollEv.Model.Group&&-1!==model.get("id")})},Polls.prototype.selectedSurveys=function(){return _.filter(this._selectedObjects(),function(model){return model instanceof PollEv.Model.Survey})},Polls.prototype.selectedCompetitions=function(){return _.filter(this._selectedObjects(),function(model){return model instanceof PollEv.Model.Competition})},Polls.prototype._selectedObjects=function(){var models,objects;return null!=this.searchView?objects=this.searchView.getSelected():(models=this.users.map(function(user){var ref;return null!=(ref=user.view)?ref.getSelected():void 0}),objects=_.compact(_.flatten(models))),this.bulkControlsVue&&(this.bulkControlsVue.selectedObjects=objects),objects},Polls.prototype.groupPolls=function(e){var competitions,groups,itemCount,polls,prompt,ref,surveys,title,_this;return null!=e&&e.preventDefault(),ref=this.getSelected(),polls=ref.polls,surveys=ref.surveys,competitions=ref.competitions,groups=ref.groups,this.trigger("view:action","group_polls",{poll_count:polls.length,survey_count:surveys.length,competitions_count:competitions.length,group_count:groups.length}),(itemCount=polls.length+surveys.length+competitions.length)>0?(prompt=itemCount+" selected "+PollEv.Util.pluralize(itemCount,"activity")+" will be moved into this group.",title="Create new group"):(prompt="No activities selected.",title="Create empty group"),PollEv.Component.Modal.prompt(prompt,"",{simpleTitle:title,actions:{primary:"Create group"},placeholder:"Group name"}).then((_this=this,function(name){return polls=polls.concat(groups.map(function(group){return group.activities.filter(function(activity){return activity instanceof PollEv.Model.Poll})})),polls=_.flatten(polls),surveys=surveys.concat(groups.map(function(group){return group.activities.filter(function(activity){return activity instanceof PollEv.Model.Survey})})),surveys=_.flatten(surveys),competitions=competitions.concat(groups.map(function(group){return group.activities.filter(function(activity){return activity instanceof PollEv.Model.Competition})})),competitions=_.flatten(competitions),createGroupWithPolls(name.trim(),polls,surveys,competitions).then(function(group){var ref1;return null!=(ref1=getView(_this,_this.app.user.id))&&ref1.groups.add(group),_this.app.user.groups.add(group),_this.selectNone(e)})}))},Polls.prototype.ungroupPolls=function(e){return null!=e&&e.preventDefault(),this.ensureSelection((_this=this,function(polls,surveys,competitions,groups){var data,job,url;return null==polls&&(polls=[]),null==surveys&&(surveys=[]),null==competitions&&(competitions=[]),null==groups&&(groups=[]),polls=_.reject(polls,function(poll){return poll.get("survey_id")||poll.get("competition_id")}),_this.trigger("view:action","ungroup_polls",{poll_count:polls.length,survey_count:surveys.length,competition_count:competitions.length,group_count:groups.length}),data={poll_ids:_.pluck(polls,"id"),survey_ids:_.pluck(surveys,"id"),competition_ids:_.pluck(competitions,"id"),group_ids:_.pluck(groups,"id")},url="/api/activities/ungroup",(job=PollEv.RailsApp.Util.makeJob(data,url,"ungroup")).on("fail",function(){var $reloadLink;return $reloadLink=$("<a />").attr("href",window.location.href).text("Please refresh to see the latest."),_this.app.trigger("notify:error",$reloadLink)}),job.on("complete",function(data){return _.flatten(_.union(polls,surveys,competitions,groups.map(function(group){return group.activities.models}))).map(function(activity){return activity.collection.remove(activity)}),data.forEach(function(activity){var ref;return(null!=(ref=getView(_this,_this.app.user.id))?ref.groups.get(-1):void 0).activities.add(activity)}),_this.selectNone(e)})}));var _this},Polls.prototype.generateReport=function(e){var redirectToReport,_this;return null!=e&&e.preventDefault(),_this=this,redirectToReport=function(polls,surveys,competitions,groups){var activities,opts,promises;return null==polls&&(polls=[]),null==surveys&&(surveys=[]),null==competitions&&(competitions=[]),null==groups&&(groups=[]),promises=[],_this.trigger("view:action","generate_report",{poll_count:polls.length,survey_count:surveys.length,competition_count:competitions.length,group_count:groups.length}),(activities=new PollEv.Model.ActivityCollection).add(polls),activities.add(surveys),activities.add(_.flatten(competitions.map(function(competition){return competition.polls.models}))),promises.push($.when.apply($,_.invoke(competitions,"fetch",{data:{include:"poll_instances",exclude:"options,visual_settings,flash_options,results"}})).then(function(){return competitions.map(function(competition){return competition.polls.each(function(poll){return activities.add(poll)})})})),promises.push(groups.length?(opts={data:{group_id:_.pluck(groups,"id").join("id")},remove:!1},activities.fetch(opts).then(function(){return activities.each(function(model){if(model instanceof PollEv.Model.Survey)return activities.add(model.polls.toArray()),activities.remove(model)})}),$.when.apply($,promises)):$.Deferred().resolve()),$.when.apply($,promises).then(function(){return _this.redirectToCreateReport(activities.pluck("id"))})},this.ensureSelection(0,redirectToReport,!1)},Polls.prototype.redirectToCreateReport=function(ids,type){var storageKey,url;null==type&&(type=!1),url=URI("/reports/create"),type&&(url=url.addSearch({report_type:type}));try{storageKey=_.uniqueId("reportingIds_"),window.sessionStorage.setItem(storageKey,ids),url=url.addSearch({storageKey:storageKey})}catch(error){url=url.addSearch({polls:ids.join(",")})}return window.location.href=url.toString()},Polls.prototype.downloadSlides=function(){return this.ensureSelection((_this=this,function(polls,surveys,competitions,groups){var addGroupActivities,toBeLoaded;return null==polls&&(polls=[]),null==surveys&&(surveys=[]),null==competitions&&(competitions=[]),null==groups&&(groups=[]),_this.trigger("view:action","download_slides",{poll_count:polls.length,survey_count:surveys.length,competition_count:competitions.length,group_count:groups.length}),toBeLoaded=[],addGroupActivities=function(group){return group.activities.each(function(activity){return activity instanceof PollEv.Model.Survey&&surveys.push(activity),activity instanceof PollEv.Model.Competition?competitions.push(activity):polls.push(activity)})},groups.forEach(function(group){var loadGroup;return inconsistentGroupData(group)||!group.isRealGroup()?((loadGroup=group.activities.fetch()).then(function(){return addGroupActivities(group)}),toBeLoaded.push(loadGroup)):addGroupActivities(group)}),$.when.apply($,toBeLoaded).then(function(){return downloadSlides(_this,polls,surveys,competitions)})}));var _this},Polls.prototype.toggleMoveMultiEdit=function(){return $(this.multiEditView.el).is(":visible")&&this.multiEditView.toggle(),$(this.copyView.el).is(":visible")&&this.copyView.toggle(),this.toggleMultiEditMenu(this.moveView),toggleMoveToUser(this),this.trigger("view:action","move_multi_edit")},Polls.prototype.toggleCopyMultiEdit=function(){return $(this.multiEditView.el).is(":visible")&&this.multiEditView.toggle(),$(this.moveView.el).is(":visible")&&this.moveView.toggle(),this.toggleMultiEditMenu(this.copyView),this.trigger("view:action","copy_multi_edit")},Polls.prototype.toggleMultiEdit=function(){return $(this.moveView.el).is(":visible")&&this.moveView.toggle(),$(this.copyView.el).is(":visible")&&this.copyView.toggle(),this.toggleMultiEditMenu(this.multiEditView),this.trigger("view:action","move_multi_edit")},Polls.prototype.toggleMultiEditMenu=function(view){var _this;return this.$el.hasClass("flexible")?setTimeout((_this=this,function(){return _this.$el.removeClass("flexible")}),400):this.$el.addClass("flexible"),this.$(".polls-bulk-controls").hasClass("fixed")?($("html, body").animate({scrollTop:0},"fast"),$(window).scroll(),setTimeout(function(){return view.toggle()},300)):view.toggle()},Polls.prototype.truncate=function(str,max){return str.length>max?str.slice(0,max)+"...":str},Polls.prototype.getSelected=function(prune){var competitions,groups,polls,surveys,_this;return null==prune&&(prune=!0),groups=this.selectedGroups(),surveys=this.selectedSurveys(),competitions=this.selectedCompetitions(),polls=this.selectedPolls(),prune&&(competitions=_.compact(competitions.map(function(competition){return competition.has("group_id")&&competition.get("group_id")&&_.contains(_.pluck(groups,"id"),competition.get("group_id"))?void 0:competition}))),prune&&(surveys=_.compact(surveys.map(function(survey){return survey.has("group_id")&&survey.get("group_id")&&_.contains(_.pluck(groups,"id"),survey.get("group_id"))?void 0:survey}))),prune&&(polls=_.compact(polls.map((_this=this,function(poll){return poll.has("group_id")&&poll.get("group_id")&&_.contains(_.pluck(groups,"id"),poll.get("group_id"))?void 0:poll.has("survey_id")&&poll.get("survey_id")&&_.contains(_.pluck(_this.selectedSurveys(),"id"),poll.get("survey_id"))?void 0:poll})))),{groups:groups,surveys:surveys,competitions:competitions,polls:polls}},Polls.prototype.ensureSelection=function(limit,fun,prune){var competitions,groups,polls,ref,surveys;return null==limit&&(limit=0),null==prune&&(prune=!0),_.isFunction(limit)&&(fun=limit),groups=(ref=this.getSelected(prune)).groups,surveys=ref.surveys,competitions=ref.competitions,0===(polls=ref.polls).length+groups.length+surveys.length+competitions.length?PollEv.Component.Modal.alert("You didn't select anything.\n\nDon't worry, it happens to all of us.",{simpleTitle:"Hold up a sec!"}):limit>0&&polls.length>limit?PollEv.Component.Modal.alert("You've selected too many questions!\n\nTry selecting no more than "+limit+" and try again.",{simpleTitle:"Hold up a sec!"}):fun.call(this,polls,surveys,competitions,groups)},Polls.prototype.togglePollSorting=function(){var sortable;if(sortable=!!this.app.user.get("features").poll_sorting,this.$(".poll-sorting").toggleVisibility(sortable),sortable)return this.sortByMine()},Polls.prototype.render=function(){var invitesLeft,_this;this.$el.html(JST["templates/my_polls/my_polls"]()),null==this.delayNagger&&this.$el.append($(".register-and-upsell-nag")),this.showUsers(),this.appendView(".multi-edit",this.multiEditView),this.appendView(".multi-edit",this.moveView),this.appendView(".multi-edit",this.copyView),this.showingAllUsers&&this.copyView.$(".multi-edit-copy-to-group").remove(),!this.showingAllUsers&&1===this.users.length&&this.users.every((_this=this,function(user){return user.id===_this.app.user.id}))?this.listenTo(this.app.user.groups,"update",function(_this){return function(groups){var activityCount,reducer;return reducer=function(count,group){return count+group.get("activities_count")},activityCount=groups.reduce(reducer,0),toggleEmptyState.call(_this,!activityCount)}}(this)):toggleEmptyState.call(this,!1),this.togglePollSorting(),this.toggleLonelyBigAccountNotice(),this.toggleFixedHeader(),PollEverywhereUtils.qtipize(this.$("#explain_alone_on_account_with_teams_enabled .tip")),enablePositionManager(this),sessionStorage.getItem("sharedActivitiesCopied")&&this.toast&&(sessionStorage.removeItem("sharedActivitiesCopied"),this.toast.success("Successfully copied")),invitesLeft=!this.app.user.get("invites_left")||this.app.user.get("invites_left")>0,window.location.pathname.includes("account/polls")&&invitesLeft&&renderInvitationsNagger(this),window.location.pathname.includes("my/polls")&&checkBrowserVersion(this),this.trashToast||(this.trashToast=new PollEv.Component.Notification({mode:"toast"}),$("body").append(this.trashToast.render().$el));try{sessionStorage.getItem("showActivityTrashedToast")&&(sessionStorage.removeItem("showActivityTrashedToast"),this.trashToast.success(trashSuccessMessage(1)[0]))}catch(error){error}return this},Polls.prototype.toggleLonelyBigAccountNotice=function(){var show;if(this.showingAllUsers)return show=this.app.user.get("alone_on_account_with_teams_enabled"),this.$("#explain_alone_on_account_with_teams_enabled").toggleVisibility(show)},Polls}(PollEv.View.Base)})}.call(this),function(jQuery,window){"use strict";function migrateWarn(msg){var console=window.console;warnedAbout[msg]||(warnedAbout[msg]=!0,jQuery.migrateWarnings.push(msg),console&&console.warn&&!jQuery.migrateMute&&(console.warn("JQMIGRATE: "+msg),jQuery.migrateTrace&&console.trace&&console.trace()))}function migrateWarnProp(obj,prop,value,msg){Object.defineProperty(obj,prop,{configurable:!0,enumerable:!0,get:function(){return migrateWarn(msg),value}})}var log;jQuery.migrateTrace=!1,
jQuery.migrateVersion="3.0.0",(log=window.console&&window.console.log&&function(){window.console.log.apply(window.console,arguments)})&&(jQuery&&!/^[12]\./.test(jQuery.fn.jquery)||log("JQMIGRATE: jQuery 3.0.0+ REQUIRED"),jQuery.migrateWarnings&&log("JQMIGRATE: Migrate plugin loaded multiple times"));var warnedAbout={};jQuery.migrateWarnings=[],jQuery.migrateTrace===undefined&&(jQuery.migrateTrace=!0),jQuery.migrateReset=function(){warnedAbout={},jQuery.migrateWarnings.length=0},"BackCompat"===document.compatMode&&migrateWarn("jQuery is not compatible with Quirks Mode");var findProp,oldInit=jQuery.fn.init,oldIsNumeric=jQuery.isNumeric,oldFind=jQuery.find,rattrHashTest=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/,rattrHashGlob=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/g;for(findProp in jQuery.fn.init=function(arg1){var args=Array.prototype.slice.call(arguments);return"string"==typeof arg1&&"#"===arg1&&(migrateWarn("jQuery( '#' ) is not a valid selector"),args[0]=[]),oldInit.apply(this,args)},jQuery.fn.init.prototype=jQuery.fn,jQuery.find=function(selector){var args=Array.prototype.slice.call(arguments);if("string"==typeof selector&&rattrHashTest.test(selector))try{document.querySelector(selector)}catch(err1){selector=selector.replace(rattrHashGlob,function(_,attr,op,value){return"["+attr+op+'"'+value+'"]'});try{document.querySelector(selector),migrateWarn("Attribute selector with '#' must be quoted: "+args[0]),args[0]=selector}catch(err2){migrateWarn("Attribute selector with '#' was not fixed: "+args[0])}}return oldFind.apply(this,args)},oldFind)Object.prototype.hasOwnProperty.call(oldFind,findProp)&&(jQuery.find[findProp]=oldFind[findProp]);jQuery.fn.size=function(){return migrateWarn("jQuery.fn.size() is deprecated; use the .length property"),this.length},jQuery.parseJSON=function(){return migrateWarn("jQuery.parseJSON is deprecated; use JSON.parse"),JSON.parse.apply(null,arguments)},jQuery.isNumeric=function(val){function isNumeric2(obj){var realStringObj=obj&&obj.toString();return!jQuery.isArray(obj)&&realStringObj-parseFloat(realStringObj)+1>=0}var newValue=oldIsNumeric(val),oldValue=isNumeric2(val);return newValue!==oldValue&&migrateWarn("jQuery.isNumeric() should not be called on constructed objects"),oldValue},migrateWarnProp(jQuery,"unique",jQuery.uniqueSort,"jQuery.unique is deprecated, use jQuery.uniqueSort"),migrateWarnProp(jQuery.expr,"filters",jQuery.expr.pseudos,"jQuery.expr.filters is now jQuery.expr.pseudos"),migrateWarnProp(jQuery.expr,":",jQuery.expr.pseudos,'jQuery.expr[":"] is now jQuery.expr.pseudos');var oldAjax=jQuery.ajax;jQuery.ajax=function(){var jQXHR=oldAjax.apply(this,arguments);return jQXHR.promise&&(migrateWarnProp(jQXHR,"success",jQXHR.done,"jQXHR.success is deprecated and removed"),migrateWarnProp(jQXHR,"error",jQXHR.fail,"jQXHR.error is deprecated and removed"),migrateWarnProp(jQXHR,"complete",jQXHR.always,"jQXHR.complete is deprecated and removed")),jQXHR};var oldRemoveAttr=jQuery.fn.removeAttr,oldToggleClass=jQuery.fn.toggleClass,rmatchNonSpace=/\S+/g;jQuery.fn.removeAttr=function(name){var self=this;return jQuery.each(name.match(rmatchNonSpace),function(i,attr){jQuery.expr.match.bool.test(attr)&&(migrateWarn("jQuery.fn.removeAttr no longer sets boolean properties: "+attr),self.prop(attr,!1))}),oldRemoveAttr.apply(this,arguments)},jQuery.fn.toggleClass=function(state){return state!==undefined&&"boolean"!=typeof state?oldToggleClass.apply(this,arguments):(migrateWarn("jQuery.fn.toggleClass( boolean ) is deprecated"),this.each(function(){var className=this.getAttribute&&this.getAttribute("class")||"";className&&jQuery.data(this,"__className__",className),this.setAttribute&&this.setAttribute("class",className||!1===state?"":jQuery.data(this,"__className__")||"")}))};var internalSwapCall=!1;jQuery.swap&&jQuery.each(["height","width","reliableMarginRight"],function(_,name){var oldHook=jQuery.cssHooks[name]&&jQuery.cssHooks[name].get;oldHook&&(jQuery.cssHooks[name].get=function(){var ret;return internalSwapCall=!0,ret=oldHook.apply(this,arguments),internalSwapCall=!1,ret})}),jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in internalSwapCall||migrateWarn("jQuery.swap() is undocumented and deprecated"),options)old[name]=elem.style[name],elem.style[name]=options[name];for(name in ret=callback.apply(elem,args||[]),options)elem.style[name]=old[name];return ret};var oldData=jQuery.data;jQuery.data=function(elem,name,value){var curData;return name&&name!==jQuery.camelCase(name)&&(curData=jQuery.hasData(elem)&&oldData.call(this,elem))&&name in curData?(migrateWarn("jQuery.data() always sets/gets camelCased names: "+name),arguments.length>2&&(curData[name]=value),curData[name]):oldData.apply(this,arguments)};var oldTweenRun=jQuery.Tween.prototype.run;jQuery.Tween.prototype.run=function(percent){jQuery.easing[this.easing].length>1&&(migrateWarn('easing function "jQuery.easing.'+this.easing.toString()+'" should use only first argument'),jQuery.easing[this.easing]=jQuery.easing[this.easing].bind(jQuery.easing,percent,this.options.duration*percent,0,1,this.options.duration)),oldTweenRun.apply(this,arguments)};var oldLoad=jQuery.fn.load,originalFix=jQuery.event.fix;jQuery.event.props=[],jQuery.event.fixHooks={},jQuery.event.fix=function(originalEvent){var event,type=originalEvent.type,fixHook=this.fixHooks[type],props=jQuery.event.props;if(props.length)for(migrateWarn("jQuery.event.props are deprecated and removed: "+props.join());props.length;)jQuery.event.addProp(props.pop());if(fixHook&&!fixHook._migrated_&&(fixHook._migrated_=!0,migrateWarn("jQuery.event.fixHooks are deprecated and removed: "+type),(props=fixHook.props)&&props.length))for(;props.length;)jQuery.event.addProp(props.pop());return event=originalFix.call(this,originalEvent),fixHook&&fixHook.filter?fixHook.filter(event,originalEvent):event},jQuery.each(["load","unload","error"],function(_,name){jQuery.fn[name]=function(){var args=Array.prototype.slice.call(arguments,0);return"load"===name&&"string"==typeof args[0]?oldLoad.apply(this,args):(migrateWarn("jQuery.fn."+name+"() is deprecated"),args.splice(0,0,name),arguments.length?this.on.apply(this,args):(this.triggerHandler.apply(this,args),this))}}),jQuery(function(){jQuery(document).triggerHandler("ready")}),jQuery.event.special.ready={setup:function(){this===document&&migrateWarn("'ready' event is deprecated")}},jQuery.fn.extend({bind:function(types,data,fn){return migrateWarn("jQuery.fn.bind() is deprecated"),this.on(types,null,data,fn)},unbind:function(types,fn){return migrateWarn("jQuery.fn.unbind() is deprecated"),this.off(types,null,fn)},delegate:function(selector,types,data,fn){return migrateWarn("jQuery.fn.delegate() is deprecated"),this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return migrateWarn("jQuery.fn.undelegate() is deprecated"),1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var oldOffset=jQuery.fn.offset;jQuery.fn.offset=function(){var docElem,elem=this[0],origin={top:0,left:0};return elem&&elem.nodeType?(docElem=(elem.ownerDocument||document).documentElement,jQuery.contains(docElem,elem)?oldOffset.apply(this,arguments):(migrateWarn("jQuery.fn.offset() requires an element connected to a document"),origin)):(migrateWarn("jQuery.fn.offset() requires a valid DOM element"),origin)};var oldParam=jQuery.param;jQuery.param=function(data,traditional){var ajaxTraditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional;return traditional===undefined&&ajaxTraditional&&(migrateWarn("jQuery.param() no longer uses jQuery.ajaxSettings.traditional"),traditional=ajaxTraditional),oldParam.call(this,data,traditional)};var oldSelf=jQuery.fn.andSelf||jQuery.fn.addBack;jQuery.fn.andSelf=function(){return migrateWarn("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),oldSelf.apply(this,arguments)};var oldDeferred=jQuery.Deferred,tuples=[["resolve","done",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory"),jQuery.Callbacks("memory")]];jQuery.Deferred=function(func){var deferred=oldDeferred(),promise=deferred.promise();return deferred.pipe=promise.pipe=function(){var fns=arguments;return migrateWarn("deferred.pipe() is deprecated"),jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify):newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)})}),fns=null}).promise()},func&&func.call(deferred,deferred),deferred},jQuery.Deferred.exceptionHook=oldDeferred.exceptionHook}(jQuery,window),function(){function EventEmitter(){}function indexOfListener(listeners,listener){for(var i=listeners.length;i--;)if(listeners[i].listener===listener)return i;return-1}function alias(name){return function(){return this[name].apply(this,arguments)}}var proto=EventEmitter.prototype,exports=this,originalGlobalValue=exports.EventEmitter;proto.getListeners=function(evt){var response,key,events=this._getEvents();if("object"==typeof evt)for(key in response={},events)events.hasOwnProperty(key)&&evt.test(key)&&(response[key]=events[key]);else response=events[evt]||(events[evt]=[]);return response},proto.flattenListeners=function(listeners){var i,flatListeners=[];for(i=0;i<listeners.length;i+=1)flatListeners.push(listeners[i].listener);return flatListeners},proto.getListenersAsObject=function(evt){var response,listeners=this.getListeners(evt);return listeners instanceof Array&&((response={})[evt]=listeners),response||listeners},proto.addListener=function(evt,listener){var key,listeners=this.getListenersAsObject(evt),listenerIsWrapped="object"==typeof listener;for(key in listeners)listeners.hasOwnProperty(key)&&-1===indexOfListener(listeners[key],listener)&&listeners[key].push(listenerIsWrapped?listener:{listener:listener,once:!1});return this},proto.on=alias("addListener"),proto.addOnceListener=function(evt,listener){return this.addListener(evt,{listener:listener,once:!0})},proto.once=alias("addOnceListener"),proto.defineEvent=function(evt){return this.getListeners(evt),this},proto.defineEvents=function(evts){for(var i=0;i<evts.length;i+=1)this.defineEvent(evts[i]);return this},proto.removeListener=function(evt,listener){var index,key,listeners=this.getListenersAsObject(evt);for(key in listeners)listeners.hasOwnProperty(key)&&-1!==(index=indexOfListener(listeners[key],listener))&&listeners[key].splice(index,1);return this},proto.off=alias("removeListener"),proto.addListeners=function(evt,listeners){return this.manipulateListeners(!1,evt,listeners)},proto.removeListeners=function(evt,listeners){return this.manipulateListeners(!0,evt,listeners)},proto.manipulateListeners=function(remove,evt,listeners){var i,value,single=remove?this.removeListener:this.addListener,multiple=remove?this.removeListeners:this.addListeners;if("object"!=typeof evt||evt instanceof RegExp)for(i=listeners.length;i--;)single.call(this,evt,listeners[i]);else for(i in evt)evt.hasOwnProperty(i)&&(value=evt[i])&&("function"==typeof value?single.call(this,i,value):multiple.call(this,i,value));return this},proto.removeEvent=function(evt){var key,type=typeof evt,events=this._getEvents();if("string"===type)delete events[evt];else if("object"===type)for(key in events)events.hasOwnProperty(key)&&evt.test(key)&&delete events[key];else delete this._events;return this},proto.removeAllListeners=alias("removeEvent"),proto.emitEvent=function(evt,args){var listener,i,key,listeners=this.getListenersAsObject(evt);for(key in listeners)if(listeners.hasOwnProperty(key))for(i=listeners[key].length;i--;)!0===(listener=listeners[key][i]).once&&this.removeListener(evt,listener.listener),listener.listener.apply(this,args||[])===this._getOnceReturnValue()&&this.removeListener(evt,listener.listener);return this},proto.trigger=alias("emitEvent"),proto.emit=function(evt){var args=Array.prototype.slice.call(arguments,1);return this.emitEvent(evt,args)},proto.setOnceReturnValue=function(value){return this._onceReturnValue=value,this},proto._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},proto._getEvents=function(){return this._events||(this._events={})},EventEmitter.noConflict=function(){return exports.EventEmitter=originalGlobalValue,EventEmitter},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return EventEmitter}):"object"==typeof module&&module.exports?module.exports=EventEmitter:this.EventEmitter=EventEmitter}.call(this),function(window){function getIEEvent(obj){var event=window.event;return event.target=event.target||event.srcElement||obj,event}var docElem=document.documentElement,bind=function(){};docElem.addEventListener?bind=function(obj,type,fn){obj.addEventListener(type,fn,!1)}:docElem.attachEvent&&(bind=function(obj,type,fn){obj[type+fn]=fn.handleEvent?function(){var event=getIEEvent(obj);fn.handleEvent.call(fn,event)}:function(){var event=getIEEvent(obj);fn.call(obj,event)},obj.attachEvent("on"+type,obj[type+fn])});var unbind=function(){};docElem.removeEventListener?unbind=function(obj,type,fn){obj.removeEventListener(type,fn,!1)}:docElem.detachEvent&&(unbind=function(obj,type,fn){obj.detachEvent("on"+type,obj[type+fn]);try{delete obj[type+fn]}catch(err){obj[type+fn]=undefined}});var eventie={bind:bind,unbind:unbind};"function"==typeof define&&define.amd?define("eventie/eventie",eventie):window.eventie=eventie}(this),function(window,factory){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(EventEmitter,eventie){return factory(window,EventEmitter,eventie)}):"object"==typeof exports?module.exports=factory(window,require("eventEmitter"),require("eventie")):window.imagesLoaded=factory(window,window.EventEmitter,window.eventie)}(this,function(window,EventEmitter,eventie){function extend(a,b){for(var prop in b)a[prop]=b[prop];return a}function isArray(obj){return"[object Array]"===objToString.call(obj)}function makeArray(obj){var ary=[];if(isArray(obj))ary=obj;else if("number"==typeof obj.length)for(var i=0,len=obj.length;i<len;i++)ary.push(obj[i]);else ary.push(obj);return ary}function ImagesLoaded(elem,options,onAlways){if(!(this instanceof ImagesLoaded))return new ImagesLoaded(elem,options);"string"==typeof elem&&(elem=document.querySelectorAll(elem)),this.elements=makeArray(elem),this.options=extend({},this.options),"function"==typeof options?onAlways=options:extend(this.options,options),onAlways&&this.on("always",onAlways),this.getImages(),$&&(this.jqDeferred=new $.Deferred);var _this=this;setTimeout(function(){_this.check()})}function LoadingImage(img){this.img=img}function Resource(src){this.src=src,cache[src]=this}var $=window.jQuery,console=window.console,hasConsole=void 0!==console,objToString=Object.prototype.toString;ImagesLoaded.prototype=new EventEmitter,ImagesLoaded.prototype.options={},ImagesLoaded.prototype.getImages=function(){this.images=[];for(var i=0,len=this.elements.length;i<len;i++){var elem=this.elements[i];"IMG"===elem.nodeName&&this.addImage(elem);var nodeType=elem.nodeType;if(nodeType&&(1===nodeType||9===nodeType||11===nodeType))for(var childElems=elem.querySelectorAll("img"),j=0,jLen=childElems.length;j<jLen;j++){var img=childElems[j];this.addImage(img)}}},ImagesLoaded.prototype.addImage=function(img){var loadingImage=new LoadingImage(img);this.images.push(loadingImage)},ImagesLoaded.prototype.check=function(){function onConfirm(image,message){return _this.options.debug&&hasConsole&&console.log("confirm",image,message),_this.progress(image),++checkedCount===length&&_this.complete(),!0}var _this=this,checkedCount=0,length=this.images.length;if(this.hasAnyBroken=!1,length)for(var i=0;i<length;i++){var loadingImage=this.images[i];loadingImage.on("confirm",onConfirm),loadingImage.check()}else this.complete()},ImagesLoaded.prototype.progress=function(image){this.hasAnyBroken=this.hasAnyBroken||!image.isLoaded;var _this=this;setTimeout(function(){_this.emit("progress",_this,image),_this.jqDeferred&&_this.jqDeferred.notify&&_this.jqDeferred.notify(_this,image)})},ImagesLoaded.prototype.complete=function(){var eventName=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var _this=this;setTimeout(function(){if(_this.emit(eventName,_this),_this.emit("always",_this),_this.jqDeferred){var jqMethod=_this.hasAnyBroken?"reject":"resolve";_this.jqDeferred[jqMethod](_this)}})},$&&($.fn.imagesLoaded=function(options,callback){return new ImagesLoaded(this,options,callback).jqDeferred.promise($(this))}),LoadingImage.prototype=new EventEmitter,LoadingImage.prototype.check=function(){var resource=cache[this.img.src]||new Resource(this.img.src);if(resource.isConfirmed)this.confirm(resource.isLoaded,"cached was confirmed");else if(this.img.complete&&this.img.naturalWidth!==undefined)this.confirm(0!==this.img.naturalWidth,"naturalWidth");else{var _this=this;resource.on("confirm",function(resrc,message){return _this.confirm(resrc.isLoaded,message),!0}),resource.check()}},LoadingImage.prototype.confirm=function(isLoaded,message){this.isLoaded=isLoaded,this.emit("confirm",this,message)};var cache={};return Resource.prototype=new EventEmitter,Resource.prototype.check=function(){if(!this.isChecked){var proxyImage=new Image;eventie.bind(proxyImage,"load",this),eventie.bind(proxyImage,"error",this),proxyImage.src=this.src,this.isChecked=!0}},Resource.prototype.handleEvent=function(event){var method="on"+event.type;this[method]&&this[method](event)},Resource.prototype.onload=function(event){this.confirm(!0,"onload"),this.unbindProxyEvents(event)},Resource.prototype.onerror=function(event){this.confirm(!1,"onerror"),this.unbindProxyEvents(event)},Resource.prototype.confirm=function(isLoaded,message){this.isConfirmed=!0,this.isLoaded=isLoaded,this.emit("confirm",this,message)},Resource.prototype.unbindProxyEvents=function(event){eventie.unbind(event.target,"load",this),eventie.unbind(event.target,"error",this)},ImagesLoaded});